---
layout: post
title: 'LDAP é›†æˆä¹‹ Dokuwiki ç¯‡'
subtitle: 'åˆ©ç”¨ LDAP ä¸º Dokuwiki æä¾›ç”¨æˆ·è®¤è¯æœåŠ¡'
date: 2022-06-22 15:40:00 +0900
categories: [tech, webmaster]
author: zhonger
cover: 'https://i.luish.cc/cover/0QQ3x6.webp'
cover_author: 'Artur Voznenko'
cover_author_link: 'https://unsplash.com/@voznenko_artur'
tags:  
- LDAP
- Dokuwiki
---

## å‰è¨€

### ç™¾ç§‘çš„å‘å±•

&emsp;&emsp;è¯´åˆ°ç™¾ç§‘ï¼Œå›½é™…ä¸Šæœ€å‡ºåçš„è«è¿‡äº [WikiPedia](https://wikipedia.org)ï¼Œè€Œå›½å†…æœ€å‡ºåçš„è«è¿‡äº[ç™¾åº¦ç™¾ç§‘](https://baike.baidu.com)ã€‚å½“ç„¶ï¼Œè¿™ä¸¤è€…ä¹Ÿæœ‰ä¸€äº›å·®åˆ«ã€‚WikiPedia æ”¯æŒå¤šç§è¯­è¨€ï¼Œå¯ä»¥è‡ªç”±ç¼–è¾‘ï¼Œä¸è¿‡ä¸€èˆ¬ä¼šè¦æ±‚æä¾›å¿…è¦çš„å‚è€ƒèµ„æ–™åŠé“¾æ¥æ¥ä½è¯ã€‚ç™¾åº¦ç™¾ç§‘åˆ™åªæ”¯æŒä¸­æ–‡ï¼Œå¯¹äºç¼–è¾‘æ¡ç›®ä¹Ÿæœ‰æ¯”è¾ƒé«˜çš„è¦æ±‚ï¼Œä¸€èˆ¬æ¥è¯´æ˜¯ç”±ä¸“é—¨çš„äººå‘˜ç¼–å†™ã€å®¡æ ¸ã€‚é™¤äº†è¿™ä¸¤å®¶ä¹‹å¤–ï¼Œä¹Ÿæœ‰ä¸€äº›å…¶ä»–çš„å¤§ä¼—ç™¾ç§‘ï¼Œæ¯”å¦‚ [ä¸­å›½å¤§ç™¾ç§‘](https://www.zgbk.com)ã€[360 ç™¾ç§‘](https://baike.so.com)ã€[æœç‹—ç™¾ç§‘](https://baike.sogou.com) ç­‰ã€‚å¤§ä¼—ç™¾ç§‘çš„æ˜¾è‘—ç‰¹ç‚¹æ˜¯èŒƒå›´éå¸¸å¹¿ï¼Œé€‚åˆå¤§ä¼—ç§‘æ™®ï¼Œè€Œæƒ³è¦æŸ¥æ‰¾ä¸€äº›å¤ªè¿‡è¯¦ç»†çš„çŸ¥è¯†å¯èƒ½æ— æ³•æ»¡è¶³ã€‚

&emsp;&emsp;äºæ˜¯éšç€ç™¾ç§‘ç‰¹æ®ŠåŒ–çš„éœ€æ±‚å¢å¤§ï¼Œè¶Šæ¥è¶Šå¤šçš„ä¸“é—¨åŒ–æˆ–è€…ç‰¹æ®ŠåŒ–çš„ç™¾ç§‘ä¹Ÿå¼€å§‹æ¶Œç°ï¼Œæ¯”å¦‚ä¸è®¡ç®—æœºä¸“ä¸šç›¸å…³çš„ [é›†æ™ºç™¾ç§‘](https://wiki.swarma.org)ã€[AI çŸ¥è¯†åº“](https://easyai.tech)ï¼Œä¸æ¸¸æˆç›¸å…³çš„ [ç°æœº Wiki](https://www.huijiwiki.com/wiki)ï¼Œä¸äºŒæ¬¡å…ƒåŠ¨æ¼«ã€å°è¯´ç›¸å…³çš„ [èŒå¨˜ç™¾ç§‘](https://zh.moegirl.org.cn) ç­‰ç­‰ã€‚è¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šå¼¥è¡¥äº†å¤§ä¼—ç™¾ç§‘çš„ä¸è¶³ï¼Œæ»¡è¶³äº†å¤§ä¼—å¯¹äºä¸“é—¨åŒ–çŸ¥è¯†ç§‘æ™®æˆ–è€…æ‰‹å†Œçš„éœ€æ±‚ã€‚

### å¼€æºç™¾ç§‘ç¨‹åº

&emsp;&emsp;æ—¢ç„¶æ˜¯ç™¾ç§‘ç«™ç‚¹ï¼Œå°±éœ€è¦æœ‰ç™¾ç§‘ç¨‹åºæ¥æ”¯æ’‘ç”¨æˆ·ç®¡ç†ã€æ¡ç›®ç¼–è¾‘ã€æ¡ç›®å®¡æ ¸ç­‰åŠŸèƒ½ã€‚å…¶å®ï¼Œä¸–ç•Œä¸Šæœ€å¤§çš„ç™¾ç§‘ç«™ç‚¹ WikiPedia ä½¿ç”¨çš„æ˜¯å…è´¹å¼€æºçš„ [MediaWiki](https://www.mediawiki.org/)ã€‚è€Œç™¾åº¦ç™¾ç§‘åˆ™æ˜¯é‡‡ç”¨è‡ªå®¶å¼€å‘çš„é—­æºç¨‹åºï¼Œä¸”ä¸ç™¾åº¦è´¦å·ã€ç™¾åº¦çŸ¥é“ç­‰ç™¾åº¦ç³»äº§å“æ‰“é€šã€‚å¦‚æœè‡ªå·±æƒ³è¦æ­å»ºä¸€ä¸ªç™¾ç§‘ç«™ç‚¹ï¼Œé™¤äº† MediaWiki å¤–ï¼Œè¿˜æœ‰å¾ˆå¤šå…è´¹çš„é€‰æ‹©ï¼Œæ¯”å¦‚ [Dokuwiki](https://www.dokuwiki.org/)ã€[Wiki.js](https://js.wiki)ã€[Notion](https://www.notion.so) ç­‰ç­‰ã€‚

&emsp;&emsp;å…¶ä¸­ï¼ŒDokuwiki æ˜¯ä¸€ä¸ªåŸºäº PHP çš„ã€å¯ä»¥ç™¾ç§‘ç«™ç‚¹ã€å›¢é˜Ÿç«™ç‚¹ä¸¤ç”¨çš„å¼€æºç¨‹åºã€‚ç¬”è€…æ¯”è¾ƒå–œæ¬¢ Dokuwiki çš„ä¸€ç‚¹æ˜¯ï¼Œ**å®Œå…¨ä¸éœ€è¦æ•°æ®åº“å¯ä»¥ç‹¬ç«‹éƒ¨ç½²ä»¥åŠæ”¯æŒç‰ˆæœ¬è¿­ä»£**ã€‚è¿™ä¸€ç‚¹ä¸â€œä¸€åˆ‡çš†æ–‡ä»¶â€çš„æ€æƒ³ä¼¼ä¹å¾ˆæ¥è¿‘ã€‚ï¼ˆğŸ˜‚ å®é™…ä¸Šæ˜¯å› ä¸ºç¬”è€…ä¸æ„¿æ„ç®¡ç†æ•°æ®åº“ï¼‰ Wiki.js è™½ç„¶æ˜¯åŸºäº NodeJS ç¼–å†™çš„ï¼Œä½†è¿˜æ˜¯éœ€è¦è¿æ¥æ•°æ®åº“ã€‚Notion æ˜¯ä¸€æ¬¾æ›´åƒä¸ªäººç¬”è®°çš„è½¯ä»¶ï¼Œæ— é¡»è‡ªè¡Œéƒ¨ç½²ï¼Œåªéœ€è¦ä½¿ç”¨ Web ç«¯æˆ–è€…å®¢æˆ·ç«¯ç¼–è¾‘å³å¯ã€‚Notion æœ¬èº«æ”¯æŒå¾ˆå¤šå¼€æ”¾æ€§çš„åŠŸèƒ½ï¼Œç”šè‡³è¯´è¿˜èƒ½å’Œ [zotero](https://www.zotero.org) ä¸€èµ·ç®¡ç†æ–‡çŒ®ã€‚å¦‚æœéå¸¸ç†Ÿæ‚‰ Notion çš„å„ç§åŠŸèƒ½ï¼Œå¯èƒ½ç”¨ Notion æ¥æ­å»ºä¸€ä¸ªç™¾ç§‘ä¹Ÿéå¸¸åˆé€‚ã€‚ä¸è¿‡ï¼Œç¬”è€…è§‰å¾—è¦è¾¾åˆ°è¿™ç§ç¨‹åº¦å¯èƒ½éœ€è¦åƒå­¦ä¹ å®‡å®™æ— æ•Œçš„ IDE -- Visual Studio ä¸€æ ·å¤æ‚ã€‚

&emsp;&emsp;Dokuwiki çš„è®¾è®¡æœ‰ç‚¹ç±»ä¼¼äº VS Code çš„è®¾è®¡å“²å­¦ï¼Œæœ¬ä½“æä¾›çš„åªæ˜¯æœ€åŸºæœ¬çš„ã€æœ€ç®€å•çš„åŠŸèƒ½ã€‚å¦‚æœä½ æƒ³è¦å…¶ä»–åŠŸèƒ½æˆ–è€…æ”¹å˜æ ·å¼ï¼Œä½ å¯ä»¥é€šè¿‡å®‰è£…æ’ä»¶æˆ–è€…ä¸»é¢˜çš„æ–¹å¼æ¥å®ç°ã€‚è€Œ Dokuwiki
å®˜æ–¹å’Œç¤¾åŒºä½œè€…æä¾›äº†æ¯”è¾ƒä¸°å¯Œçš„æ’ä»¶å’Œä¸»é¢˜ï¼Œèƒ½å¤Ÿæœ‰å¾ˆå¥½çš„å¯æ‰©å±•æ€§å’Œ DIY å¯èƒ½ã€‚å°±æ¯”å¦‚æœ¬æ–‡å‡†å¤‡è¦ä¸º Dokuwiki æ¥å…¥çš„ LDAP è®¤è¯ï¼Œå®é™…ä¸Šä¹Ÿæ˜¯å®˜æ–¹æä¾›çš„æ’ä»¶ä¹‹ä¸€ã€‚é»˜è®¤ç¨‹åºæ˜¯å·²å®‰è£… LDAP Auth Plugin æ’ä»¶çš„ï¼Œæˆ‘ä»¬åªéœ€è¦å†åšä¸€äº›ç®€å•è®¾ç½®å³å¯æ¥å…¥ LDAP è®¤è¯ã€‚

## å®è·µ

&emsp;&emsp;ä¸ºäº†æ›´åŠ ç®€ä¾¿åœ°å®ç° Dokuwiki æ¥å…¥ LDAP è®¤è¯ï¼Œè¿™é‡Œé‡‡ç”¨äº†é¢„å…ˆå‡†å¤‡å¥½çš„ Docker é•œåƒ -- [shuosc/dokuwiki](https://hub.docker.com/r/shuosc/dokuwiki)ã€‚å¦‚æœæ„Ÿå…´è¶£çš„è¯ï¼Œå¯ä»¥è®¿é—®ç¬”è€…ç»´æŠ¤çš„ [shuosc/docker-dokuwiki](https://github.com/shuosc/docker-dokuwiki) é¡¹ç›®äº†è§£æ›´å¤šå…³äºè¯¥é•œåƒçš„æ„å»ºç»†èŠ‚ã€‚

### é¢„å…ˆå‡†å¤‡çš„ç¯å¢ƒ

- Docker ç¯å¢ƒ
- docker-compose å·¥å…·

### Dokuwiki

#### åˆ›å»ºå®ä¾‹

&emsp;&emsp;ä½¿ç”¨ä¸‹é¢çš„ docker-compose.yml æ–‡ä»¶å’Œ `docker-compose up -d` å‘½ä»¤å¯åŠ¨ä¸€ä¸ª Dokuwiki å®ä¾‹ã€‚è¿™é‡Œçš„ç«¯å£æ˜ å°„å¯ä»¥æ ¹æ®å–œå¥½æˆ–å®é™…æƒ…å†µè‡ªè¡Œè°ƒæ•´ã€‚

```yaml
# docker-compose.yml

version: '2'
services:
  dokuwiki:
    image: shuosc/dokuwiki:latest
    ports:
      - 80:80
    environment:
      - DIR=wiki
    volumes:
      - ./data:/opt/data
```

#### è¿è¡ŒéªŒè¯

&emsp;&emsp;è®¿é—® [http://localhost/wiki/](http://localhost/wiki/) å³å¯çœ‹åˆ°å¦‚ä¸‹å›¾æ‰€ç¤ºçš„ Dokuwiki å®ä¾‹é¦–é¡µã€‚è¿™é‡Œå…¶å®æ˜¯å·²ç»ä½¿ç”¨é»˜è®¤çš„ admin ç”¨æˆ·ç™»å½•ä¹‹åçš„é¡µé¢äº†ã€‚

> info "å°æç¤º"
> &emsp;&emsp;shuosc/dokuwiki é»˜è®¤ç®¡ç†å‘˜ admin çš„åˆå§‹å¯†ç ä¸º adminã€‚å¦‚æœå®¹å™¨å®ä¾‹å¯è¢«å¤–éƒ¨ç½‘ç»œè®¿é—®ï¼Œå‡ºäºå®‰å…¨æ€§è€ƒè™‘å»ºè®®åœ¨è¿è¡ŒååŠæ—¶ä¿®æ”¹æˆå¼ºå¯†ç ã€‚

![é¦–é¡µ Home Page](https://i.luish.cc/blog/nNCoC5.webp)

### é…ç½® LDAP ç™»å½•

#### å®‰è£… LDAP æ”¯æŒ

&emsp;&emsp;ç”±äº [shuosc/dokuwiki](https://hub.docker.com/r/shuosc/dokuwiki) é•œåƒæœ¬æ¥ä¸æ˜¯ä¸º LDAP è®¤è¯æ„å»ºçš„ï¼Œæ²¡æœ‰å®‰è£… LDAP è®¤è¯æ‰€éœ€çš„ `php7-ldap` åº“ï¼Œæ‰€ä»¥éœ€è¦åœ¨å¯åŠ¨å®ä¾‹åè¿›å…¥å®¹å™¨å†…éƒ¨å®‰è£…ä¸€ä¸‹ï¼Œå¹¶é‡å¯å®¹å™¨å®ä¾‹ç”Ÿæ•ˆã€‚

```shell
# è¿›å…¥å®¹å™¨å®ä¾‹
docker exec -ti <id> /bin/bash 

# é»˜è®¤ç”¨æˆ·ä¸º root
apt update && apt install -y php7-ldap

# é€€å‡ºå®¹å™¨å®ä¾‹åæ‰§è¡Œ
docker restart <id>
```

> info "å°æç¤º"
> &emsp;&emsp;ç”±äº shuosc/dokuwiki é•œåƒé»˜è®¤é‡‡ç”¨çš„ USTCï¼ˆä¸­ç§‘å¤§ï¼‰çš„è½¯ä»¶æºï¼Œç¬”è€…åœ¨å®‰è£… php7-ldap åº“æ—¶é‡åˆ° Not Found çš„é”™è¯¯ã€‚å¦‚æœä½ ä¹Ÿé‡åˆ°äº†ï¼Œå¯ä»¥å°†å®¹å™¨å®ä¾‹çš„è½¯ä»¶æºåˆ‡æ¢åˆ°å…¶ä»–è½¯ä»¶æºï¼Œæ¯”å¦‚æ‰§è¡Œ `sed -i "s/ustc/nju/" /etc/apt/sources.list` å³å¯ä» USTC åˆ‡æ¢åˆ° NJUï¼ˆå—äº¬å¤§å­¦ï¼‰è½¯ä»¶æºã€‚  
> &emsp;&emsp;å¦å¤–ï¼Œè¿™æ ·çš„å®‰è£…åªæ˜¯ä¸€ç§ä¸´æ—¶çš„è§£å†³æ–¹æ¡ˆï¼Œé”€æ¯å¹¶é‡å»ºå®¹å™¨å®ä¾‹åä»ç„¶æ²¡æœ‰ php7-ldap åº“ã€‚å› æ­¤åç»­ shuosc/dokuwki é•œåƒå°†ä¼šå¢åŠ è¿™ä¸€æ”¯æŒã€‚

#### è®¾ç½® LDAP

&emsp;&emsp;åœ¨ç™»å½•æˆåŠŸåï¼Œå¯ä»¥å¦‚ä¸Šæ­¥ä¸­å›¾ä¸­æ‰€ç¤ºç‚¹å‡»å³ä¸Šè§’**ç®¡ç†**æŒ‰é’®è¿›å…¥**ç®¡ç†é¡µé¢**ã€‚

![ç®¡ç†ç•Œé¢ Admin Page](https://i.luish.cc/blog/ABVW2W.webp)

&emsp;&emsp;è¿™é‡Œå¯ä»¥å…ˆç‚¹å‡»**æ‰©å±•ç®¡ç†å™¨**ç¡®è®¤ä¸€ä¸‹ **LDAP Auth Plugin** æ’ä»¶æ˜¯å¦å·²é¢„å®‰è£…ã€‚è¿™é‡Œç”±äºæ˜¯å¯ç”¨åçš„æˆªå›¾ï¼Œæ‰€ä»¥å³è¾¹æ²¡æœ‰**å¸è½½**å’Œ**å…³é—­**æŒ‰é’®ä»¥åŠå¯ç”¨çš„æç¤ºã€‚

![æ‰©å±•ç®¡ç†å™¨ Plugins Manage Page](https://i.luish.cc/blog/ysQEBr.webp)

&emsp;&emsp;è¿”å›åˆšæ‰çš„**ç®¡ç†é¡µé¢**ï¼Œç‚¹å‡»**é…ç½®è®¾ç½®**æŒ‰é’®å³å¯è¿›å…¥å®Œæ•´çš„é…ç½®è®¾ç½®ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºæ˜¯ LDAP è®¤è¯éƒ¨åˆ†çš„é…ç½®ï¼Œåœ¨å®é™…é¡µé¢çš„æ¯”è¾ƒé åçš„ä½ç½®å¯ä»¥æ‰¾åˆ°ã€‚

![LDAP è®¾ç½® LDAP Settings](https://i.luish.cc/blog/hnMxkY.webp)

&emsp;&emsp;ä¸Šå›¾æ˜¯é»˜è®¤çš„é…ç½®ï¼Œæˆ‘ä»¬éœ€è¦å¡«ä¸€ä¸‹å…¶ä¸­çš„ä¸€äº›æ¡ç›®ï¼Œå†…å®¹å¦‚ä¸‹ï¼ˆå…¶ä»–ä¿æŒé»˜è®¤å³å¯ï¼‰ï¼š

| æ¡ç›® | å†…å®¹ |
| --- | --- |
| server | ldap.example.com |
| usertree | ou=People,dc=example,dc=com |
| userfilter | (&(objectClass=posixAccount)(uid=%{user})) |
| version | 3 |
| binddn | cn=admin,dc=example,dc=com |
| bindpw | xxxxxxxxxxx |
| modPass | unchecked |

#### å¯ç”¨ LDAP

&emsp;&emsp;ä¸Šæ­¥å¡«å†™çš„æ˜¯ LDAP ç›¸å…³é…ç½®ä¿¡æ¯ï¼Œè¿™é‡Œè¿˜éœ€è¦å°†é»˜è®¤çš„**è®¤è¯æ–¹å¼**ï¼ˆauthtypeï¼‰ä» authbasic åˆ‡æ¢åˆ° authldapï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚å¦å¤–ï¼Œä¸ºäº†ä¿è¯ LDAP çš„ç®¡ç†å‘˜ç”¨æˆ·å¯ä»¥è®¿é—® Dokuwiki çš„ç®¡ç†é¡µé¢ï¼Œè¿™é‡Œä¹Ÿéœ€è¦æŒ‡å®š**è¶…çº§ç”¨æˆ·**ï¼ˆsuperuserï¼‰çš„ç”¨æˆ·åã€‚

> info "å°æç¤º"
> &emsp;&emsp;ç”±äºå¯ç”¨äº† LDAP è®¤è¯ï¼Œè¿™é‡Œåº”è¯¥è¦å¦‚ä¸‹å›¾æ‰€ç¤ºåœç”¨ Dokuwiki çš„**æ³¨å†Œ**åŠŸèƒ½ï¼Œ

![å¯ç”¨ LDAP Enable LDAP](https://i.luish.cc/blog/zW5Fgq.webp)

### å…¶ä»–

&emsp;&emsp;ä¸º Dokuwiki æ¥å…¥ LDAP è®¤è¯ä¹‹åï¼Œæ‰€æœ‰æŒ‡å®šç»„ç›®å½•ä¸‹çš„æ‰€æœ‰ LDAP ç”¨æˆ·éƒ½å¯ä»¥æ­£å¸¸ç™»å½• Dokuwikiã€‚ä½†ç”±äº LDAP åªæä¾›äº†ç”¨æˆ·ç™»å½•éªŒè¯ï¼ŒDokuwiki ç›¸åº”é¡µé¢çš„æƒé™ä»ç„¶éœ€è¦ä½¿ç”¨ Dokuwiki è‡ªå¸¦çš„**ç”¨æˆ·ç®¡ç†å™¨**æ¥ç®¡ç†ã€‚å…·ä½“æ“ä½œå¯ä»¥ [Dokuwiki Manual](https://www.dokuwiki.org/start?id=zh:manual) æ¥äº†è§£æ›´å¤šã€‚

## å‚è€ƒèµ„æ–™

- [LDAP Auth Backend: OpenLDAP Examples](https://www.dokuwiki.org/auth:ldap_openldap)
- [Dokuwiki with LDAP error: User authentication is temporarily unavailable](https://stackoverflow.com/questions/24322779/dokuwiki-with-ldap-error-user-authentication-is-temporarily-unavailable)