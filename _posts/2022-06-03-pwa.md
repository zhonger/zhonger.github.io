---
layout: post
title: 'PWAï¼šå¯èƒ½æ˜¯æˆæœ¬æœ€ä½çš„ç«™ç‚¹åŠ é€Ÿæ–¹å¼'
subtitle: 'ä½ çŸ¥é“ç°åœ¨æµè¡Œçš„å¾®ä¿¡å°ç¨‹åºå®é™…ä¸Šä¹Ÿæ˜¯ PWA çš„ä¸€ç§å—ï¼Ÿ'
date: 2022-06-03 10:54:00 +0900
categories: [tech, webmaster]
author: zhonger
cover: 'https://i.luish.cc/cover/EBXSnv.webp'
cover_author: 'Marc-Olivier Jodoin'
cover_author_link: 'https://unsplash.com/@marcojodoin'
tags:  
- PWA
- æ¸è¿›å¼ç½‘ç»œåº”ç”¨ç¨‹åº
- å°ç¨‹åº
- åŠ é€Ÿ
- Accelerate
render_with_liquid: false
---

## å‰è¨€

&emsp;&emsp;PWAï¼ˆProgressive Web Appï¼‰ï¼Œä¸­æ–‡ç§°ä¸ºâ€œ**æ¸è¿›å¼ç½‘ç»œåº”ç”¨ç¨‹åº**â€ï¼Œåˆ©ç”¨ä¸€ç³»åˆ—ç°ä»£çš„ Web æŠ€æœ¯æ¥å¢å¼º Web App çš„åŠŸèƒ½ï¼Œä»è€Œå®ç°åº”ç”¨ç¨‹åºä¸€æ ·çš„ç”¨æˆ·ä½“éªŒã€‚äº‹å®ä¸Šï¼Œä»»ä½•çš„ç½‘ç«™éƒ½å¯ä»¥åšæˆ PWAã€‚ä»è¿™ä¸ªæ¦‚å¿µä¸Šæ¥è¯´ï¼ŒPWA å®é™…ä¸Šæ˜¯ä¸€ç§ç†å¿µã€‚æ ¹æ®è¿™ç§ç†å¿µå¯ä»¥åˆ›é€ å‡ºå„å¼å„æ ·çš„ä¸œè¥¿ï¼Œæ¯”å¦‚è¯´å¾®ä¿¡å°ç¨‹åºã€ç™¾åº¦å°ç¨‹åºã€æ”¯ä»˜å®å°ç¨‹åºç­‰ç­‰ï¼ˆğŸ˜‚ è™½ç„¶å®ƒä»¬éƒ½ä¸æ‰¿è®¤è‡ªå·±æ˜¯å’Œ PWA ä¸€è„‰ç›¸æ‰¿çš„ï¼‰ã€‚

### ä¸ºä½•æœ‰ PWA

&emsp;&emsp;éšç€ç½‘ç»œå’Œæ™ºèƒ½è®¾å¤‡çš„é£é€Ÿå‘å±•åŠæå‡ï¼Œè¶Šæ¥è¶Šå¤šçš„åŸç”Ÿåº”ç”¨ç¨‹åºå æ®äº†æ™ºèƒ½è®¾å¤‡çš„ç©ºé—´å’Œèµ„æºã€‚æ›¾å‡ ä½•æ—¶ï¼Œä¸€ä¸ªå¾®åšåº”ç”¨ç¨‹åºè¿˜åªæœ‰ 100M å·¦å³ï¼Œç°åœ¨ä¸€å®‰è£…ä¸€ç™»å½•å°±è¦åˆ°å¿« 1Gã€‚å†æ²¡äº‹åˆ·ä¸€åˆ·æ–°é—»æˆ–è€…è§†é¢‘ï¼Œå¯èƒ½å°±è¦å˜æˆ 1.5Gï¼Œç”šè‡³æ›´å¤šã€‚ç±»ä¼¼å¾®åšè¿™æ ·ï¼Œæˆ‘ä»¬æ—¥å¸¸å¯èƒ½å¸¸ç”¨çš„æ·˜å®ã€å¾®ä¿¡ã€QQã€çŸ¥ä¹ç­‰ç­‰å‡ ä¹éƒ½æ˜¯å¦‚æ­¤ã€‚è™½ç„¶è¿™æ ·çš„ç©ºé—´å’Œè¿è¡Œå†…å­˜èµ„æºå ç”¨èƒ½ç»™æˆ‘ä»¬å¸¦æ¥å¾ˆå¥½çš„ç”¨æˆ·ä½“éªŒï¼Œä½†å®é™…ä¸Šè¿˜æ˜¯åœ¨ä¸€ç‚¹ç‚¹æ¦¨å¹²æ™ºèƒ½è®¾å¤‡çš„èµ„æºã€‚æœ€åæ™ºèƒ½è®¾å¤‡è¶Šæ¥è¶Šå¡ï¼Œåªèƒ½ä¾é æ—¶å¸¸æ¸…ç†ã€é‡ç½®æˆ–è€…å‡çº§ç¡¬ä»¶æ¥ç„•å‘æ–°æœºã€‚

&emsp;&emsp;ç›¸æ¯”åŸç”Ÿåº”ç”¨å¼€å‘è€Œè¨€ï¼ŒWeb åº”ç”¨ç¨‹åºçš„å¼€å‘å’Œæ›´æ–°ç»´æŠ¤åˆ™æ˜¾å¾—ä¸è¦å¤ªè½»æ¾ï¼ŒçœŸæ­£å®ç°äº†â€œä¸€éæ›´æ–°æ‰€æœ‰å®¢æˆ·ç«¯é€‚ç”¨â€ã€‚å¦‚æœè¦ä»æ€§èƒ½å’Œå¯è°ƒç”¨è®¾å¤‡èµ„æºæ¥çœ‹ï¼Œå¯èƒ½ä»¥å‰åŸç”Ÿåº”ç”¨è¦å ä¸Šé£ã€‚ä½†æ˜¯éšç€ HTML5 å’Œ CSS3 çš„å‘å±•ï¼ŒWeb åº”ç”¨ç¨‹åºåœ¨æ€§èƒ½å’Œè®¾å¤‡èµ„æºè°ƒç”¨ä¸Šå·²ç»ä¸åŸç”Ÿåº”ç”¨å·®åˆ«æ— äºŒäº†ã€‚æ‰€ä»¥è¶Šæ¥è¶Šå¤šçš„åŸºäº Web æŠ€æœ¯çš„ Hybrid å®¢æˆ·ç«¯æˆ–è€…çº¯ Web å®¢æˆ·ç«¯å¼€å§‹æ¶Œç°ï¼Œæ¯”å¦‚éå¸¸çŸ¥åçš„ç½‘æ˜“äº‘å®¢æˆ·ç«¯ï¼Œæ— è®ºæ˜¯ PC å®¢æˆ·ç«¯è¿˜æ˜¯ç§»åŠ¨å®¢æˆ·ç«¯éƒ½å·²ç»åˆ‡æ¢åˆ°äº† Web æŠ€æœ¯æ ˆã€‚è¿˜æœ‰ç°åœ¨éå¸¸æµè¡Œçš„ä»£ç ç¼–è¾‘å™¨ VS Codeï¼Œæ˜¯åŸºäº Electron æ¡†æ¶è¿›è¡ŒäºŒæ¬¡å¼€å‘ï¼Œå…¶ç®€æ˜“çš„æ“ä½œé€»è¾‘å’Œä¸°å¯Œçš„æ’ä»¶ä¸ºå¼€å‘è€…å¸¦æ¥äº†æ— é™çš„å¯èƒ½ã€‚

> note "ä»£ç ç¼–è¾‘å™¨å°çŸ¥è¯†"
> &emsp;&emsp;ä»£ç ç¼–è¾‘å™¨å¯ä»¥ä»æœ¬èº«çš„å¤æ‚ç¨‹åº¦åˆ†æˆä¸¤ç§ï¼šä¸€ç§æ˜¯ä»¥ Eclipseã€Visual Studioã€*Stormï¼ˆPHPStorm ç­‰ï¼‰ã€ Xcodeã€IDEA ä¸ºä»£è¡¨çš„å¤§è€Œå…¨çš„â€œå·¨æ— éœ¸â€ä»£ç ç¼–è¾‘å™¨ï¼Œå¦ä¸€ç§æ˜¯ä»¥ Sublime Textã€Notepad++ã€Atomã€VS Codeã€Brackets ä¸ºä»£è¡¨çš„å°è€Œå®ç”¨çš„â€œç®€æ´â€ä»£ç ç¼–è¾‘å™¨ã€‚  
> &emsp;&emsp;â€œå·¨æ— éœ¸â€ä»£ç ç¼–è¾‘å™¨ä¹Ÿæœ‰å…¶å¥½å¤„ï¼Œèƒ½å¤Ÿæä¾›ä¿å§†å¼çš„ç•Œé¢äº¤äº’ï¼Œå¯èƒ½çœ‹ç€çœå¿ƒä¸€ç‚¹ã€‚ä½†è¿™ä¹Ÿæ˜¯ä¸€ä¸ªç¼ºç‚¹ï¼Œä½ éœ€è¦å…ˆå­¦ä¹ å¦‚ä½•ä½¿ç”¨ä»£ç ç¼–è¾‘å™¨ï¼Œæ‰èƒ½ç”¨å®ƒæ¥ç¼–å†™ä½ æƒ³è¦çš„ç¨‹åºã€‚â€œç®€æ´â€ä»£ç ç¼–è¾‘å™¨åªæä¾›å¿…è¦çš„ç»„ä»¶ï¼Œæ¯”å¦‚æ–‡ä»¶åˆ—è¡¨ã€ç»ˆç«¯ã€æœç´¢æ›¿æ¢ã€é«˜äº®ç­‰ã€‚å¦‚æœéœ€è¦æ›´å¤šçš„åŠŸèƒ½ï¼Œå¯ä»¥é€šè¿‡å®‰è£…æ’ä»¶çš„æ–¹å¼æ¥æ‰©å±•æ”¯æŒã€‚å½“ç„¶ï¼Œâ€œç®€æ´â€ä»£ç ç¼–è¾‘å™¨ä¼šè¦æ±‚ä½ å¯¹â€œä¸€åˆ‡çš†æ–‡ä»¶â€çš„ Unix/Linux å“²å­¦æœ‰æ¯”è¾ƒå¥½çš„è®¤è¯†ï¼Œå› ä¸ºä½ éœ€è¦é€šè¿‡æ‰‹åŠ¨ä¿®æ”¹æ–‡ä»¶é…ç½®å†…å®¹çš„æ–¹å¼æ¥è®¾ç½®å„ç§å„æ ·çš„ä¸œè¥¿ï¼Œè€Œæå°‘æœ‰äº¤äº’ç•Œé¢æä¾›ã€‚

&emsp;&emsp;å½“æˆ‘ä»¬æŠŠåŸç”Ÿåº”ç”¨å’Œ Web åº”ç”¨æ”¾åœ¨ä¸€èµ·æ¥è€ƒè™‘æ—¶ï¼Œæˆ‘ä»¬å°±ä¼šæƒ³æ˜¯å¦èƒ½æœ‰ä¸€ç§æ–¹å¼å¯ä»¥ç»“åˆä¸¤è€…çš„ä¼˜ç‚¹æ¥ä¸ºç”¨æˆ·æä¾›æ›´å¥½çš„æœåŠ¡å‘¢ï¼Ÿ**PWA äºæ˜¯åº”è¿è€Œç”Ÿ**ã€‚

> info "å…¶ä»–æ–¹æ¡ˆ"
> &emsp;&emsp;é™¤äº† PWA ä¹‹å¤–ï¼Œå…¶å®è¿˜æ˜¯å…¶ä»–çš„æ–¹æ¡ˆå‡ºç°ã€‚æ¯”å¦‚åƒ Hybrid åº”ç”¨ã€React Nativeã€Flutter ç­‰ï¼Œå…·ä½“å¯ä»¥é˜…è¯»å‚è€ƒèµ„æ–™äº†è§£æ›´å¤šã€‚

### ä»€ä¹ˆæ˜¯æ¸è¿›å¼

&emsp;&emsp;æ‰€è°“çš„â€œ**æ¸è¿›å¼**â€æœ‰ä¸¤ä¸ªå«ä¹‰ï¼š

- ä¸€æ˜¯ **Web åº”ç”¨æ¸è¿›å¼æ¥è¿‘åŸç”Ÿåº”ç”¨**ï¼šé€šè¿‡å„ç§ Web æŠ€æœ¯å®ç°ä¸åŸç”Ÿåº”ç”¨ç›¸è¿‘çš„ç”¨æˆ·ä½“éªŒã€‚
- äºŒæ˜¯**ç»™æ”¯æŒ PWA çš„æµè§ˆå™¨ç”¨æˆ·å¸¦æ¥æ›´å¥½çš„ä½“éªŒ**ï¼šç”±äºä¸åŒæµè§ˆå™¨æ”¯æŒçš„ HTML/CSS çš„æƒ…å†µæœ‰æ‰€å·®åˆ«ï¼Œå¯ä»¥åˆ©ç”¨ PWA æ¥åˆ†æ­¥éª¤ã€åˆ†é˜¶æ®µåœ¨ä¸åŒæµè§ˆå™¨ä¸Šæ–°å¢ç‰¹æ€§ã€‚

> note "æ¸è¿›å¼åº”ç”¨"
> &emsp;&emsp;ä¸€ä¸ªæ¸è¿›å¼åº”ç”¨é¦–å…ˆæ˜¯ä¸€ä¸ªç½‘é¡µï¼Œé€šè¿‡å„ç§ Web æŠ€æœ¯ç¼–å†™å‡ºçš„ä¸€ä¸ªç½‘é¡µåº”ç”¨ã€‚ä¹‹åé€šè¿‡æ·»åŠ åº”ç”¨ Manifest å®ç°æ·»åŠ åˆ°ä¸»å±å¹•ï¼Œé€šè¿‡ Service Worker æ¥å®ç°ç¦»çº¿ç¼“å­˜å’Œæ¶ˆæ¯æ¨é€ç­‰åŠŸèƒ½ã€‚

&emsp;&emsp;æ­£æ˜¯ç”±äºè¿™äº›å› ç´ ï¼ŒPWA è‡³å°‘å¯ä»¥ç»™ä½ çš„ç«™ç‚¹å¸¦æ¥ä»¥ä¸‹å¥½å¤„ï¼š

- æ›´å¿«ã€æ›´å®‰å…¨çš„ç”¨æˆ·ä½“éªŒ
- æ›´å¥½çš„æœç´¢æ’åï¼ˆå°¤å…¶å¯¹äº Googleï¼‰
- æ›´å¥½çš„å¯ç”¨æ€§
- æ›´å¥½çš„æ€§èƒ½
- ç¦»çº¿è®¿é—®
- æ‰‹æœºå±å¹•ä¸Šçš„å¿«æ·æ–¹å¼åƒæ˜¯åŸç”Ÿåº”ç”¨

## ä¸º Jekyll é…ç½® PWA

&emsp;&emsp;ä»ä¸Šé¢åˆ—ä¸¾çš„ PWA çš„å¥½å¤„ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ˜¾ç„¶çŸ¥é“ï¼šPWA çš„ç¦»çº¿ç¼“å­˜ã€åŸç”Ÿå¼ä½“éªŒã€æœç´¢å¼•æ“å‹å¥½è¿™äº›ä¼˜ç‚¹éƒ½èƒ½ç”¨äºå®ç°ç«™ç‚¹åŠ é€Ÿã€‚é€šå¸¸çš„é™æ€ç«™ç‚¹åŠ é€Ÿæ–¹æ³•å¯èƒ½æ˜¯ï¼šå‡å°‘è¯·æ±‚ã€ç¼©å‡è¯·æ±‚çš„å¤§å°ã€CDN åŠ é€Ÿç­‰ç­‰ï¼Œä½†æ˜¯ PWA æœ¬èº«çš„ç‰¹æ€§å¯¹äºç”¨æˆ·ä½“éªŒæ¥è¯´ä¹Ÿæ˜¯æœ‰ä¸€äº›åŠ é€Ÿæ•ˆæœçš„ï¼Œæ¯•ç«Ÿè¢«è®¿é—®è¿‡ä¸€æ¬¡å°±ä¼šç¼“å­˜ä¸‹æ¥ã€‚è¿™ä¸ CDN çš„ç¼“å­˜æœ‰äº›ç±»ä¼¼ï¼Œåªä¸è¿‡ CDN æœ‰å¾ˆå¤šç¼“å­˜èŠ‚ç‚¹ï¼Œè€Œ PWA æ˜¯æŠŠæœ¬æœºä½œä¸ºå”¯ä¸€çš„ç¼“å­˜èŠ‚ç‚¹ã€‚

&emsp;&emsp;ç»è¿‡ä¸€ç•ªå¯¹äº Jekyll ä¸Š PWA æ”¯æŒçš„è°ƒæŸ¥åï¼Œå‘ç°çš„ç¡®ä¹Ÿå­˜åœ¨ä¸€äº›å·ç§°å¯ä»¥å¾ˆæ–¹ä¾¿ã€ç®€å•åœ°ä½¿ç”¨çš„ PWA æ’ä»¶ã€‚ä½†æ˜¯å°è¯•äº†ä¸€ä¸‹è§‰å¾—æœ‰ç‚¹å¤æ‚ä¸”æ’ä»¶çœ‹èµ·æ¥æ¯«æ— ç”¨å¤„ã€‚æ ¹æ®ä¸Šé¢æåˆ°çš„ PWA å®ç°æ–¹å¼æ¥çœ‹ï¼Œåªè¦æˆ‘ä»¬é…ç½®å¥½ Manifest å’Œ Service Workerï¼Œå°±å¯ä»¥æŠŠä¸€ä¸ªç«™ç‚¹å…¨éƒ¨å˜æˆ PWA åº”ç”¨ã€‚æ ¹æœ¬ä¸Šä¸æ˜¯å¦ Jekyll æˆ–å…¶ä»–åº”ç”¨æ— å…³ï¼Œå› æ­¤ä½¿ç”¨ PWA æ’ä»¶çš„å¿…è¦æ€§ä¸å¤§ã€‚

&emsp;&emsp;æ¥ä¸‹æ¥å°±è®©æˆ‘ä»¬æ¥å°è¯•ä¸€ä¸‹å¾’æ‰‹é…ç½® PWAã€‚

### é…ç½® Manifest

#### å…ƒä¿¡æ¯

&emsp;&emsp;Manifest å®é™…ä¸Šæ˜¯ä¸€ä¸ªå£°æ˜äº† PWA åº”ç”¨çš„æ‰€æœ‰å…ƒä¿¡æ¯çš„ JSON é…ç½®æ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚æˆ‘ä»¬éœ€è¦å®šä¹‰ PWA åº”ç”¨çš„åç§°ã€è¯­è¨€ã€ç¼©å†™ã€å›¾æ ‡ã€ä¸»é¢˜é¢œè‰²ã€èƒŒæ™¯é¢œè‰²ã€èµ·å§‹è·¯å¾„ã€‚

```json
{
    "lang": "{{ site.language }}",
    "dir": "{{ site.baseurl }}",
    "name": {{ site.title | smartify | jsonify }},
    "short_name": {{ site.pwa.short_name | smartify | jsonify }},
    "icons": [
      {
          "src": "{{ "/assets/img/touch/android-chrome-192x192.png" | prepend: site.baseurl }}",
          "sizes": "192x192",
          "type": "image/png"
      },
      {
          "src": "{{ "/assets/img/touch/android-chrome-512x512.png" | prepend: site.baseurl }}",
          "sizes": "512x512",
          "type": "image/png"
      },
      {
        "src": "{{ "/assets/img/touch/android-chrome-maskable-192x192.png" | prepend: site.baseurl }}",
        "sizes": "192x192",
        "type": "image/png",
        "purpose": "maskable"
      },
      {
        "src": "{{ "/assets/img/touch/android-chrome-maskable-512x512.png" | prepend: site.baseurl }}",
        "sizes": "512x512",
        "type": "image/png",
        "purpose": "maskable"
      }
    ], 
    "theme_color": "{{ site.pwa.color }}",
    "background_color": "{{ site.pwa.color }}",
    "start_url": "{{ "/" | prepend: site.baseurl }}",
    "display": "standalone",
    "orientation": "natural"
}
```

&emsp;&emsp;è¿™é‡Œå¤§éƒ¨åˆ†çš„å…ƒä¿¡æ¯éƒ½å¯ä»¥é€šè¿‡ Jekyll çš„ _config.yml å…¨å±€é…ç½®æ–‡ä»¶æ¥åŠ¨æ€é…ç½®ã€‚å…¶ä¸­ï¼Œç”±äºå›¾æ ‡éœ€è¦é€‚ç”¨äºä¸åŒçš„è®¾å¤‡ã€å±å¹•åˆ†è¾¨ç‡ï¼Œæ‰€ä»¥éœ€è¦å‡†å¤‡ä¸åŒå°ºå¯¸ã€åˆ†è¾¨ç‡çš„ç«™ç‚¹å›¾æ ‡ã€‚è¿™é‡Œå¯ä»¥ä½¿ç”¨ [cthedot](https://cthedot.de) å¼€å‘çš„ [cthedot/icongen](https://github.com/cthedot/icongen) å·¥å…·æ¥ä¸€é”®ç”Ÿæˆï¼Œéå¸¸ç®€å•æ–¹ä¾¿ã€‚ç”Ÿæˆåå°†å›¾æ ‡æ–‡ä»¶æ”¾ç½®åœ¨ä¸Šé¢è®¾ç½®å¥½çš„ä½ç½®ï¼ˆå¯è‡ªè¡Œå¯¹åº”ä¿®æ”¹ï¼‰ã€‚

> info "icongen é•œåƒç«™"
> &emsp;&emsp;ç”±äº icongen æºç«™åœ¨å¾·å›½ï¼Œäºšæ´²è®¿é—®é€Ÿåº¦æœ‰æ—¶å¯èƒ½ä¸å¤§å¥½ï¼Œæ‰€ä»¥ç¬”è€…ä½¿ç”¨ icongen å¼€æºä»£ç åœ¨ Cloudflare ä¸Šéƒ¨ç½²äº†ä¸€ä¸ªé•œåƒç«™ç‚¹ [icongen](https://icongen.pages.dev/)ï¼Œæ¬¢è¿ä½¿ç”¨ã€‚å½“ç„¶ï¼Œç”±äº icongen æ˜¯ä¸€ä¸ªé™æ€é¡µé¢ï¼Œæ— é¡»ä»»ä½•æœåŠ¡å™¨æ‰˜ç®¡ä¹Ÿå¯ä½¿ç”¨ï¼Œå¤§å®¶ä¹Ÿå¯ä¸‹è½½é¡¹ç›®æºä»£ç ï¼Œç”¨æµè§ˆå™¨æ‰“å¼€æºä»£ç ç›®å½•ä¸‹çš„ app/index.html æ–‡ä»¶ä¹Ÿå¯æ­£å¸¸ä½¿ç”¨ã€‚

#### æ¨¡æ¿åŒ–

&emsp;&emsp;ç”±äº manifest.json æ–‡ä»¶æˆ‘ä»¬ä¸æƒ³è¦æ¯ä¸ªç”¨æˆ·éƒ½æ¥å¤åˆ¶ä¸€éï¼Œæ‰€ä»¥å¯ä»¥å°†è¿™ä¸ªæ–‡ä»¶å†…å®¹æ¨¡æ¿åŒ–ï¼Œå³æŠŠ manifest.json æ–‡ä»¶æ”¾ç½®åœ¨ _layouts æ–‡ä»¶å¤¹ä¸­ã€‚è¿™æ ·ä¸€æ¥ï¼Œç”¨æˆ·å¯ä»¥éå¸¸ç®€å•åœ°åœ¨æºç çš„ä¸»ç›®å½•ä¸‹å»ºç«‹ä¸€ä¸ªæ–°çš„ manifest.json æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š

```js
---
layout: manifest
---
```

&emsp;&emsp;å¦å¤–ï¼Œåœ¨å…¨å±€é…ç½®æ–‡ä»¶ _config.yml ä¸­éœ€ç¡®ä¿æœ‰å¦‚ä¸‹é…ç½®ï¼š

```yaml
language: 'zh'
baseurl: ''
name: 'Blog'

# PWA
pwa:
  color: '#81BBFF'
  short_name: 'lisz'
```

#### é“¾æ¥åˆ°é¡µé¢

&emsp;&emsp;å½“ä¸Šé¢çš„å†…å®¹éƒ½è®¾ç½®å¥½åï¼Œæˆ‘ä»¬è¿˜éœ€å°† manifest.json çš„å£°æ˜é…ç½®åŠ å…¥åˆ°ç½‘ç«™çš„æ‰€æœ‰é¡µé¢ï¼Œå†…å®¹å¦‚ä¸‹æ‰€ç¤ºã€‚ä¸€èˆ¬æ¥è¯´ï¼ŒJekyll ä¸»é¢˜åªéœ€è¦åœ¨ head.html å’Œ post-head.html ä¸¤ä¸ªå¤´æ–‡ä»¶æ¨¡å—ä¸­åŠ å…¥ä¸‹é¢å†…å®¹å³å¯ï¼ˆä¸€ä¸ªæ˜¯æ™®é€šé¡µé¢ï¼Œä¸€ä¸ªæ˜¯æ–‡ç« é¡µé¢ï¼‰ã€‚

```html
<link rel="manifest" href="manifest.json">
```

### é…ç½® Service Worker

#### æ³¨å†Œ Service Worker

&emsp;&emsp;é…ç½®å®Œ  Manifest ä¹‹åï¼Œåªæ˜¯èƒ½å‘Šè¯‰æµè§ˆå™¨ä½ çš„åº”ç”¨æ˜¯ä¸€ä¸ª PWA åº”ç”¨ï¼Œè€Œå®é™…çš„ PWA çš„ç¦»çº¿ç¼“å­˜ç­‰ç‰¹æ€§éƒ½è¿˜æ²¡æœ‰å®ç°ï¼Œè¿™äº›éƒ½æ˜¯åœ¨ Service Worker ä¸­å®ç°çš„ã€‚é¦–å…ˆåœ¨ _includes ç›®å½•ä¸­åˆ›å»º pwa.html æ–‡ä»¶ï¼Œç”¨äºæ³¨å†Œ PWA åº”ç”¨ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

```liquid
<!-- pwa.html -->
<script>
    if ("serviceWorker" in navigator) {
        if (navigator.serviceWorker.controller) {
            console.log("An active service worker found, no need to register");
        } else {
            // Register the service worker
            navigator.serviceWorker
            .register("{{ "/sw.js" | prepend: site.baseurl }}", {
                scope: "{{ "/" | prepend: site.baseurl }}"
            })
            .then(function (reg) {
                console.log("Service worker has been registered for scope: " + reg.scope);
            });
        }
    }
</script>
```

&emsp;&emsp;å¹¶ä¸”ä¸ºäº†å¯ç”¨ pwa.html å°æ’ä»¶ï¼Œåº”è¯¥åœ¨ page.html å’Œ post.html æ¨¡æ¿çš„ body æœ«å°¾æ·»åŠ ä¸Šå¯¹å°æ’ä»¶çš„å¼•ç”¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```liquid
...
<body>
...
  {% include pwa.html %}
...
</body>
</html>
```

#### ç¦»çº¿ç¼“å­˜

&emsp;&emsp;Service Worker åŠŸèƒ½å®šä¹‰æ–‡ä»¶å®é™…ä¸Šä¹Ÿæ˜¯ä¸€ä¸ª JS æ–‡ä»¶ï¼ˆè¿™é‡Œå‘½åä¸º sw.jsï¼‰ï¼Œå‚è€ƒå†…å®¹å¦‚ä¸‹ï¼š

```js
// sw.js
const CACHE = "pwabuilder-offline";
  
const offlineFallbackPage = "index.html";

// Install stage sets up the index page (home page) in the cache and opens a new cache
self.addEventListener("install", function (event) {
console.log("Install Event processing");

event.waitUntil(
    caches.open(CACHE).then(function (cache) {
    console.log("Cached offline page during install");

    if (offlineFallbackPage === "ToDo-replace-this-name.html") {
        return cache.add(new Response("Update the value of the offlineFallbackPage constant in the serviceworker."));
    }

    return cache.add(offlineFallbackPage);
    })
);
});

// If any fetch fails, it will look for the request in the cache and serve it from there first
self.addEventListener("fetch", function (event) {
if (event.request.method !== "GET") return;

event.respondWith(
    fetch(event.request)
    .then(function (response) {
        console.log("Add page to offline cache: " + response.url);

        // If request was success, add or update it in the cache
        event.waitUntil(updateCache(event.request, response.clone()));

        return response;
    })
    .catch(function (error) {        
        console.log("Network request Failed. Serving content from cache: " + error);
        return fromCache(event.request);
    })
);
});

function fromCache(request) {
// Check to see if you have it in the cache
// Return response
// If not in the cache, then return error page
return caches.open(CACHE).then(function (cache) {
    return cache.match(request).then(function (matching) {
    if (!matching || matching.status === 404) {
        return Promise.reject("no-match");
    }

    return matching;
    });
});
}

function updateCache(request, response) {
    return caches.open(CACHE).then(function (cache) {
        return cache.put(request, response);
    });
}
```

&emsp;&emsp;sw.js æ–‡ä»¶çš„å†…å®¹ä¸»è¦å®šä¹‰äº†ç¬¬ä¸€æ¬¡è®¿é—®æ—¶å°†æ–‡ä»¶ç¦»çº¿ç¼“å­˜ä¸‹æ¥ï¼Œå†æ¬¡è¯·æ±‚æ˜¯ä»ç¼“å­˜ä¸­åŠ è½½ã€‚å¦‚æœé¦–æ¬¡ä»ç¼“å­˜ä¸­æ²¡æœ‰æ‰¾åˆ°æƒ³è¦çš„æ–‡ä»¶ï¼Œåˆ™ä¼šè¯·æ±‚æ›´æ–°ç¼“å­˜è·å–è¯¥æ–‡ä»¶ã€‚

#### æ¨¡æ¿åŒ–

&emsp;&emsp;ä¸ºäº†åœ¨ Jekyll ä¸»é¢˜ä¸­èƒ½æ›´æ–¹ä¾¿ç”¨æˆ·ä½¿ç”¨ï¼Œè¿™é‡Œä¹Ÿåº”è¯¥åƒ Manifest é‚£æ ·æ¨¡æ¿åŒ–ï¼Œå³åœ¨ _layouts ç›®å½•ä¸‹åˆ›å»ºä»¥ä¸Šå†…å®¹çš„ sw.js æ–‡ä»¶ã€‚è€Œç”¨æˆ·åªéœ€è¦åœ¨æºä»£ç ä¸»ç›®å½•ä¸‹åˆ›å»ºå¦‚ä¸‹å†…å®¹çš„ sw.js æ–‡ä»¶å³å¯ï¼š

```js
---
layout: sw
---
```

## éªŒè¯ PWA

&emsp;&emsp;å½“æˆ‘ä»¬è®¾ç½®å¥½ Manifest å’Œ Service Workerï¼Œå¹¶ä¸”å†æ¬¡ç”Ÿæˆ Jekyll é™æ€é¡µé¢å¹¶æ‰˜ç®¡åˆ°æœåŠ¡å™¨ä¹‹åï¼Œç”¨ Chrome æµè§ˆå™¨è®¿é—®ä¸»é¡µå°±ä¼šå‘ç°åœ°å€æ çš„å³è¾¹ä¼šå‡ºç°ä¸€ä¸ªæ–°çš„å›¾æ ‡ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚è¿™ä¸ªå›¾æ ‡å°±æ˜¯åœ¨æç¤ºä½ æ‰€è®¿é—®çš„é¡µé¢æ˜¯ PWA åº”ç”¨ï¼Œæ”¯æŒå®‰è£…å¿«æ·æ–¹å¼ã€‚ç‚¹å‡»è¯¥å›¾æ ‡ï¼Œä¼šæœ‰ä¸€ä¸ªåƒä¸‹é¢è¿™æ ·çš„å°å¼¹çª—æç¤ºï¼Œç‚¹å‡»å®‰è£…å³å¯å®‰è£…åˆ°ä¸»å±å¹•ï¼ŒPC ç«¯ã€ç§»åŠ¨ç«¯å‡å¯ã€‚

![å®‰è£…æç¤º Install tips](https://i.luish.cc/blog/8nPgKk.webp)

&emsp;&emsp;é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åœ¨ PC ç«¯æ‰“å¼€æµè§ˆå™¨çš„æ§åˆ¶å°ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ä¸€äº›æ¥è‡ª sw.js çš„æ‰“å°ä¿¡æ¯ã€‚è¿™äº›ä¿¡æ¯å‘Šè¯‰æˆ‘ä»¬ Service Worker å·²ç»æ³¨å†ŒæˆåŠŸäº†ï¼Œå¹¶ä¸”æœ‰å“ªäº›æ–‡ä»¶å·²ç»ç¦»çº¿ç¼“å­˜äº†ã€‚

![æ§åˆ¶å°æç¤º Command line tips](https://i.luish.cc/blog/OnrGr1.webp)

&emsp;&emsp;åœ¨æµè§ˆå™¨å¼€å‘å·¥å…·ä¸­ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡æŸ¥çœ‹**åº”ç”¨**çš„ **Service Workers** æ¥å†æ¬¡ç¡®è®¤ PWA çš„æƒ…å†µã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° sw.js ä» Initial åˆ° Wait åˆ° Activate çš„è¿‡ç¨‹ï¼Œ

![åº”ç”¨æç¤º App tips](https://i.luish.cc/blog/mXdqdH.webp)

## åè®°

&emsp;&emsp;ä»ä¸Šé¢çš„æ­¥éª¤æ¥çœ‹ï¼ŒWeb åº”ç”¨ PWA åŒ–ä¼¼ä¹ä¹Ÿä¸æ˜¯é‚£ä¹ˆéš¾ã€‚åªè¦æœ‰ Manifest å’Œ Service Worker å°±èƒ½æˆåŠŸæŠŠ Web åº”ç”¨ PWA åŒ–ã€‚å½“ç„¶ï¼Œä¹Ÿæœ‰ä¸€äº›æ›´åŠ ç®€å• PWA åŒ–çš„æ–¹æ³•ï¼Œæ¯”å¦‚è¯´ [pwabuilder](https://www.pwabuilder.com/)ã€‚ä¸è¿‡ï¼Œpwabuilder æ›´æ“…é•¿å¸®ä½ ä¼˜åŒ– PWA åº”ç”¨å¹¶ä¸”è½¬æˆ Windodwsã€Apple å’Œ Android ä¸‰ä¸ªå¹³å°çš„åº”ç”¨ã€‚å¦‚æœä½ æƒ³è¦æŠŠä½ çš„ PWA åº”ç”¨ä¸Šä¼ åˆ°åº”ç”¨å•†åº—ï¼Œé‚£ä¹ˆä¸å¦¨è¯•è¯•ã€‚

&emsp;&emsp;é™¤äº† Jekyll ä¹‹å¤–ï¼Œå…¶ä»–çš„é™æ€ç”Ÿæˆå™¨æ¯”å¦‚ Hexoã€Next.js ç­‰ç­‰æˆ–è€…åŠ¨æ€ç½‘ç«™éƒ½å¯ä»¥ PWA åŒ–ï¼Œè€Œä¸”å’Œ CDN åŠ é€Ÿä¸€èµ·ä½¿ç”¨ä¹Ÿéå¸¸åˆé€‚ã€‚

> info "æ¨èä¸€æ¬¾ PWA åº”ç”¨"
> &emsp;&emsp;å½“å¹´ Google ä¸ºäº†æ¨å¹¿ PWA æ›¾å¼€å‘äº†ä¸€æ¬¾éå¸¸å¥½ç”¨çš„ PWA åº”ç”¨ -- [Squoosh](https://squoosh.app/)ã€‚è¿™å°±æ˜¯æœ¬åœ°ç‰ˆçš„å›¾ç‰‡æ ¼å¼è½¬æ¢ã€å›¾ç‰‡å‹ç¼©çš„å…è´¹å·¥å…·ï¼Œå®Œå…¨å¯ä»¥æ›¿ä»£å¤§éƒ¨åˆ†å…¶ä»–å·¥å…·ã€‚å¦‚æœä½ å–œæ¬¢ç»ˆç«¯çš„è¯ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ [squoosh cli](https://github.com/GoogleChromeLabs/squoosh/tree/dev/cli)ã€‚

## å‚è€ƒèµ„æ–™

- [Make any Jekyll site into a PWA](https://dev.to/thewhitewulfy/make-any-jekyll-site-into-a-pwa-1de2)
- [jekyll åšå®¢çš„ PWA é…ç½®](https://sunbufu.vercel.app/posts/2019/2019-01-23-pwa/)
- [å°ç¨‹åºé¼»ç¥– â€”â€” åœ¨å›½å†…é€æ¸æ¶ˆäº¡çš„ PWA å¯ä»¥å¸¦ç»™æˆ‘ä»¬å“ªäº›å¯ç¤ºï¼Ÿ](https://segmentfault.com/a/1190000041729491)
- [Flutter ã€React Native ã€ Ionicã€ NativeScript ã€å°ç¨‹åºå’Œ PWA å“ªä¸ªå€¼å¾—å­¦ï¼Ÿ](https://segmentfault.com/a/1190000018590996)
