
<!DOCTYPE html>
<html lang="zh-Hans">
    <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kubernetes ä¸å®Œå…¨å…¥é—¨ - ä»²å„¿çš„è‡ªç•™åœ°</title>
    <meta name="author" content="zhonger">
    
    <meta name="description" content="Kubernetes ä¸å®Œå…¨å…¥é—¨">
    <meta name="keywords"
        content="Kubernetes, K8S, kubeadm, calico, flannel, csi-driver, NFS">
    
    <meta property="og:previous_url" content="/ac/qc/solve-quantum-chemistry-by-hand-1-1.html">
    
    
    <meta property="og:next_url" content="/tech/algorithm/bus-ticket.html">
    
    
    <meta property="post-date-format" content="0">
    
    <meta property="post-date" content="2024-10-08 16:50:00 +0900" />
    
    
    <meta property="calendar-scale" content="year" />
    <meta property="calendar-scheme" content="null" />
    <meta property="calendar-color" content="null" />
    
    <!-- Open Graph -->
    <meta property="og:title"
        content="Kubernetes ä¸å®Œå…¨å…¥é—¨ - ä»²å„¿çš„è‡ªç•™åœ°">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://lisz.me/tech/k8s/k8s-introduction.html">
    <meta property="og:baseurl" content="">
    <meta property="og:description" content="ä¸ªäººçš„ä¸€ä¸ªæŠ€æœ¯åšå®¢ç«™ç‚¹ï¼Œä¸»è¦ç”¨äºè®°å½•ä¸ªäººåœ¨å­¦ä¹ è¿‡ç¨‹ä¸­é‡åˆ°çš„æŠ€æœ¯é—®é¢˜åŠè§£å†³æ–¹æ³•ã€æŠ€æœ¯å®éªŒï¼Œä»¥åŠä¸€äº›æ¯”è¾ƒæœ‰è¶£çš„äº‹æƒ…ã€‚">
    <meta property="og:site_name" content="ä»²å„¿çš„è‡ªç•™åœ°">
    <meta property="og:gray" content="false">
    <meta property="og:lang" content="zh-Hans">
    
    <meta name="alivestart" content="08/08/2015">
    
    
    <meta name="google-site-verification" content="v729JR7Zs4nX-YvgaPeo3p1ise9vTA-6cMhamSu6N5c" />
    
    <meta name="theme-color" content="#81BBFF" />
    <link rel="manifest" href="/manifest.json" />
    <link rel="apple-touch-icon" href="/assets/img/touch/apple-touch-icon.png" />
    <link rel="Shortcut Icon" href="/assets/icons/favicon.ico">
    <link rel="icon" href="/assets/icons/favicon.ico" type="image/x-icon" />
    <link rel="bookmark" href="/assets/icons/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.min.css" async>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lxgw-wenkai-screen-webfont/style.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css/github-markdown-light.min.css">
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css">

    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css">
    
    


<link rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/prism-themes/themes/prism-one-light.min.css" />


<link rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/prismjs/plugins/line-numbers/prism-line-numbers.min.css">

    

    
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3" />

    <link rel="stylesheet" href="/assets/css/app.min.css">
    <script src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script>
</head>
    
    <body class="line-numbers" ontouchstart="">
    
    <!--[if lt IE 10]>
    <div class="alert-danger" role="alert">ä½ çš„æµè§ˆå™¨å®åœ¨å¤ªå¤ªå¤ªæ—§äº†ï¼Œæ”¾å­¦åˆ«èµ°ï¼Œå‡çº§å®Œæµè§ˆå™¨å†è¯´ï¼<a target="_blank" class="alert-link" href="http://browsehappy.com">ç«‹å³å‡çº§</a></div>
    <![endif]-->
        
        
        <div id="all" class="post" data-theme="default">
        
            
            
            <div class="alert-tip" id="no-previous">å·²ç»æ˜¯æœ€æ–°ä¸€ç¯‡æ–‡ç« äº†ï¼</div>
            <div class="alert-tip" id="no-next">å·²ç»æ˜¯æœ€åä¸€ç¯‡æ–‡ç« äº†ï¼</div>
        
            <input id="nm-switch" type="hidden" value="false">
            <header class="g-header" data-theme="default">
    <div class="g-logo">
      <a href="/" aria-label="logo"></a>
    </div>
    <!-- <i id="menu-toggle" class="iconfont icon-menu"></i> -->
    
        <div id="search-toggle"></div>
    
    
    <div id="random-toggle">
        <a href="#" aria-label="Random Article" target="_blank">ğŸ²</a>
    </div>
    <div id="travelling-toggle">
        <a href="https://www.travellings.cn/go.html" aria-label="Travelings" target="_blank">
            <svg class="icon" aria-hidden="true">
                <use xlink:href="#icon-train-subway"></use>
            </svg>
        </a>
    </div>
    
    <div id="mode-toggle">
        <svg class="icon icon-day" aria-hidden="true">
            <use xlink:href="#icon-day"></use>
        </svg>
        <svg class="icon icon-night" aria-hidden="true">
            <use xlink:href="#icon-night"></use>
        </svg>
    </div>
    <svg id="menu-toggle" class="icon-menu" aria-hidden="true">
        <use xlink:href="#icon-menu"></use>
    </svg>
    <nav class="g-nav">
        <ul>
            
                
                <li>
                    <a href="/" aria-label="home">
                        home
                    </a>
                </li>
                
            
                
                <li>
                    <a href="/blog/index.html" aria-label="blog">
                        blog
                    </a>
                </li>
                
            
                
                <li>
                    <a href="/archives.html" aria-label="archives">
                        archives
                    </a>
                </li>
                
            
                
                <li>
                    <a href="/tags.html" aria-label="tags">
                        tags
                    </a>
                </li>
                
            
                
                <li class="dropdown">
                    <a class="dropdown-toggle" href="javascript:void(0);"> about </a>
                    <ul class="dropdown-menu">
                    
                        <li>
                            <a href="/feed.xml" aria-label="RSS">
                                RSS
                            </a>
                        </li>
                    
                        <li>
                            <a href="/logs.html" aria-label="logs">
                                logs
                            </a>
                        </li>
                    
                        <li>
                            <a href="/tos.html" aria-label="tos">
                                tos
                            </a>
                        </li>
                    
                        <li>
                            <a href="/cv.html" aria-label="CV">
                                CV
                            </a>
                        </li>
                    
                        <li>
                            <a href="/links.html" aria-label="links">
                                links
                            </a>
                        </li>
                    
                    </ul> 
                </li>
                
            
                
                <li class="dropdown">
                    <a class="dropdown-toggle" href="javascript:void(0);"> collections </a>
                    <ul class="dropdown-menu">
                    
                        <li>
                            <a href="/tags.html#CONQUEST" aria-label="CONQUEST">
                                CONQUEST
                            </a>
                        </li>
                    
                        <li>
                            <a href="/tags.html#LDAP" aria-label="LDAP">
                                LDAP
                            </a>
                        </li>
                    
                        <li>
                            <a href="/tags.html#blog" aria-label="åšå®¢">
                                åšå®¢
                            </a>
                        </li>
                    
                    </ul> 
                </li>
                
            
            <li class="random">
                <a href="#" aria-label="Random Article" target="_blank">ğŸ²</a>
            </li>
            
            <li class="travelling">
                <a href="https://www.travellings.cn/go.html" aria-label="Travelings" target="_blank">
                    <svg class="icon" aria-hidden="true">
                        <use xlink:href="#icon-train-subway"></use>
                    </svg>
                </a>
            </li>
            
            <li class="mode">
                <svg class="icon day" aria-hidden="true">
                    <use xlink:href="#icon-day"></use>
                </svg>
                <svg class="icon night" aria-hidden="true">
                    <use xlink:href="#icon-night"></use>
                </svg>
            </li>
            
            <li id="search"></li>
            
        </ul>
    </nav>
</header>

            


<div class="g-banner post-header post-pattern-food bgcolor-default "
    data-theme="default">
    <div class="post-wrapper">
        <div class="post-tags">
            
            
            <a href="/%20/tags.html#Kubernetes" class="post-tag">Kubernetes</a>
            
            <a href="/%20/tags.html#K8S" class="post-tag">K8S</a>
            
            <a href="/%20/tags.html#kubeadm" class="post-tag">kubeadm</a>
            
            <a href="/%20/tags.html#calico" class="post-tag">calico</a>
            
            <a href="/%20/tags.html#flannel" class="post-tag">flannel</a>
            
            <a href="/%20/tags.html#csi-driver" class="post-tag">csi-driver</a>
            
            <a href="/%20/tags.html#NFS" class="post-tag">NFS</a>
            
            
        </div>
        <h1>Kubernetes ä¸å®Œå…¨å…¥é—¨</h1>
        <div class="post-meta">
            <span class="post-meta-item">
                <svg class="icon" aria-hidden="true">
                    <use xlink:href="#icon-user"></use>
                </svg>
                zhonger
            </span>
            <time class="post-meta-item" datetime=" 24-10-08">
                <svg class="icon" aria-hidden="true">
                    <use xlink:href="#icon-calendar"></use>
                </svg>
                <span class="create-at"></span>
            </time>
            <time class="post-meta-item" datetime=" 24-10-08">
                <svg class="icon" aria-hidden="true">
                    <use xlink:href="#icon-update"></use>
                </svg>
                <span class="update-at"></span>
            </time>
            <span class="post-meta-item">
                <svg class="icon words" aria-hidden="true">
                    <use xlink:href="#icon-words"></use>
                </svg>
                
                æœ¬æ–‡æ€»å…±  14.9k  å­— </span>
                    <span class="post-meta-item">
                        <svg class="icon time" aria-hidden="true">
                            <use xlink:href="#icon-time"></use>
                        </svg>
                        é˜…è¯»å…¨æ–‡å¤§çº¦éœ€è¦ 43 åˆ†é’Ÿ
                    </span>
                    
                    <span class="post-meta-item">
                        <svg class="icon pv" aria-hidden="true">
                            <use xlink:href="#icon-pv"></use>
                        </svg>
                        æœ¬æ–‡æ€»é˜…è¯»é‡ 
                        
                        <span id="busuanzi_page_pv"></span>
                        
                        æ¬¡
                    </span>
                    
                    
                    <span class="post-meta-item">
                        <svg class="icon" aria-hidden="true">
                            <use xlink:href="#icon-image"></use>
                        </svg>
                        
                        å°é¢å›¾ç‰‡æä¾›è€… <a href="https://unsplash.com/@son_of_media" target="_blank">Dylan McLeod</a>
                        
                    </span>
                    
        </div>
    </div>
    
    <div class="filter"></div>
    <div class="post-cover"
        style="background: url('https://i.lisz.top/cover/mkLyvk.webp') center no-repeat; background-size: cover;"></div>
    
</div>

<main class="post-content visible">
    
    <h2 class="post-subtitle">Kubernetes åŸºç¡€å¹³å°çš„æ­å»º</h2>
    

    

    <div class="container">
        
<div class="submenu hidden">

</div>
        <div class="contents">
            <article class="markdown-body post">
                


                <h2 id="å‰è¨€">å‰è¨€</h2>

<p>â€ƒâ€ƒWeb åº”ç”¨çš„ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²éšç€æŠ€æœ¯çš„å‘å±•ä¸æ–­åœ°å‘ç”Ÿæ”¹å˜ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œä»æœ€æ—©æœŸçš„å•æœºç¯å¢ƒåˆ°å¤šæœºç¯å¢ƒï¼Œå†å‘å±•åˆ°å¤æ‚ç¯å¢ƒï¼š</p>

<ul>
  <li>
<strong>å•æœºç¯å¢ƒ</strong>æŒ‡çš„æ˜¯ä»£ç ã€è¿è¡Œç¯å¢ƒã€æ–‡ä»¶å­˜å‚¨ã€æ•°æ®åº“æœåŠ¡éƒ½åœ¨åŒä¸€å°æœåŠ¡å™¨ä¸Šçš„åº”ç”¨éƒ¨ç½²æ–¹å¼ã€‚é€šå¸¸æ¥è¯´ï¼Œä¸ªäººåº”ç”¨æˆ–è€…æ—©æœŸ Demo åº”ç”¨å¤§å¤šé‡‡ç”¨è¿™ç±»æ–¹å¼ã€‚å•æœºç¯å¢ƒçš„ä¼˜ç‚¹åœ¨äºä¸éœ€è¦å¤ªå¤šæœåŠ¡å™¨èµ„æºï¼Œç¼ºç‚¹åœ¨äºè¿‡åˆ†ä¾èµ–æœ¬åœ°èµ„æºè€Œæ²¡æœ‰é«˜å¯ç”¨æ€§ã€é«˜å¯æ‰©å±•æ€§ä»¥åŠæ•°æ®çš„å®‰å…¨ä¿éšœã€‚å¦‚æœæ˜¯äº‘æœåŠ¡å™¨ä½œä¸ºå•æœºç¯å¢ƒï¼Œå¯ä»¥é€šè¿‡å‡çº§é…ç½®çš„æ–¹å¼æ¥æé«˜ CPUã€å†…å­˜å’Œå­˜å‚¨èµ„æºã€‚è‡³äºæ•°æ®åˆ™å¯ä»¥é€šè¿‡å¼‚æœºå¤‡ä»½æˆ–æœ¬åœ°å¤‡ä»½çš„æ–¹å¼æ¥ä¿éšœæ•°æ®çš„å¯é æ€§ã€‚</li>
  <li>
<strong>å¤šæœºç¯å¢ƒ</strong>æŒ‡çš„æ˜¯åŒä¸€åº”ç”¨æ‰€éœ€çš„è¿è¡Œç¯å¢ƒã€æ•°æ®åº“æœåŠ¡ã€æ–‡ä»¶å­˜å‚¨æœåŠ¡åˆ†å¸ƒåœ¨ä¸åŒçš„èŠ‚ç‚¹æˆ–é›†ç¾¤ä¸­çš„åº”ç”¨éƒ¨ç½²æ–¹å¼ã€‚è¿™ç±»æ–¹å¼çš„ä¼˜ç‚¹è‡ªç„¶æ˜¯å…·å¤‡é«˜å¯ç”¨æ€§ã€é«˜å¯æ‰©å±•æ€§ä»¥åŠå®Œå¤‡çš„æ•°æ®å®‰å…¨ä¿éšœï¼Œç¼ºç‚¹åˆ™æ˜¯éœ€è¦å¤§é‡çš„æœåŠ¡å™¨èµ„æºã€‚å› æ­¤ï¼Œå¤šæœºç¯å¢ƒé€šå¸¸æ˜¯å¯¹å¤–å¤§é‡ç”¨æˆ·æä¾›æœåŠ¡æ—¶å¸¸ç”¨çš„æ–¹å¼ã€‚</li>
  <li>
<strong>å¤æ‚ç¯å¢ƒ</strong>æ‰“ç ´äº†åŸæœ‰çš„ç“¶ç“¶ç½ç½ï¼Œæ˜¯å¤šæœºç¯å¢ƒçš„ä¸€ç§çš„è¶…çº§å½¢æ€ã€‚åœ¨å¤æ‚ç¯å¢ƒä¸­ï¼Œä¸å†æ‹˜æ³¥äºæœåŠ¡å™¨èŠ‚ç‚¹æœ¬èº«ï¼Œè€Œæ˜¯åˆ©ç”¨ Web åº”ç”¨å°†å·²æœ‰çš„äº‘èµ„æºè”ç³»åœ¨ä¸€èµ·ã€‚è¯´å¾—æ›´ç›´ç™½ä¸€ç‚¹ï¼Œå°±æ˜¯åº”ç”¨å¼€å‘è€…ä¸å†éœ€è¦å…³å¿ƒåº”ç”¨è¿è¡Œç¯å¢ƒã€æ•°æ®åº“æœåŠ¡ã€æ–‡ä»¶å­˜å‚¨ç­‰åŸºç¡€ç¯å¢ƒçš„é…ç½®å’Œç®¡ç†ï¼Œå”¯ä¸€éœ€è¦å…³å¿ƒçš„åªæœ‰åº”ç”¨ä»£ç æœ¬èº«ã€‚è¿™ä¹Ÿæ˜¯ç°åœ¨å¤§éƒ¨åˆ† Web åº”ç”¨çš„çœŸå®éƒ¨ç½²æ–¹å¼ã€‚</li>
</ul>

<p>â€ƒâ€ƒè‡ªä»ä»£ç ç‰ˆæœ¬è·Ÿè¸ªè½¯ä»¶ Git æ¨ªç©ºå‡ºä¸–ä»¥æ¥ï¼Œé€æ­¥å½¢æˆäº†ä»¥ Git ä¸ºä¸­å¿ƒçš„<strong>æŒç»­å¼€å‘ã€æŒç»­é›†æˆå’ŒæŒç»­éƒ¨ç½²</strong>çš„ç°ä»£åº”ç”¨å¼€å‘æ–¹å¼ã€‚è¿™ä¸å¤æ‚ç¯å¢ƒçš„éƒ¨ç½²æ–¹å¼å®Œå…¨å¥‘åˆï¼Œç”±äº‘æœåŠ¡æä¾›å•†æ¥æä¾›å’Œç»´æŠ¤å„ç±»è¿è¡Œç¯å¢ƒã€æ•°æ®åº“æœåŠ¡å’Œæ–‡ä»¶å­˜å‚¨ï¼Œå¼€å‘å›¢é˜Ÿåªéœ€è¦ä¸“æ³¨äºå¯¹ä»£ç å­˜å‚¨åº“çš„ç®¡ç†ã€‚</p>

<p>â€ƒâ€ƒä¸¾ä¸ªä¾‹å­ï¼Œå½“æŸä¸ªå¼€å‘æˆå‘˜å®Œæˆäº†æŸä¸ªæ¨¡å—çš„å¼€å‘å¹¶æ¨é€åˆ°æŸä¸ªåˆ†æ”¯ï¼Œè¯¥åˆ†æ”¯åˆ›å»ºåä¼šè‡ªåŠ¨è§¦å‘æŒç»­é›†æˆè¿›è¡Œè‡ªåŠ¨ Reviewã€‚è‡ªåŠ¨ Review é€šè¿‡åï¼Œå¼€å‘å›¢é˜Ÿè´Ÿè´£äººå¯ä»¥å¯¹è¯¥åˆ†æ”¯çš„ä»£ç æ›´æ”¹è¿›è¡Œå®¡æ ¸ï¼Œé€šè¿‡åå…è®¸å°†è¯¥åˆ†æ”¯ä¸å…¶ä»–æŸä¸ªæŒ‡å®šåˆ†æ”¯è¿›è¡Œåˆå¹¶ï¼ˆåˆå¹¶æ“ä½œä¹Ÿæ˜¯é€šè¿‡æŒç»­é›†æˆè‡ªåŠ¨è¿›è¡Œï¼‰ã€‚å½“æ‰€æœ‰ä»£ç å¼€å‘å®Œæ¯•åï¼Œç”±æ€»è´Ÿè´£äººå®¡æ ¸æ±‡å…¥æœ€ç»ˆéƒ¨ç½²çš„åˆ†æ”¯ã€‚å®¡æ ¸é€šè¿‡åæŒç»­é›†æˆä¼šè‡ªåŠ¨åˆå¹¶ä»£ç å¹¶é€šè¿‡æŒç»­éƒ¨ç½²å°†å®Œæ•´çš„ä»£ç éƒ¨ç½²åˆ°çœŸå®çš„è¿è¡Œç¯å¢ƒä¸­ã€‚å¦‚ä»Šçš„ GitHubã€GitLab å‡èƒ½å®ŒæˆæŒç»­å¼€å‘ã€æŒç»­é›†æˆå’ŒæŒç»­éƒ¨ç½²çš„å…¨è¿‡ç¨‹ã€‚å½“ç„¶ï¼Œä¹Ÿæœ‰ä¸€äº›è½¯ä»¶ï¼ˆæ¯”å¦‚ <a href="https://www.jenkins.io/" rel="nofollow" target="_blank" class="extlinks">Jenkins</a> ç­‰ï¼‰å¯ä»¥å®ŒæˆæŒç»­é›†æˆå’ŒæŒç»­éƒ¨ç½²ä¸¤æ­¥ï¼Œè€ŒæŒç»­å¼€å‘åˆ™å¯ä»¥ä¾æ‰˜ä»»æ„çš„ Git æ‰˜ç®¡æœåŠ¡ã€‚</p>

<div class="premonition warning"> <div class="header"> <svg class="icon warning" aria-hidden="true"> <use xlink:href="#icon-warning"></use> </svg> <div class="title"> å‹æƒ…æé†’ </div> </div> <div class="content"> <p>â€ƒâ€ƒä»¥ä¸Šå™è¿°éä¸“ä¸šè§£é‡Šï¼Œä»…ä¸ºä¸ªäººçœ‹æ³•ï¼Œä¸å–œå‹¿å–·ã€‚Kubernetes å®˜æ–¹å°†éƒ¨ç½²æ–¹å¼åˆ†ä¸º<strong>ä¼ ç»Ÿéƒ¨ç½²</strong>ã€<strong>è™šæ‹ŸåŒ–éƒ¨ç½²</strong>å’Œ<strong>å®¹å™¨éƒ¨ç½²</strong>ä¸‰ç±»ã€‚</p>



 </div> </div>
<p><img src="https://i.lisz.top/blog/79is8s.webp" alt="(a) å•æœºç¯å¢ƒå’Œå¤šæœºç¯å¢ƒã€‚(b) å¤æ‚ç¯å¢ƒã€‚(c)ä»¥ Git ä¸ºä¸­å¿ƒçš„æŒç»­å¼€å‘ã€æŒç»­é›†æˆã€æŒç»­éƒ¨ç½²çš„ç°ä»£åº”ç”¨å¼€å‘æ–¹å¼ã€‚"></p>

<h3 id="å®ä¾‹è§£æ">å®ä¾‹è§£æ</h3>

<p>â€ƒâ€ƒå‡è®¾ä¸€ä¸ª Web åº”ç”¨åŒæ—¶éœ€è¦ä½¿ç”¨ï¼š</p>

<ul>
  <li>
<strong>è¿è¡Œç¯å¢ƒ</strong>ï¼šPHP è¿è¡Œç¯å¢ƒã€Python è¿è¡Œç¯å¢ƒã€NodeJS è¿è¡Œç¯å¢ƒã€‚</li>
  <li>
<strong>æ•°æ®åº“æœåŠ¡</strong>ï¼šå…³ç³»å‹æ•°æ®åº“ï¼ˆæ¯”å¦‚ MySQLï¼‰ã€éå…³ç³»å‹æ•°æ®åº“ï¼ˆæ¯”å¦‚ MongoDBï¼‰ã€ç¼“å­˜æ•°æ®åº“ï¼ˆæ¯”å¦‚ Redisï¼‰ã€‚</li>
  <li>
<strong>æ–‡ä»¶å­˜å‚¨</strong>ï¼šç”¨äºå­˜å‚¨ç”¨æˆ·å¤´åƒã€ä¸Šä¼ æ–‡ä»¶çš„å¯¹è±¡å­˜å‚¨ï¼ˆS3ï¼‰ã€ç”¨äºå­˜å‚¨è¿è¡Œä»£ç çš„æ–‡ä»¶å­˜å‚¨ï¼ˆæ¯”å¦‚ NFSï¼‰ã€‚</li>
  <li>
<strong>é«˜å¯ç”¨åº”ç”¨å…¥å£</strong>ï¼šæ¯”å¦‚ Nginxã€HaProxy ç­‰ã€‚</li>
</ul>

<p>â€ƒâ€ƒåœ¨å•æœºç¯å¢ƒä¸­ï¼ŒæŒ‰ç…§ä»¥å‰æˆ‘ä»¬ç¢°è§è¿™ç§è¦æ±‚å¯èƒ½å°±è¦å¤´å¤§äº†ï¼Œæ¯•ç«ŸåŒæ—¶é…ç½®è¿™ä¹ˆå¤šç¯å¢ƒéš¾å…ä¼šæœ‰ä¸å¯é¢„çŸ¥çš„é—®é¢˜ã€‚ä¸è¿‡ç°åœ¨ï¼Œå®¹å™¨åŒ–æŠ€æœ¯ï¼ˆæ¯”å¦‚ <a href="https://www.docker.com/" rel="nofollow" target="_blank" class="extlinks">Docker</a>ï¼‰å¯ä»¥å¸®åŠ©æˆ‘ä»¬å°†æ‰€æœ‰çš„éœ€æ±‚éƒ½æ‹†åˆ†æˆç‹¬ç«‹çš„ container å®ä¾‹ã€‚ä¸ä½†å¯ä»¥è®©å®ƒä»¬ä¹‹é—´åœ¨å†…éƒ¨ç½‘ç»œä¸­äº’é€šï¼Œè¿˜å¯ä»¥å¯¹å¤–åªæš´éœ²å¿…è¦çš„åº”ç”¨å…¥å£æ‰€éœ€çš„ <code class="language-plaintext highlighter-rouge">80</code> å’Œ <code class="language-plaintext highlighter-rouge">443</code> ç«¯å£ã€‚è¿™æ ·ä¸€æ¥ï¼Œæ—¢å°†å„é¡¹æœåŠ¡è¿›è¡Œäº†åˆç†æ‹†åˆ†ï¼Œåˆèƒ½ä¿è¯åº”ç”¨æœåŠ¡çš„å®‰å…¨æ€§ã€‚å³ä½¿æ˜¯éœ€è¦å¯¹æŸä¸ªè¿è¡Œç¯å¢ƒæˆ–è€…æ•°æ®åº“æœåŠ¡è¿›è¡Œç‰ˆæœ¬å‡çº§ï¼Œä¹Ÿå¯ä»¥å¾ˆå®¹æ˜“åšåˆ°ã€‚</p>

<p>â€ƒâ€ƒåœ¨å¤šæœºç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬å¦‚æœè¿˜æƒ³ç”¨å®¹å™¨åŒ–æŠ€æœ¯ï¼Œé‚£å°±å¿…é¡»ç”¨å®¹å™¨åŒ–é›†ç¾¤ã€‚å¾ˆä¹…ä»¥å‰ï¼ŒDocker å®˜æ–¹å°±æä¾›äº†ä¸€ç§ Swarm æ¨¡å¼æ¥ç»„æˆå®¹å™¨åŒ–é›†ç¾¤ã€‚è¿™ç§æ–¹å¼çš„å¥½å¤„æ˜¯éå¸¸ç®€å•é…ç½®ã€è½»é‡æ˜“ç”¨ï¼Œå¯¹äºç†Ÿæ‚‰ä½¿ç”¨ Docker çš„å¼€å‘è€…æ¥è¯´åªéœ€è¦èŠ±å¾ˆå°‘çš„æ—¶é—´å°±èƒ½ææ˜ç™½ã€‚ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼ŒDocker Swarm ä¾èµ–äº Docker APIã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒDocker æœ¬èº«ä¸æ”¯æŒçš„ä¸œè¥¿è¿˜æ˜¯ä¸æ”¯æŒï¼Œæ¯”å¦‚æ›´åŠ é«˜æ•ˆå®‰å…¨çš„ç½‘ç»œã€èŠ±å¼å¤šæ ·çš„å­˜å‚¨ç­‰ã€‚ä¸ºäº†èƒ½å¤Ÿæ›´å¥½è·¨ä¸»æœºé›†ç¾¤åœ°è‡ªåŠ¨éƒ¨ç½²ã€æ‰©å±•ä»¥åŠè¿è¡Œåº”ç”¨ç¨‹åºå®¹å™¨ï¼Œæˆ‘ä»¬é€‰æ‹©ä½¿ç”¨ <a href="https://kubernetes.io/zh-cn/" rel="nofollow" target="_blank" class="extlinks">Kubernetes</a>ï¼ˆç¼©å†™ä¸º <strong>K8S</strong>ï¼‰ã€‚</p>

<div class="premonition info"> <div class="header"> <svg class="icon info" aria-hidden="true"> <use xlink:href="#icon-info"></use> </svg> <div class="title"> å°çŸ¥è¯† </div> </div> <div class="content"> <p>â€ƒâ€ƒåœ¨ 2014 å¹´ Google å¼€æºäº† Kubenetes é¡¹ç›®ï¼Œåæ¥åˆè´¡çŒ®ç»™äº†äº‘åŸç”Ÿè®¡ç®—åŸºé‡‘ä¼š <a href="https://www.cncf.io/" rel="nofollow" target="_blank" class="extlinks">CNCF</a>ã€‚å¾ˆå¤šå…¬å¸ä»¥ Kubernetes ä¸ºåŸºç¡€å¼€å‘äº†è‡ªå®¶çš„å®¹å™¨åŒ–é›†ç¾¤å¹³å°ï¼Œæ¯”å¦‚ RedHat çš„ <a href="https://www.redhat.com/en/technologies/cloud-computing/openshift" rel="nofollow" target="_blank" class="extlinks">OpenShift</a>ï¼ŒAWS çš„ <a href="https://aws.amazon.com/cn/eks/" rel="nofollow" target="_blank" class="extlinks">Elastic Kubenetes Services, EKS</a>ï¼ŒAzure çš„ <a href="https://azure.microsoft.com/zh-cn/products/kubernetes-service" rel="nofollow" target="_blank" class="extlinks">Azure Kubernetes Services, AKS</a>ï¼Œé˜¿é‡Œäº‘çš„ <a href="https://www.aliyun.com/product/kubernetes" rel="nofollow" target="_blank" class="extlinks">Aliyun Container Service for Kubernetes, ACK</a>ï¼Œè…¾è®¯äº‘çš„ <a href="https://cloud.tencent.com/product/tke" rel="nofollow" target="_blank" class="extlinks">Tencent Kubernetes Engine, TKE</a> ç­‰ã€‚</p>



 </div> </div>
<h2 id="kubernetes-æ¶æ„">Kubernetes æ¶æ„</h2>

<p>â€ƒâ€ƒè™½ç„¶ Kubernetes å®˜æ–¹æ–‡æ¡£å·²ç»å°†æ¶æ„å›¾ä»¥åŠç›¸å…³æ¦‚å¿µä»‹ç»å¾—éå¸¸æ¸…æ¥šï¼Œä½†è¿˜æ˜¯æƒ³è¯´è¯´è‡ªå·±çš„ç†è§£ã€‚ç±»ä¼¼äºä¸€èˆ¬é›†ç¾¤å¹³å°ï¼ŒK8S ä¹Ÿéœ€è¦æœ‰è‡³å°‘ä¸€ä¸ªæ§åˆ¶èŠ‚ç‚¹ï¼ˆå®˜æ–¹ç§°ä¹‹ä¸ºâ€œæ§åˆ¶å¹³é¢â€ï¼‰å’Œä¸€ä¸ªå·¥ä½œèŠ‚ç‚¹ã€‚é»˜è®¤æ¥è¯´ï¼ŒK8S <strong>ä¸æ¨èæ§åˆ¶èŠ‚ç‚¹åŒæ—¶ä½œä¸ºå·¥ä½œèŠ‚ç‚¹</strong>ï¼Œå› ä¸ºè¿™ä¼šå½±å“é›†ç¾¤è°ƒåº¦çš„å¯é æ€§å’Œå¯ç”¨æ€§ã€‚ä»ä¸‹é¢çš„é‡ç»˜æ¶æ„å›¾å¯ä»¥çœ‹å‡ºï¼ŒK8S é›†ç¾¤ä¼šå¯¹å¤–æä¾› API ä»¥ä¾›ç”¨æˆ·ä»é›†ç¾¤å¤–è¿›è¡Œè°ƒåº¦ã€‚åœ¨é›†ç¾¤å†…éƒ¨ï¼Œå·¥ä½œèŠ‚ç‚¹é€šè¿‡ kubelet æœåŠ¡ä¸æ§åˆ¶èŠ‚ç‚¹ç›´æ¥è¿æ¥ï¼Œæ§åˆ¶èŠ‚ç‚¹ä¹Ÿé€šè¿‡ kubelet æœåŠ¡å‘å·¥ä½œèŠ‚ç‚¹ä¸‹è¾¾è°ƒåº¦æŒ‡ä»¤æ¥ç®¡ç†å·¥ä½œèŠ‚ç‚¹ä¸Šçš„ podã€‚</p>

<div class="premonition note"> <div class="header"> <svg class="icon note" aria-hidden="true"> <use xlink:href="#icon-note"></use> </svg> <div class="title"> Pod çš„æ¦‚å¿µ </div> </div> <div class="content"> <p>â€ƒâ€ƒPod å¯ä»¥ç†è§£ä¸º K8S ä¸­åº”ç”¨çš„æœ€å°å•ä½ï¼Œä¸€ä¸ª Pod ä¸­å¯èƒ½ä¼šåŒ…æ‹¬ä¸€ä¸ªæˆ–å¤šä¸ª container (å®¹å™¨)ï¼Œè¿™äº›å®¹å™¨é—´å¯ä»¥äº’é€šï¼Œä½†å¯¹å¤–åªæœ‰ Pod æœ‰èµ„æ ¼æ‹¥æœ‰ IPã€‚è¿™æœ‰ç‚¹ç±»ä¼¼äºè¿›ç¨‹ä¸çº¿ç¨‹ä¹‹é—´çš„å…³ç³»ï¼Œè¿›ç¨‹æ˜¯æ‹¥æœ‰èµ„æºçš„æœ€å°å•ä½ï¼Œçº¿ç¨‹ä¾èµ–äºè¿›ç¨‹è€Œå­˜åœ¨ï¼ŒåŒä¸€è¿›ç¨‹é—´çš„çº¿ç¨‹é—´å¯ä»¥æ— éšœç¢é€šä¿¡ï¼Œè€Œä¸åŒè¿›ç¨‹é—´çš„é€šä¿¡åˆ™éœ€è¦é€šè¿‡ç«¯å£æˆ– socket æ¥è¿›è¡Œã€‚</p>

<p>â€ƒâ€ƒåŒä¸€ä¸ªå·¥ä½œèŠ‚ç‚¹ä¸Šçš„ Pod çš„ IP å±äºåŒä¸€ä¸ªå­ç½‘ï¼Œä¸åŒå·¥ä½œèŠ‚ç‚¹çš„å­ç½‘åˆå±äºåŒä¸€ä¸ªå¤§å­ç½‘ (podSubnetï¼Œä¸€èˆ¬éœ€è¦åœ¨åˆå§‹åŒ–é›†ç¾¤æ—¶å®šä¹‰)ã€‚è¿™æ ·çš„è®¾è®¡åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå‡å°‘äº† IP ç®¡ç†çš„éš¾åº¦ï¼Œå¹¶ä¸”èƒ½å¤Ÿæœ€å¤§ç¨‹åº¦ä¸Šå‡å°‘å®¹å™¨æš´éœ²çš„é£é™©ã€‚</p>



 </div> </div>
<p><img src="https://i.lisz.top/blog/BV7Jqo.webp" alt="é‡ç»˜ Kubernetes å®˜æ–¹æ–‡æ¡£æ¶æ„å›¾"></p>

<div class="premonition note"> <div class="header"> <svg class="icon note" aria-hidden="true"> <use xlink:href="#icon-note"></use> </svg> <div class="title"> CRI çš„æ¦‚å¿µ </div> </div> <div class="content"> <p>â€ƒâ€ƒCRIï¼Œå…¨åä¸º Container Runtime Interfaceï¼ˆå®¹å™¨è¿è¡Œæ—¶æ¥å£ï¼‰ï¼Œæ˜¯ K8S æ¶æ„ä¸­ kubeletå’Œå®¹å™¨è¿è¡Œæ—¶é€šä¿¡çš„ä¸»è¦åè®®ã€‚æˆ‘ä»¬æ‰€ç†ŸçŸ¥çš„ Docker å°±æ˜¯ä¸€ç§å®¹å™¨è¿è¡Œæ—¶ï¼Œä½†æ˜¯è‡ªä» K8S 1.20 ç‰ˆæœ¬å¼ƒç”¨ Docker è‡ªå¸¦çš„å®¹å™¨è¿è¡Œæ—¶æ¥å£ Dockershim ä»¥æ¥ï¼Œæˆ‘ä»¬åªèƒ½ä½¿ç”¨é¢å¤–çš„ CRI â€“ <a href="https://github.com/Mirantis/cri-dockerd" rel="nofollow" target="_blank" class="extlinks">cri-dockerd</a> æ¥è°ƒç”¨ Dockerã€‚å› æ­¤æ¨èä½¿ç”¨åŒ…å« CRI çš„å®¹å™¨è¿è¡Œæ—¶ <a href="https://containerd.io/" rel="nofollow" target="_blank" class="extlinks">containerd</a> æˆ–è€… <a href="https://cri-o.io/" rel="nofollow" target="_blank" class="extlinks">cri-o</a> æ¥æ›¿ä»£ Dockerã€‚</p>



 </div> </div>
<h3 id="ç»„æˆéƒ¨åˆ†">ç»„æˆéƒ¨åˆ†</h3>

<p>â€ƒâ€ƒç”±äº K8S æ˜¯ä¸€æ¬¾å¹³å°æ— å…³çš„å®¹å™¨é›†ç¾¤æ–¹æ¡ˆï¼Œæ‰€ä»¥å®˜æ–¹æä¾›çš„æ–¹æ¡ˆåªæ˜¯ä¸€ä¸ªæ•´ä½“ï¼Œæˆ‘ä»¬éœ€è¦è‡ªè¡Œé€‰æ‹©ä»¥ä¸‹å„é¡¹ç»„ä»¶ï¼š</p>

<ul>
  <li>
<strong>å®¹å™¨è¿è¡Œæ—¶ (CRI)</strong>ï¼šå¦‚ä¸Šæ‰€è¿°ï¼Œæ¨èä½¿ç”¨ containerd æˆ–è€… cri-o æ¥æ›¿ä»£ dockerã€‚ä¸‹é¢å®è·µéƒ¨åˆ†å°†ä»¥ containerd ä¸ºä¾‹ã€‚</li>
  <li>
<strong>ç½‘ç»œç»„ä»¶ (CNI, Container Network Interface)</strong>ï¼šK8S ä¸­ç½‘ç»œæœ‰ä¸‰ç§ Nodeã€Podã€Serviceï¼Œå…¶ä¸­ Node IP æ˜¯èŠ‚ç‚¹çš„ IPï¼Œç”¨äºè¿é€šæˆ–è€…æš´éœ²ç«¯å£ã€‚Pod IP æ˜¯ Pod çš„ç‹¬ç«‹å†…ç½‘ IPï¼Œåªèƒ½åœ¨ K8S é›†ç¾¤é—´è®¿é—®ã€‚Service IP æ˜¯å¤šä¸ª Pod å…±åŒç»„æˆ Service åéœ€è¦äº’é€šæ—¶ä½¿ç”¨çš„ï¼Œä¸€èˆ¬ä»…åœ¨ Service å†…éƒ¨å¯è®¿é—®ï¼Œä¸èƒ½è¢«ç”¨æˆ·è®¿é—®ã€‚K8S å®˜æ–¹æ–‡æ¡£ä¸­ <a href="https://kubernetes.io/zh-cn/docs/concepts/cluster-administration/addons/#networking-and-network-policy" rel="nofollow" target="_blank" class="extlinks">è”ç½‘å’Œç½‘ç»œç­–ç•¥</a> åˆ—ä¸¾äº†å¾ˆå¤šå¯ç”¨çš„ CNIï¼Œè¿™é‡Œæˆ‘ä»¬é€‰ç”¨ <a href="https://www.tigera.io/project-calico/" rel="nofollow" target="_blank" class="extlinks">Calico</a> æ¥è¿›è¡Œå®è·µã€‚</li>
  <li>
<strong>æœåŠ¡å‘ç° (DNS)</strong>ï¼šé»˜è®¤ä¸º <a href="https://coredns.io/" rel="nofollow" target="_blank" class="extlinks">CoreDNS</a>ï¼Œåœ¨é…ç½®å®Œç½‘ç»œç»„ä»¶åè‡ªåŠ¨åˆ›å»ºï¼Œä¸º Pod æä¾› DNS è§£ææœåŠ¡ï¼ŒåŒ…æ‹¬å…¬ç½‘åŸŸåè§£æå’Œ Service åˆ«åè§£æã€‚</li>
  <li>
<strong>å®¹å™¨å­˜å‚¨æ¥å£ (CSI, Container Storage Interface)</strong>ï¼šç›®å‰ K8S åŸºæœ¬ä¸Šç§»é™¤äº†å¤§éƒ¨åˆ†çš„ç¬¬ä¸‰æ–¹è½¯ä»¶ç›¸å…³å­˜å‚¨æ’ä»¶ï¼Œè½¬è€Œé€šè¿‡ç¬¬ä¸‰æ–¹è‡ªè¡Œç»´æŠ¤çš„ CSI æ¥æ‰©å……å­˜å‚¨ç±»çš„æ”¯æŒã€‚å¯ä»¥é€šè¿‡æŸ¥çœ‹ K8S å®˜ç½‘æ–‡æ¡£çš„ <a href="https://kubernetes.io/zh-cn/docs/concepts/storage/storage-classes/#provisioner" rel="nofollow" target="_blank" class="extlinks">å­˜å‚¨åˆ¶å¤‡å™¨</a> å’Œ kubernetes-csi çš„ <a href="https://kubernetes-csi.github.io/docs/drivers.html" rel="nofollow" target="_blank" class="extlinks">Drivier</a> æ¥äº†è§£æ›´å¤šã€‚è¿™é‡Œæˆ‘ä»¬é€‰ç”¨ NFS çš„ CSI Driver ä½œä¸ºä¾‹å­è¿›è¡Œå®è·µã€‚</li>
</ul>

<h2 id="æ­å»º-k8s-é›†ç¾¤">æ­å»º K8S é›†ç¾¤</h2>

<p>â€ƒâ€ƒåœ¨å­¦ä¹ ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <a href="https://kind.sigs.k8s.io/" rel="nofollow" target="_blank" class="extlinks">kind</a>ã€<a href="https://minikube.sigs.k8s.io/" rel="nofollow" target="_blank" class="extlinks">minikube</a> æˆ–è€… kubeadm åœ¨æœ¬åœ°å¿«é€Ÿéƒ¨ç½² K8S é›†ç¾¤ï¼›åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <a href="https://kops.sigs.k8s.io/" rel="nofollow" target="_blank" class="extlinks">kops</a>ã€<a href="https://kubespray.io/" rel="nofollow" target="_blank" class="extlinks">Kubespray</a> æˆ–è€… kubeadm åœ¨å¤šèŠ‚ç‚¹ä¸Šå¿«é€Ÿéƒ¨ç½² K8S é›†ç¾¤ã€‚æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬é‡‡ç”¨äº†é€šç”¨çš„ kubeadm æ¥æ­å»º K8S é›†ç¾¤ã€‚</p>

<p>â€ƒâ€ƒåœ¨æ­£å¼éƒ¨ç½²ä¹‹å‰éœ€è¦è§„åˆ’å®é™…æ¶æ„ã€åšä¸€äº›åŸºæœ¬å‡†ç¡®ä»¥åŠå®‰è£…å¿…è¦çš„è½¯ä»¶å’Œå·¥å…· â€“ <code class="language-plaintext highlighter-rouge">kubelet</code>ï¼Œ<code class="language-plaintext highlighter-rouge">kubectl</code> å’Œ <code class="language-plaintext highlighter-rouge">kubeadm</code>ã€‚ä¸‹å›¾ä¸ºæœ¬å®è·µè§„åˆ’çš„ NodeSubsetã€PodSubset å’Œ ServiceSubsetã€‚</p>

<p><img src="https://i.lisz.top/blog/Z0hCRO.webp" alt="K8S é›†ç¾¤å®é™…æ¶æ„å’Œç½‘ç»œè§„åˆ’"></p>

<h3 id="åŸºæœ¬å‡†å¤‡">åŸºæœ¬å‡†å¤‡</h3>

<h4 id="å…³é—­-swap-äº¤æ¢åˆ†åŒº">å…³é—­ SWAP äº¤æ¢åˆ†åŒº</h4>

<p>â€ƒâ€ƒK8S ä¸ºäº†æ€§èƒ½è€ƒè™‘é»˜è®¤å¿…é¡»å…³é—­ SWAP äº¤æ¢åˆ†åŒºï¼Œè€Œé€šå¸¸å®ä½“æœåŠ¡å™¨å®‰è£…åä¼šæœ‰ SWAP äº¤æ¢åˆ†åŒºï¼Œäº‘æœåŠ¡å™¨æˆ– VPS æ²¡æœ‰ã€‚é€šè¿‡ <code class="language-plaintext highlighter-rouge">sudo swapoff -a</code> å‘½ä»¤å¯ä»¥ä¸´æ—¶å…³é—­ SWAP åˆ†åŒºï¼Œæˆ–è€…é€šè¿‡æ³¨é‡Š <code class="language-plaintext highlighter-rouge">/etc/fstab</code> æ–‡ä»¶ä¸­çš„ <code class="language-plaintext highlighter-rouge">swap.img</code> è¿™ä¸€è¡Œå¹¶é‡å¯æœåŠ¡å™¨æ°¸ä¹…å…³é—­ SWAP äº¤æ¢åˆ†åŒºã€‚</p>

<h4 id="å¼€å¯-ipv4-è½¬å‘">å¼€å¯ IPv4 è½¬å‘</h4>

<p>â€ƒâ€ƒç”±äº K8S é›†ç¾¤ä¸­åŒä¸€ä¸ª Service çš„ Pod å¯èƒ½è¢«åˆ†é…åˆ°ä¸åŒèŠ‚ç‚¹ï¼Œé‚£ä¹ˆä¸åŒèŠ‚ç‚¹é—´çš„ Pod é€šä¿¡æ˜¯éå¸¸å¿…è¦çš„ï¼Œå³ä¸åŒ PodSubnet ä¹‹é—´çš„é€šä¿¡éœ€è¦é€šè¿‡ Node IP æ¥è¿›è¡Œ IPv4 è½¬å‘ã€‚æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ·»åŠ å…è®¸ IPv4 è½¬å‘åˆ° <code class="language-plaintext highlighter-rouge">/etc/sysctl.d/k8s.conf</code> æ–‡ä»¶é‡Œï¼Œå¹¶ä¸”ç«‹å³ç”Ÿæ•ˆï¼š</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># æ·»åŠ é…ç½®</span>
<span class="nb">sudo tee</span> <span class="nt">-a</span> /etc/sysctl.d/k8s.conf <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh">
net.ipv4.ip_forward = 1
net.bridge.bridge-nf-call-iptables = 1
net.bridge.bridge-nf-call-ip6tables = 1
</span><span class="no">EOF

</span><span class="c"># ç«‹å³ç”Ÿæ•ˆ</span>
<span class="nb">sudo </span>sysctl <span class="nt">--system</span>
</code></pre></div></div>

<h4 id="é…ç½®ä¸»æœºåå¯¹åº”">é…ç½®ä¸»æœºåå¯¹åº”</h4>

<p>â€ƒâ€ƒK8S é›†ç¾¤åˆå§‹åŒ–æ—¶ä¼šè‡ªåŠ¨æœç´¢ä¸»æœºåçš„ DNS è§£æï¼Œç›®å‰æµ‹è¯•çš„ä¸»æœºåæ²¡æœ‰å®Œæ•´çš„ FQDN æˆ– PTR è§£æï¼Œå› æ­¤æœ‰å¿…è¦è®¾ç½®å¥½ä¸»æœºåå’Œ IP å¯¹åº”ä¿¡æ¯åˆ°æœ¬åœ°é™æ€ DNS è§£ææ–‡ä»¶ <code class="language-plaintext highlighter-rouge">/etc/hosts</code> ä¸­ã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># åˆ†åˆ«åœ¨ä¸åŒèŠ‚ç‚¹æ ¹æ®è§„åˆ’è®¾ç½®å¥½ä¸»æœºå</span>
<span class="nb">sudo </span>hostnamectl set-hostname vm01
<span class="nb">sudo </span>hostnamectl set-hostname vm02
<span class="nb">sudo </span>hostnamectl set-hostname vm03

<span class="c"># ä¿®æ”¹æ‰€æœ‰èŠ‚ç‚¹çš„ /etc/hosts</span>
<span class="nb">sudo tee</span> <span class="nt">-a</span> /etc/hosts <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh">
192.168.120.1  vm01
192.168.120.2  vm02
192.168.120.3  vm03
</span><span class="no">EOF
</span></code></pre></div></div>

<h4 id="åŒæ­¥æ—¶é—´">åŒæ­¥æ—¶é—´</h4>

<p>â€ƒâ€ƒK8S é›†ç¾¤çš„è¿è¡Œå¿…é¡»ä¿è¯èŠ‚ç‚¹çš„æ—¶é—´æ˜¯å®Œå…¨åŒæ­¥çš„ï¼Œå¦åˆ™å®¹æ˜“é€ æˆæŸäº›æœªçŸ¥çš„ Bugã€‚æ¯”å¦‚è¯ä¹¦çš„è¿‡æœŸæ—¶é—´å°†ä¼šè¢«æŸäº›æ—¶é—´ä¸åŒæ­¥çš„èŠ‚ç‚¹é”™è¯¯åˆ¤æ–­ã€‚æ¨èä½¿ç”¨åŒä¸€æ—¶åŒºå’ŒåŒä¸€ NTP æœåŠ¡å™¨ï¼Œå¦‚ä¸‹å³å¯å®Œæˆè®¾ç½®ã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># è®¾ç½®ç›¸åŒæ—¶åŒºå¹¶æŸ¥çœ‹</span>
<span class="nb">sudo </span>timedatectl set-timezone Asia/Shanghai
timedatectl
timedatectl status

<span class="c"># ä¿®æ”¹ NTP æœåŠ¡å™¨</span>
<span class="nb">sudo </span>timedatectl set-ntp <span class="nb">false
sudo sed</span> <span class="nt">-i</span> <span class="s1">'s/#NTP=/NTP=ntp.lisz.top/'</span> /etc/systemd/timesyncd.conf
<span class="nb">sudo sed</span> <span class="nt">-i</span> <span class="s1">'s/#FallbackNTP=ntp.ubuntu.com/FallbackNTP=ntp.aliyun.com/'</span> /etc/systemd/timesyncd.conf
<span class="nb">sudo </span>timedatectl set-ntp <span class="nb">true</span>

<span class="c"># é‡å¯æœåŠ¡ä½¿é…ç½®ç”Ÿæ•ˆã€åŒæ­¥æ—¶é—´å¹¶æŸ¥çœ‹ä¿¡æ¯</span>
<span class="nb">sudo </span>systemctl restart systemd-timesyncd
timedatectl show-timesync <span class="nt">--all</span>
<span class="nb">date</span>
</code></pre></div></div>

<h3 id="å®‰è£…å¿…è¦è½¯ä»¶å’Œå·¥å…·">å®‰è£…å¿…è¦è½¯ä»¶å’Œå·¥å…·</h3>

<h4 id="å®‰è£…-containerd">å®‰è£… containerd</h4>

<p>â€ƒâ€ƒcontainerd è™½ç„¶æ˜¯ç”±  containerd å¼€å‘å›¢é˜Ÿè´Ÿè´£å‘å¸ƒï¼Œä½†æ˜¯ APT æˆ– YUM é•œåƒæºä»ç„¶æ˜¯ç”± Docker å®˜æ–¹è´Ÿè´£ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬æ·»åŠ  docker-ce çš„é•œåƒæºåå¯ä»¥ç›´æ¥ä¸‹è½½ <code class="language-plaintext highlighter-rouge">containerd.io</code> æ¥å®‰è£… containerdã€‚å½“ç„¶ï¼Œ æˆ‘ä»¬å¯ä»¥ä» <a href="https://github.com/containerd/containerd/releases" rel="nofollow" target="_blank" class="extlinks">containerd/containerd</a> ç›´æ¥ä¸‹è½½äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># æ·»åŠ é•œåƒæº</span>
curl <span class="nt">-fsSL</span> https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/ubuntu/gpg | <span class="nb">sudo </span>gpg <span class="nt">--dearmor</span> <span class="nt">-o</span> /etc/apt/trusted.gpg.d/docker.gpg
<span class="nb">sudo tee</span> <span class="nt">-a</span> /etc/apt/sources.list.d/docker.list <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh">
    deb [arch=amd64 signed-by=/etc/apt/trusted.gpg.d/docker.gpg] https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/ubuntu/ </span><span class="si">$(</span>lsb_release <span class="nt">-c</span> <span class="nt">--short</span><span class="si">)</span><span class="sh"> stable
</span><span class="no">EOF

</span><span class="c"># æ›´æ–°è½¯ä»¶åˆ—è¡¨ç¼“å­˜å¹¶å®‰è£… containerd</span>
<span class="nb">sudo </span>apt update <span class="o">&amp;&amp;</span> <span class="nb">sudo </span>apt upgrade <span class="nt">-y</span> <span class="o">&amp;&amp;</span> <span class="nb">sudo </span>apt <span class="nb">install</span> <span class="nt">-y</span> containerd.io
</code></pre></div></div>

<div class="premonition info"> <div class="header"> <svg class="icon info" aria-hidden="true"> <use xlink:href="#icon-info"></use> </svg> <div class="title"> å°å»ºè®® </div> </div> <div class="content"> <p>â€ƒâ€ƒä¸ªäººæ¨èä½¿ç”¨ APT æˆ– YUM æ–¹å¼å®‰è£… containerdã€‚åŸå› æœ‰äºŒï¼šä¸€æ˜¯å›½å†…æœ‰ docker-ce é•œåƒå®‰è£…æ¯”è¾ƒå¿«ï¼ŒäºŒæ˜¯æƒ³è¦æ›´æ–°æ—¶éå¸¸å®¹æ˜“ã€‚</p>



 </div> </div>
<h4 id="é…ç½®-containerd">é…ç½® containerd</h4>

<p>â€ƒâ€ƒcontainerd å®‰è£…åé»˜è®¤æ²¡æœ‰é…ç½®æ–‡ä»¶ä¹Ÿä¸ä¼šè‡ªåŠ¨å¯åŠ¨åå°ç¨‹åºï¼Œæ‰€ä»¥éœ€è¦å‡†å¤‡é…ç½®æ–‡ä»¶å¹¶å¤åˆ¶åˆ° <code class="language-plaintext highlighter-rouge">/etc/containerd/config.toml</code> å†å¯åŠ¨ã€‚ç”±äº K8S é›†ç¾¤é»˜è®¤ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">registry.k8s.io</code> å’Œ <code class="language-plaintext highlighter-rouge">registry-1.docker.io</code> æºä¸‹è½½å®¹å™¨é•œåƒï¼Œä¸ºäº†æå‡é€Ÿåº¦å»ºè®®åˆ‡æ¢åˆ°é˜¿é‡Œäº‘å’Œ DaoCloud çš„åŠ é€Ÿå™¨ã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>containerd config default <span class="o">&gt;</span> containerd_config.toml
<span class="nb">sed</span> <span class="nt">-i</span> <span class="s2">"s#registry.k8s.io#registry.cn-hangzhou.aliyuncs.com/google_containers#g"</span> containerd_config.toml
<span class="nb">sed</span> <span class="nt">-i</span> <span class="s2">"/containerd.runtimes.runc.options/a</span><span class="se">\ \ \ \ \ \ \ \ \ \ \ \ </span><span class="s2">SystemdCgroup = true"</span> containerd_config.toml
<span class="nb">sed</span> <span class="nt">-i</span> <span class="s2">"s#https://registry-1.docker.io#https://docker.m.daocloud.io#g"</span> containerd_config.toml

<span class="nb">sudo mkdir</span> <span class="nt">-p</span> /etc/containerd
<span class="nb">cp </span>containerd_config.toml /etc/containerd/config.toml

<span class="nb">sudo </span>systemctl daemon-reload
<span class="nb">sudo </span>systemctl <span class="nb">enable </span>containerd
<span class="nb">sudo </span>systemctl restart containerd

<span class="nb">sudo </span>systemctl status containerd.service <span class="o">&amp;&amp;</span> <span class="nb">sudo </span>ctr <span class="nt">--version</span>
</code></pre></div></div>

<div class="premonition info"> <div class="header"> <svg class="icon info" aria-hidden="true"> <use xlink:href="#icon-info"></use> </svg> <div class="title"> å°æç¤º </div> </div> <div class="content"> <p>â€ƒâ€ƒç”±äº <code class="language-plaintext highlighter-rouge">ctr</code> å‘½ä»¤è¿æ¥çš„ containerd çš„ socket æ–‡ä»¶åªæœ‰ root ç”¨æˆ·ç»„æœ‰æƒé™è®¿é—®ï¼Œæ‰€ä»¥ç›®å‰åªèƒ½ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">sudo ctr</code>ã€‚å¦‚æœæƒ³è¦ç›´æ¥ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">ctr</code> å‘½ä»¤ï¼Œå¯ä»¥ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">sudo usermod -aG root ubuntu</code> æ¥å°†å½“å‰ç”¨æˆ·æ·»åŠ åˆ° root ç”¨æˆ·ç»„ã€‚èµ‹æƒä¹‹åéœ€é€€å‡ºç™»å½•åå†æ¬¡ç™»å½•æ‰èƒ½ç”Ÿæ•ˆã€‚</p>



 </div> </div>
<h4 id="å®‰è£…-kubeadm-ç­‰">å®‰è£… kubeadm ç­‰</h4>

<p>â€ƒâ€ƒå›½å†…æ¸…åå¤§å­¦ TUNA é•œåƒæºã€é˜¿é‡Œäº‘é•œåƒæºç­‰éƒ½æä¾›äº† <code class="language-plaintext highlighter-rouge">kubeadm</code> ç­‰ä¸‰ä»¶å¥—å·¥å…·çš„ APT æˆ– YUM æºï¼Œé€šè¿‡ä»¥ä¸‹å‘½ä»¤å¯ä»¥å¾ˆå®¹æ˜“å®Œå…¨å®‰è£…ã€‚</p>

<div class="premonition warning"> <div class="header"> <svg class="icon warning" aria-hidden="true"> <use xlink:href="#icon-warning"></use> </svg> <div class="title"> å‹æƒ…æé†’ </div> </div> <div class="content"> <p>â€ƒâ€ƒç”±äº kubernetes ä¸åŒç‰ˆæœ¬å¯èƒ½ä¼šå­˜åœ¨è¾ƒå¤§å·®å¼‚ï¼Œå¹¶ä¸”ä¸ºäº†é¿å…èŠ‚ç‚¹ kubernetes ç‰ˆæœ¬åœ¨ä¸è‡ªè§‰çš„æ—¶å€™å‡çº§é€ æˆå…¼å®¹æ€§é—®é¢˜ï¼Œè¿™é‡Œæ¨èå›ºå®š kubeadm ç­‰ä¸‰ä»¶å¥—ç‰ˆæœ¬å·ï¼Œå³ä¸å¯ç”¨ <code class="language-plaintext highlighter-rouge">apt upgrade</code> è‡ªåŠ¨å‡çº§ã€‚ç®¡ç†å‘˜å…³é—­ K8S é›†ç¾¤æ‰‹åŠ¨å‡çº§ç‰ˆæœ¬æ—¶ä¸å—å½±å“ã€‚</p>



 </div> </div>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># æ·»åŠ é•œåƒæº</span>
curl <span class="nt">-fsSL</span> https://mirrors.tuna.tsinghua.edu.cn/kubernetes/core:/stable:/v1.30/deb/Release.key | <span class="nb">sudo </span>gpg <span class="nt">--dearmor</span> <span class="nt">-o</span> /etc/apt/keyrings/kubernetes-apt-keyring.gpg 
<span class="nb">sudo tee</span> <span class="nt">-a</span> /etc/apt/sources.list.d/kubernetes.list <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh">
deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://mirrors.tuna.tsinghua.edu.cn/kubernetes/core:/stable:/v1.30/deb/ / 
# deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://mirrors.tuna.tsinghua.edu.cn/kubernetes/addons:/cri-o:/stable:/v1.30/deb/ / 
</span><span class="no">EOF

</span><span class="c"># æ›´æ–°è½¯ä»¶åˆ—è¡¨ç¼“å­˜å¹¶å®‰è£… kubeadm ä¸‰ä»¶å¥—</span>
<span class="nb">sudo </span>apt update <span class="o">&amp;&amp;</span> <span class="nb">sudo </span>apt <span class="nb">install</span> <span class="nt">-y</span> kubeadm kubelet kubectl 

<span class="c"># å›ºå®š kubeadm ç­‰ä¸‰ä»¶å¥—ç‰ˆæœ¬</span>
<span class="nb">sudo </span>apt-mark hold kubeadm 
<span class="nb">sudo </span>apt-mark hold kubelet 
<span class="nb">sudo </span>apt-mark hold kubectl
</code></pre></div></div>

<h3 id="åˆå§‹åŒ–é›†ç¾¤">åˆå§‹åŒ–é›†ç¾¤</h3>

<h4 id="é¢„ä¸‹è½½é•œåƒ">é¢„ä¸‹è½½é•œåƒ</h4>

<p>â€ƒâ€ƒåœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æå‰ä¸‹è½½å¥½ K8S é›†ç¾¤æ‰€éœ€çš„åŸºæœ¬é•œåƒï¼Œé¿å…åˆå§‹åŒ–æ—¶ä¸€ç›´åœ¨ç­‰å¾…å„ä¸ªèŠ‚ç‚¹ä¸‹è½½é•œåƒã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubeadm config images list | <span class="nb">sed</span> <span class="nt">-e</span> <span class="s1">'s/^/sudo ctr image pull /g'</span> <span class="nt">-e</span> <span class="s1">'s#registry.k8s.io#registry.cn-hangzhou.aliyuncs.com/google_containers#g'</span> | sh <span class="nt">-x</span>
</code></pre></div></div>

<h4 id="åˆå§‹åŒ–æ§åˆ¶èŠ‚ç‚¹">åˆå§‹åŒ–æ§åˆ¶èŠ‚ç‚¹</h4>

<p>â€ƒâ€ƒä¸‹è½½å®Œæ‰€éœ€çš„å®¹å™¨é•œåƒåï¼Œåœ¨æ§åˆ¶èŠ‚ç‚¹ä¸Šä½¿ç”¨ <code class="language-plaintext highlighter-rouge">sudo kubeadm init --config=kubeadm_config.yaml</code> å‘½ä»¤åˆå§‹åŒ–æ§åˆ¶èŠ‚ç‚¹ã€‚<code class="language-plaintext highlighter-rouge">kubeadm_config.yaml</code> çš„å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼šï¼ˆå»ºè®®å°†é…ç½®æ–‡ä»¶æ”¾ç½®åœ¨ <code class="language-plaintext highlighter-rouge">~/k8s</code> ç›®å½•ä¸‹ï¼Œ<code class="language-plaintext highlighter-rouge">cd ~/k8s</code> ç›®å½•åæ‰§è¡Œåˆå§‹åŒ–å‘½ä»¤ã€‚ï¼‰</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">kubeadm.k8s.io/v1beta3</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">InitConfiguration</span>
<span class="na">localAPIEndpoint</span><span class="pi">:</span>
  <span class="na">advertiseAddress</span><span class="pi">:</span> <span class="s">192.168.120.1</span>
  <span class="na">bindPort</span><span class="pi">:</span> <span class="m">6443</span>
<span class="na">nodeRegistration</span><span class="pi">:</span>
  <span class="na">criSocket</span><span class="pi">:</span> <span class="s2">"</span><span class="s">unix:///run/containerd/containerd.sock"</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">kubeadm.k8s.io/v1beta3</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ClusterConfiguration</span>
<span class="na">kubernetesVersion</span><span class="pi">:</span> <span class="s">stable</span>
<span class="na">imageRepository</span><span class="pi">:</span> <span class="s2">"</span><span class="s">registry.cn-hangzhou.aliyuncs.com/google_containers"</span>
<span class="na">networking</span><span class="pi">:</span>
  <span class="na">podSubnet</span><span class="pi">:</span> <span class="s">192.168.144.0/20</span>
  <span class="na">serviceSubnet</span><span class="pi">:</span> <span class="s">192.168.244.0/24</span>
</code></pre></div></div>

<div class="premonition warning"> <div class="header"> <svg class="icon warning" aria-hidden="true"> <use xlink:href="#icon-warning"></use> </svg> <div class="title"> å‹æƒ…æé†’ </div> </div> <div class="content"> <p>â€ƒâ€ƒå¦‚æœæ²¡æœ‰é…ç½®ä¸»æœºåå¯¹åº”çš„è¯ï¼Œè¿™é‡Œåˆå§‹åŒ–ä¼šä¸€ç›´å¡åœ¨ API Health æ£€æµ‹çš„æ­¥éª¤ï¼Œå®é™…ä¸Šæ˜¯å› ä¸ºæ²¡æœ‰ä¸»æœºåå’Œ IP å¯¹åº”è€Œæ— æ³•å¯åŠ¨ API Serverã€‚</p>



 </div> </div>
<p>â€ƒâ€ƒkubeadm åˆå§‹åŒ–æˆåŠŸåéœ€è¦å¤åˆ¶éªŒè¯æ–‡ä»¶æ‰èƒ½åœ¨æ§åˆ¶èŠ‚ç‚¹ç®¡ç† K8S é›†ç¾¤ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># å¤åˆ¶éªŒè¯æ–‡ä»¶</span>
<span class="nb">mkdir</span> <span class="nt">-p</span> <span class="nv">$HOME</span>/.kube
<span class="nb">sudo cp</span> <span class="nt">-i</span> /etc/kubernetes/admin.conf <span class="nv">$HOME</span>/.kube/config
<span class="nb">sudo chown</span> <span class="si">$(</span><span class="nb">id</span> <span class="nt">-u</span><span class="si">)</span>:<span class="si">$(</span><span class="nb">id</span> <span class="nt">-g</span><span class="si">)</span> <span class="nv">$HOME</span>/.kube/config

<span class="c"># æŸ¥è¯¢èŠ‚ç‚¹çŠ¶æ€</span>
kubectl get nodes <span class="nt">-o</span> wide
</code></pre></div></div>

<h4 id="å·¥ä½œèŠ‚ç‚¹åŠ å…¥é›†ç¾¤">å·¥ä½œèŠ‚ç‚¹åŠ å…¥é›†ç¾¤</h4>

<p>â€ƒâ€ƒåˆšæ‰åˆå§‹åŒ–é›†ç¾¤åä¼šå‡ºç°å·¥ä½œèŠ‚ç‚¹åŠ å…¥é›†ç¾¤çš„å‘½ä»¤ï¼Œå½¢å¦‚ï¼š</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubeadm <span class="nb">join </span>192.168.120.1:6443 <span class="nt">--token</span> z9sdsdi.tdeu74psxqi8rhdt <span class="se">\</span>
    <span class="nt">--discovery-token-ca-cert-hash</span> sha256:87c4f8dd9dabaf2e5e793c0404c74dd8f9f56153000dad3c1a3238a3e8b0beff
</code></pre></div></div>

<p>â€ƒâ€ƒæ³¨æ„è¿™é‡Œéœ€è¦åŠ ä¸Š <code class="language-plaintext highlighter-rouge">sudo</code> ä¹‹åå†åœ¨å·¥ä½œèŠ‚ç‚¹ä¸Šæ‰§è¡ŒåŠ å…¥é›†ç¾¤æ“ä½œã€‚åŠ å…¥å®Œæˆåå¯ä»¥åœ¨æ§åˆ¶èŠ‚ç‚¹ä¸Šä½¿ç”¨ <code class="language-plaintext highlighter-rouge">kubectl get nodes -o wide</code> æŸ¥çœ‹æ˜¯å¦æœ‰äº†åˆšåŠ å…¥çš„å·¥ä½œèŠ‚ç‚¹çš„ä¿¡æ¯ã€‚ç”±äºç›®å‰è¿˜æ²¡æœ‰é…ç½®ç½‘ç»œç»„ä»¶ï¼Œé™¤äº†æ§åˆ¶èŠ‚ç‚¹å¤–ï¼Œå…¶ä»–å·¥ä½œèŠ‚ç‚¹åº”è¯¥å‡ä¸º <code class="language-plaintext highlighter-rouge">NotReady</code> çŠ¶æ€ã€‚å¦‚æœä½¿ç”¨ <code class="language-plaintext highlighter-rouge">kubectl get pods --all-namespaces</code> å‘½ä»¤æŸ¥çœ‹æ‰€æœ‰å¯åŠ¨çš„ Podï¼Œåº”è¯¥çœ‹åˆ°é™¤ä¸¤ä¸ª CordDNS çš„ Pod (æ¯”å¦‚ <code class="language-plaintext highlighter-rouge">0/1</code>) ä»¥å¤–çš„æ‰€æœ‰ Pod çš„çŠ¶æ€éƒ½æ˜¯å®Œæˆå¯åŠ¨ (æ¯”å¦‚ <code class="language-plaintext highlighter-rouge">1/1</code>)ã€‚</p>

<p>â€ƒâ€ƒå·¥ä½œèŠ‚ç‚¹åŠ å…¥åå¯ä»¥é…ç½®ä¸åŒçš„æ ‡ç­¾ï¼Œæ¯”å¦‚å¦‚ä¸‹æ˜¯é…ç½®ä¸ºå·¥ä½œèŠ‚ç‚¹å’Œæ·»åŠ  <code class="language-plaintext highlighter-rouge">gputype</code> å­—æ®µæ ‡ç­¾ï¼š</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl label node vm02 node-role.kubernetes.io/worker<span class="o">=</span>
kubectl label node vm03 node-role.kubernetes.io/worker<span class="o">=</span>
kubectl label node vm02 <span class="nv">gputype</span><span class="o">=</span>P100
kubectl label node vm03 <span class="nv">gputype</span><span class="o">=</span>A100
</code></pre></div></div>

<h3 id="æ·»åŠ ç»„ä»¶">æ·»åŠ ç»„ä»¶</h3>

<h4 id="é…ç½®-calico-ç½‘ç»œ">é…ç½® Calico ç½‘ç»œ</h4>

<p>â€ƒâ€ƒCalico æ”¯æŒä¸€å¥—çµæ´»çš„ç½‘ç»œé€‰é¡¹ï¼Œå¯ä»¥æ ¹æ®æƒ…å†µé€‰æ‹©æœ€æœ‰æ•ˆçš„é€‰é¡¹ï¼ŒåŒ…æ‹¬éè¦†ç›–å’Œè¦†ç›–ç½‘ç»œï¼Œå¸¦æˆ–ä¸å¸¦ BGPã€‚Calico ä½¿ç”¨ç›¸åŒçš„å¼•æ“ä¸ºä¸»æœºã€Pod å’Œåº”ç”¨ç¨‹åºåœ¨æœåŠ¡ç½‘æ ¼å±‚æ‰§è¡Œç½‘ç»œç­–ç•¥ã€‚å¦‚ä¸‹æ‰€ç¤ºå¯ä»¥å¾ˆç®€å•åœ°ä¸º K8S é›†ç¾¤å¯ç”¨ Calico ç½‘ç»œï¼š</p>

<ol>
  <li>åˆ›å»º Calico æ‰€éœ€çš„ operatorï¼ˆéœ€è¦é•œåƒ <code class="language-plaintext highlighter-rouge">quay.io/tigera/operator:v1.34.5</code>ï¼Œå¯æå‰ä¸‹è½½ï¼‰ï¼Œä»…åœ¨æ§åˆ¶èŠ‚ç‚¹åˆ›å»º Podï¼›</li>
  <li>åˆ›å»ºå’Œåˆå§‹åŒ– K8S é›†ç¾¤æ—¶å¯¹åº”çš„ç½‘ç»œè§„åˆ’ï¼Œä¸»è¦æ˜¯ PodSubset é…ç½®ï¼Œå¦‚ä¸‹é¢ä¿®æ”¹è¿‡çš„ yaml é…ç½®æ–‡ä»¶ã€‚è¿™é‡Œä¸ºäº†åŠ é€Ÿåˆ›å»ºè¿‡ç¨‹ï¼Œè¿˜æ·»åŠ äº† <code class="language-plaintext highlighter-rouge">registry</code> å­—æ®µæ¥ä½¿ç”¨ DaoCloud åŠ é€Ÿå™¨ã€‚</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir</span> <span class="nt">-p</span> ~/k8s/calico &amp; <span class="nb">cd</span> ~/k8s/calico
wget <span class="nt">-c</span> https://raw.githubusercontent.com/projectcalico/calico/v3.28.1/manifests/tigera-operator.yaml
wget <span class="nt">-c</span> https://raw.githubusercontent.com/projectcalico/calico/v3.28.1/manifests/custom-resources.yaml 
kubectl create <span class="nt">-f</span> tigera-operator.yaml 
kubectl create <span class="nt">-f</span> custom-resources.yaml
</code></pre></div></div>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># This section includes base Calico installation configuration.</span>
<span class="c1"># For more information, see: https://docs.tigera.io/calico/latest/reference/installation/api#operator.tigera.io/v1.Installation</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">operator.tigera.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Installation</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">default</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="c1"># Configures Calico networking.</span>
  <span class="na">calicoNetwork</span><span class="pi">:</span>
    <span class="na">ipPools</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">default-ipv4-ippool</span>
      <span class="na">blockSize</span><span class="pi">:</span> <span class="m">26</span>
      <span class="na">cidr</span><span class="pi">:</span> <span class="s">192.168.144.0/20</span>
      <span class="na">encapsulation</span><span class="pi">:</span> <span class="s">VXLANCrossSubnet</span>
      <span class="na">natOutgoing</span><span class="pi">:</span> <span class="s">Enabled</span>
      <span class="na">nodeSelector</span><span class="pi">:</span> <span class="s">all()</span>
  <span class="na">registry</span><span class="pi">:</span> <span class="s">m.daocloud.io</span>
<span class="nn">---</span>

<span class="c1"># This section configures the Calico API server.</span>
<span class="c1"># For more information, see: https://docs.tigera.io/calico/latest/reference/installation/api#operator.tigera.io/v1.APIServer</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">operator.tigera.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">APIServer</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">default</span>
<span class="na">spec</span><span class="pi">:</span> <span class="pi">{}</span>
</code></pre></div></div>

<p>â€ƒâ€ƒå¦‚æœé€šè¿‡ <code class="language-plaintext highlighter-rouge">kubectl get pod --all-namespaces</code> å‘ç°å“ªä¸ªç›¸å…³ Pod å¡åœ¨äº†æ‹‰å–é•œåƒçš„æ­¥éª¤ï¼Œå¯ä»¥æ‰‹åŠ¨é•œåƒã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä½¿ç”¨ä¿®æ”¹çš„ DaoCloud åŠ é€Ÿå™¨ä¸‹è½½åº”è¯¥æ²¡ä»€ä¹ˆå¤ªå¤§é—®é¢˜ã€‚åˆ›å»º Calico ç½‘ç»œå®Œæˆåä¼šå¤šå‡ºæ¥ 3 ä¸ªå‘½åç©ºé—´: <code class="language-plaintext highlighter-rouge">tigera-operator</code>ã€ <code class="language-plaintext highlighter-rouge">calico-system</code> å’Œ <code class="language-plaintext highlighter-rouge">calico-apiserver</code>ã€‚æ–°å¢çš„ Pod åº”è¯¥å¦‚ä¸‹æ‰€ç¤ºï¼š</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">èŠ‚ç‚¹ä¸»æœºå</th>
      <th style="text-align: left">æ–°å¢ Pod</th>
      <th style="text-align: left">å¤‡æ³¨</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">vm01</td>
      <td style="text-align: left">tigera-operator</td>
      <td style="text-align: left">Calico ç½‘ç»œæ‰€éœ€çš„æè¿°å­</td>
    </tr>
    <tr>
      <td style="text-align: center">vm01</td>
      <td style="text-align: left">calico-kube-controller</td>
      <td style="text-align: left">Calico ç½‘ç»œæ§åˆ¶å™¨</td>
    </tr>
    <tr>
      <td style="text-align: center">vm01</td>
      <td style="text-align: left">calico-apiserver</td>
      <td style="text-align: left">Calico ç½‘ç»œ APIï¼Œä¸€èˆ¬æœ‰ä¸¤ä¸ª Pod</td>
    </tr>
    <tr>
      <td style="text-align: center">vm01</td>
      <td style="text-align: left">calico-typha</td>
      <td style="text-align: left">ä¼˜åŒ–å’Œå‡å°‘ Calico å¯¹ K8S API æœåŠ¡å™¨çš„è´Ÿè½½</td>
    </tr>
    <tr>
      <td style="text-align: center">vm01</td>
      <td style="text-align: left">calico-node</td>
      <td style="text-align: left">Calico ç½‘ç»œèŠ‚ç‚¹å®¢æˆ·ç«¯</td>
    </tr>
    <tr>
      <td style="text-align: center">vm01</td>
      <td style="text-align: left">csi-node-driver</td>
      <td style="text-align: left">CSI é©±åŠ¨</td>
    </tr>
    <tr>
      <td style="text-align: center">vm02</td>
      <td style="text-align: left">calico-typha</td>
      <td style="text-align: left">ä¼˜åŒ–å’Œå‡å°‘ Calico å¯¹ K8S API æœåŠ¡å™¨çš„è´Ÿè½½</td>
    </tr>
    <tr>
      <td style="text-align: center">vm02</td>
      <td style="text-align: left">calico-node</td>
      <td style="text-align: left">Calico ç½‘ç»œèŠ‚ç‚¹å®¢æˆ·ç«¯</td>
    </tr>
    <tr>
      <td style="text-align: center">vm02</td>
      <td style="text-align: left">csi-node-driver</td>
      <td style="text-align: left">CSI é©±åŠ¨</td>
    </tr>
    <tr>
      <td style="text-align: center">vm03</td>
      <td style="text-align: left">calico-node</td>
      <td style="text-align: left">Calico ç½‘ç»œèŠ‚ç‚¹å®¢æˆ·ç«¯</td>
    </tr>
    <tr>
      <td style="text-align: center">vm03</td>
      <td style="text-align: left">csi-node-driver</td>
      <td style="text-align: left">CSI é©±åŠ¨</td>
    </tr>
  </tbody>
</table>

<h4 id="é…ç½®-nfs-csi-é©±åŠ¨å’Œå­˜å‚¨ç±»">é…ç½® NFS CSI é©±åŠ¨å’Œå­˜å‚¨ç±»</h4>

<p>â€ƒâ€ƒNFS CSI é©±åŠ¨ç”± <a href="https://github.com/kubernetes-csi/csi-driver-nfs" rel="nofollow" target="_blank" class="extlinks">kubernetes-csi/csi-driver-nfs</a> é¡¹ç›®æä¾›æ”¯æŒã€‚ä¸è¿‡åœ¨æ­£å¼å®‰è£…é©±åŠ¨ä¹‹å‰éœ€è¦å…ˆå®‰è£… NFS å®¢æˆ·ç«¯ï¼Œå¦åˆ™ NFS CSI é©±åŠ¨ä¹Ÿæ— æ³•æ­£å¸¸å¯ç”¨ã€‚ä¸ºäº†åŠ é€Ÿä¸‹è½½å®¹å™¨é•œåƒï¼Œè¿™é‡Œæ¨èå°†é…ç½®ä¸­çš„ <code class="language-plaintext highlighter-rouge">registry.k8s.io</code> æºåˆ‡æ¢åˆ° <code class="language-plaintext highlighter-rouge">k8s.m.daocloud.io</code> åŠ é€Ÿå™¨ã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># åœ¨æ‰€æœ‰èŠ‚ç‚¹å®‰è£… NFS å®¢æˆ·ç«¯æ”¯æŒ</span>
<span class="nb">sudo </span>apt <span class="nb">install</span> <span class="nt">-y</span> nfs-common

<span class="c"># ä¸‹è½½ NFS CSI Driver é…ç½®æ–‡ä»¶</span>
<span class="nb">mkdir</span> <span class="nt">-p</span> ~/k8s/csi <span class="o">&amp;&amp;</span> <span class="nb">cd</span> ~/k8s/csi
git clone https://github.com/kubernetes-csi/csi-driver-nfs.git 

<span class="c"># ä¿®æ”¹å®¹å™¨é•œåƒä¸º DaoCloud åŠ é€Ÿå™¨</span>
<span class="nb">cd </span>csi-driver-nfs/deploy/v4.9.0
<span class="nb">sed</span> <span class="nt">-i</span> <span class="s2">"s/registry.k8s.io/k8s.m.daocloud.io/"</span> ./<span class="k">*</span>

<span class="c"># è¿”å›ä¸Šä¸Šå±‚ç›®å½•ï¼Œå¹¶å®‰è£… NFS CSI é©±åŠ¨</span>
<span class="nb">cd</span> ../../
./deploy/install-driver.sh v4.9.0 <span class="nb">local</span> 
</code></pre></div></div>

<p>â€ƒâ€ƒå®‰è£… NFS CSI é©±åŠ¨åä¼šåœ¨ <code class="language-plaintext highlighter-rouge">kube-system</code> å‘½åç©ºé—´ä¸­å¤šå‡ºå››ä¸ª Podï¼Œå…¶ä¸­ä¸€ä¸ª Pod ä¸º <code class="language-plaintext highlighter-rouge">csi-nfs-controller</code>ï¼Œå…¶ä»–æ¯ä¸ªèŠ‚ç‚¹ä¸€ä¸ª <code class="language-plaintext highlighter-rouge">csi-nfs-node</code> çš„ Podã€‚ç„¶åéœ€è¦ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">kubectl apply -f nfs.yaml</code> å‘½ä»¤åˆ›å»ºä¸€ä¸ª NFS çš„å­˜å‚¨ç±»ç”¨äºæä¾›ç»™åº”ç”¨ç¨‹åºï¼Œé…ç½®æ–‡ä»¶ <code class="language-plaintext highlighter-rouge">nfs.yaml</code> å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">storage.k8s.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">StorageClass</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">nfs-csi</span>
  <span class="na">annotations</span><span class="pi">:</span>
    <span class="na">storageclass.kubernetes.io/is-default-class</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span>
<span class="na">provisioner</span><span class="pi">:</span> <span class="s">nfs.csi.k8s.io</span>
<span class="na">parameters</span><span class="pi">:</span>
  <span class="na">server</span><span class="pi">:</span> <span class="s">nfs_server_ip</span>
  <span class="na">share</span><span class="pi">:</span> <span class="s">/home/data</span>
<span class="na">reclaimPolicy</span><span class="pi">:</span> <span class="s">Retain</span>
<span class="na">volumeBindingMode</span><span class="pi">:</span> <span class="s">Immediate</span>
<span class="na">allowVolumeExpansion</span><span class="pi">:</span> <span class="kc">true</span>
<span class="na">mountOptions</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">async</span>
  <span class="pi">-</span> <span class="s">rsize=32768</span>
  <span class="pi">-</span> <span class="s">wsize=32768</span>
  <span class="pi">-</span> <span class="s">nconnect=8</span>
  <span class="pi">-</span> <span class="s">nfsvers=4.1</span>
  <span class="pi">-</span> <span class="s">hard</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># æŸ¥çœ‹æ–°å¢çš„å­˜å‚¨ç±»</span>
â•°â”€<span class="nv">$ </span>kubectl get sc
NAME                PROVISIONER      RECLAIMPOLICY   VOLUMEBINDINGMODE   ALLOWVOLUMEEXPANSION   AGE
nfs-csi <span class="o">(</span>default<span class="o">)</span>   nfs.csi.k8s.io   Retain          Immediate           <span class="nb">true                   </span>4d1h
</code></pre></div></div>

<h4 id="gpu-æ”¯æŒ">GPU æ”¯æŒ</h4>

<p>â€ƒâ€ƒK8S çš„ GPU æ”¯æŒæ˜¯ç”± NVIDIA æä¾›çš„ï¼Œéœ€è¦å·¥ä½œèŠ‚ç‚¹å…ˆå®‰è£… NVIDIA é©±åŠ¨å’Œå®¹å™¨é©±åŠ¨ï¼Œå†åœ¨æ§åˆ¶èŠ‚ç‚¹ä¸Šéƒ¨ç½² nvidia-device æ’ä»¶æ”¯æŒã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># æŸ¥çœ‹å¯å®‰è£… NVIDIA é©±åŠ¨</span>
â•°â”€<span class="nv">$ </span>ubuntu-drivers devices
modalias : pci:v000010DEd000026BAsv000010DEsd00001957bc03sc02i00
vendor   : NVIDIA Corporation
driver   : nvidia-driver-550-open - distro non-free
driver   : nvidia-driver-550 - distro non-free recommended
driver   : nvidia-driver-535-server - distro non-free
driver   : nvidia-driver-535-server-open - distro non-free
driver   : nvidia-driver-535-open - distro non-free
driver   : nvidia-driver-535 - distro non-free
driver   : xserver-xorg-video-nouveau - distro free <span class="nb">builtin</span>

<span class="c"># å®‰è£… NVIDIA é©±åŠ¨ï¼Œå¹¶é‡å¯ç”Ÿæ•ˆ</span>
<span class="nb">sudo </span>apt <span class="nb">install</span> <span class="nt">-y</span> nvidia-driver-535
<span class="nb">sudo </span>apt-mark hold nvidia-driver-535

<span class="c"># æ·»åŠ  NVIDIA Container Toolkit æº</span>
curl <span class="nt">-fsSL</span> https://mirrors.ustc.edu.cn/libnvidia-container/gpgkey | <span class="nb">sudo </span>gpg <span class="nt">--dearmor</span> <span class="nt">-o</span> /usr/share/keyrings/nvidia-container-toolkit-keyring.gpg <span class="se">\</span>
<span class="o">&amp;&amp;</span> curl <span class="nt">-s</span> <span class="nt">-L</span> https://mirrors.ustc.edu.cn/libnvidia-container/stable/deb/nvidia-container-toolkit.list | <span class="se">\</span>
    <span class="nb">sed</span> <span class="s1">'s#deb https://#deb [signed-by=/usr/share/keyrings/nvidia-container-toolkit-keyring.gpg] https://#g'</span> | <span class="se">\</span>
    <span class="nb">sudo tee</span> /etc/apt/sources.list.d/nvidia-container-toolkit.list

<span class="c"># æ›´æ–°è½¯ä»¶åˆ—è¡¨ç¼“å­˜ï¼Œå®‰è£… nvidia-container-toolkit</span>
<span class="nb">sudo </span>apt-get update <span class="o">&amp;&amp;</span> <span class="nb">sudo </span>apt-get <span class="nb">install</span> <span class="nt">-y</span> nvidia-container-toolkit

<span class="c"># ä¸º containerd å®¹å™¨è¿è¡Œæ—¶å¢åŠ  NVIDIA é€‰é¡¹</span>
<span class="nb">sudo </span>nvidia-ctk runtime configure <span class="nt">--runtime</span><span class="o">=</span>containerd

<span class="c"># ä¿®æ”¹ /etc/containerd/config.toml é…ç½®æ–‡ä»¶ä¸­é»˜è®¤è¿è¡Œæ—¶ä¸º NVIDIA</span>
<span class="c"># åŸæ¥çš„é»˜è®¤è¿è¡Œæ—¶æ˜¯ runc</span>
<span class="o">[</span>plugins.<span class="s2">"io.containerd.grpc.v1.cri"</span>.containerd]
      default_runtime_name <span class="o">=</span> <span class="s2">"nvidia"</span>

<span class="c"># é‡æ–°åŠ è½½ containerd é…ç½®æ–‡ä»¶å¹¶é‡å¯æœåŠ¡ç”Ÿæ•ˆ</span>
<span class="nb">sudo </span>systemctl daemon-reload
<span class="nb">sudo </span>systemctl restart containerd

<span class="c"># åœ¨æ§åˆ¶èŠ‚ç‚¹ä¸º K8S é›†ç¾¤åˆ›å»º NVIDIA device æ’ä»¶æ”¯æŒ</span>
<span class="nb">cd</span> ~/k8s
wget <span class="nt">-c</span> https://raw.githubusercontent.com/NVIDIA/k8s-device-plugin/v0.16.2/deployments/static/nvidia-device-plugin.yml

<span class="nb">sed</span> <span class="nt">-i</span> <span class="s2">"s/nvcr.io/nvcr.m.daocloud.io/"</span> nvidia-device-plugin.yml
kubectl create <span class="nt">-f</span> nvidia-device-plugin.yml

<span class="c"># éªŒè¯ GPU æ˜¯å¦è¢« K8S è¯†åˆ«</span>
kubectl describe node vm02 | <span class="nb">grep </span>nvidia.com/gpu:
</code></pre></div></div>

<div class="premonition info"> <div class="header"> <svg class="icon info" aria-hidden="true"> <use xlink:href="#icon-info"></use> </svg> <div class="title"> å°æç¤º </div> </div> <div class="content"> <p>â€ƒâ€ƒNVIDIA GPU é©±åŠ¨å’Œå®¹å™¨é©±åŠ¨åªéœ€åœ¨æœ‰ NVIDIA GPU çš„å·¥ä½œèŠ‚ç‚¹ä¸Šé…ç½®ï¼Œå¹¶ä¸”<strong>ä¸€å®šè¦ä¿®æ”¹é»˜è®¤è¿è¡Œæ—¶ä¸º NVIDIA</strong>ï¼Œå¦åˆ™æ— æ³•è¢« K8S è¯†åˆ«ã€‚NVIDIA device æ’ä»¶æ”¯æŒåœ¨æ§åˆ¶èŠ‚ç‚¹ä¸Šæäº¤å®‰è£…è¯·æ±‚ä½†ä¼šåœ¨æ¯ä¸€ä¸ªå·¥ä½œèŠ‚ç‚¹ä¸Šå®‰è£…ï¼Œå³ä½¿æ²¡æœ‰ NVIDIA GPU å­˜åœ¨ã€‚</p>



 </div> </div>
<h2 id="å¯èƒ½é‡åˆ°çš„é—®é¢˜å’Œè§£ç­”">å¯èƒ½é‡åˆ°çš„é—®é¢˜å’Œè§£ç­”</h2>

<div class="premonition info"> <div class="header"> <svg class="icon info" aria-hidden="true"> <use xlink:href="#icon-info"></use> </svg> <div class="title"> å¦‚æœå„èŠ‚ç‚¹æœ¬èº«æ²¡æœ‰ä»»ä½•ç½‘ç»œï¼Œéœ€è¦ä½¿ç”¨å†…éƒ¨ HTTP ä»£ç†ä¸Šç½‘æ€ä¹ˆåŠï¼Ÿ </div> </div> <div class="content"> <p>â€ƒâ€ƒè¿™ç§æƒ…å†µä¸‹éœ€è¦ä¸º kubelet å’Œ containerd çš„ service è®¾ç½®ä»£ç†ã€‚kubelet çš„é…ç½®æ–‡ä»¶ä¸º <code class="language-plaintext highlighter-rouge">/usr/lib/systemd/system/kubelet.service.d/10-kubeadm.conf</code>ï¼Œcontainerd çš„é…ç½®æ–‡ä»¶ä¸º <code class="language-plaintext highlighter-rouge">/usr/lib/systemd/system/containerd.service</code>ã€‚é…ç½®å†…å®¹å¦‚ä¸‹æ‰€ç¤ºã€‚é…ç½®å®Œåéœ€è¦ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">sudo systemctl daemon-reload</code> æ¥åº”ç”¨é…ç½®æ›´æ”¹ï¼Œå¹¶ä¸”ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">sudo systemctl restart kubelet</code> å’Œ <code class="language-plaintext highlighter-rouge">sudo systemctl restart containerd</code> é‡å¯æœåŠ¡ã€‚</p>



 </div> </div>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># sudo vim /usr/lib/systemd/system/containerd.service</span>
<span class="c"># sudo vim /usr/lib/systemd/system/kubelet.service.d/10-kubeadm.conf</span>

<span class="o">[</span>Service]
...
<span class="nv">Environment</span><span class="o">=</span><span class="s2">"HTTP_PROXY=http://proxy.ip:3128"</span>
<span class="nv">Environment</span><span class="o">=</span><span class="s2">"HTTPS_PROXY=http://proxy.ip:3128"</span>
<span class="nv">Environment</span><span class="o">=</span><span class="s2">"NO_PROXY=localhost,127.0.0.1"</span>
</code></pre></div></div>

<h2 id="ç»“è¯­">ç»“è¯­</h2>

<p>â€ƒâ€ƒK8S é›†ç¾¤çš„æ­å»ºå¹¶éä¸€ä»¶ååˆ†å¤æ‚çš„äº‹æƒ…ï¼Œæ¯”è¾ƒå¤æ‚çš„æ˜¯æ ¹æ®å®é™…çš„éœ€æ±‚å’Œè‡ªå·±å¯¹äº K8S çš„ç†è§£æ¥æ­å»ºå‡ºæ›´åˆé€‚çš„ K8S é›†ç¾¤ã€‚è™½ç„¶ K8S é›†ç¾¤å·²ç»é€æ­¥å¼€å§‹å–ä»£ä¸€èˆ¬çš„ Docker å•æœºåº”ç”¨æœåŠ¡éƒ¨ç½²æ–¹æ¡ˆï¼Œä½†æ˜¯å°±ä¸ªäººå®é™…çš„åº”ç”¨è§„æ¨¡æˆ–è€…åº”ç”¨æœ¬èº«è€Œè¨€ï¼ŒK8S é›†ç¾¤æœ¬èº«çš„ç»´æŠ¤å’Œè°ƒæ•´çš„ä»£ä»·è¦è¿œé«˜äº Docker å•æœºåº”ç”¨æœåŠ¡éƒ¨ç½²ã€‚å¦‚æœæ˜¯æœ‰é«˜å¯ç”¨æ€§ã€é«˜å¯é æ€§ç­‰çš„éœ€æ±‚ï¼Œé‚£ä¹ˆ K8S å¯èƒ½æ˜¯ç›®å‰æœ€å¥½çš„éœ€æ±‚ã€‚</p>

<p>â€ƒâ€ƒæ­£å¦‚åœ¨å‰è¨€ä¸­æ‰€è¿°ï¼Œæœ‰äº† K8S æŒç»­å¼€å‘ã€æŒç»­é›†æˆå’ŒæŒç»­éƒ¨ç½²æˆä¸ºäº†ç°å®ï¼Œå¼€å‘è€…å¯ä»¥æŠŠæ›´å¤šçš„æ³¨æ„åŠ›éƒ½æ”¾åœ¨åº”ç”¨ä»£ç å¼€å‘ã€‚åŒæ—¶ï¼Œç±»ä¼¼äº JupyterHub è¿™ç±»ä¼šæœ‰åŠ¨æ€æ‰©å±•å’Œåˆ†é…èµ„æºéœ€æ±‚çš„åº”ç”¨ï¼Œæœ€ä½³çš„éƒ¨ç½²æ–¹å¼å¯èƒ½å°±æ˜¯ K8S äº†ã€‚å½“ç„¶ï¼Œå¬è¯´ç°åœ¨çš„å¤§æ¨¡å‹ ChatGPT ç­‰ä¹Ÿéƒ½æ˜¯åœ¨ K8S ä¸Šè®­ç»ƒå‡ºæ¥çš„ã€‚</p>

<p>â€ƒâ€ƒK8S çš„ç¡®æ˜¯å¤§æœ‰å¯ä¸ºï¼</p>

<h2 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h2>

<ol>
  <li><a href="https://www.blackduck.com/en-us/glossary/what-is-continuous-development.html" rel="nofollow" target="_blank" class="extlinks">Continuous Development</a></li>
  <li><a href="https://aws.amazon.com/cn/devops/continuous-integration/" rel="nofollow" target="_blank" class="extlinks">AWS â€“ ä»€ä¹ˆæ˜¯æŒç»­é›†æˆï¼Ÿ</a></li>
  <li><a href="https://www.ibm.com/topics/continuous-deployment" rel="nofollow" target="_blank" class="extlinks">IBM â€“ What is continuous deployment?</a></li>
  <li><a href="https://circleci.com/blog/docker-swarm-vs-kubernetes/" rel="nofollow" target="_blank" class="extlinks">Docker Swarm vs Kubernetes: how to choose a container orchestration tool</a></li>
  <li><a href="https://zh.wikipedia.org/zh-cn/Kubernetes" rel="nofollow" target="_blank" class="extlinks">ç»´åŸºç™¾ç§‘ â€“ Kubernetes</a></li>
  <li><a href="https://www.ibm.com/blogs/solutions/jp-ja/container-cocreation-center-05/" rel="nofollow" target="_blank" class="extlinks">IBM â€“ ç¬¬5å› ã€Red Hat OpenShift ã¨ Kubernetes ã®é•ã„ã€</a></li>
  <li><a href="https://kubernetes.io/zh-cn/docs/concepts/architecture/" rel="nofollow" target="_blank" class="extlinks">Kubernetes æ–‡æ¡£ - æ¦‚å¿µ - Kubernetes æ¶æ„</a></li>
  <li><a href="https://cloud.tencent.com/developer/article/1852347" rel="nofollow" target="_blank" class="extlinks">åŸºäº Containerd è¿è¡Œæ—¶æ­å»º Kubernetes é›†ç¾¤å®è·µ</a></li>
</ol>

                <div class="post-copyright">
                    <p>
                        <span>ç‰ˆæƒå£°æ˜ï¼š</span>
                        å¦‚æ— ç‰¹åˆ«å£°æ˜ï¼Œæœ¬æ–‡ç‰ˆæƒå½’
                        <a href="https://lisz.me" class="cplink">ä»²å„¿çš„è‡ªç•™åœ°</a>
                        æ‰€æœ‰ï¼Œè½¬è½½è¯·æ³¨æ˜æœ¬æ–‡é“¾æ¥ã€‚
                    </p>
                    
                    <p>
                        ï¼ˆé‡‡ç”¨ 
                        <a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" class="extlinks">CC
                            BY-NC-SA 4.0</a>
                        è®¸å¯åè®®è¿›è¡Œæˆæƒï¼‰
                    </p>
                    
                    <p><span>æœ¬æ–‡æ ‡é¢˜ï¼š</span>ã€Š Kubernetes ä¸å®Œå…¨å…¥é—¨ ã€‹</p>
                    <p><span>æœ¬æ–‡é“¾æ¥ï¼š</span><a href="https://lisz.me/tech/k8s/k8s-introduction.html" class="cplink">https://lisz.me/tech/k8s/k8s-introduction.html</a></p>
                    <p class="tips">æœ¬æ–‡æœ€åä¸€æ¬¡æ›´æ–°ä¸º <span></span> å¤©å‰ï¼Œæ–‡ç« ä¸­çš„æŸäº›å†…å®¹å¯èƒ½å·²è¿‡æ—¶ï¼
                    </p>
                </div>
            </article>
        </div>
        
            <div class="table-of-contents">
                <div class="toc-header"><h2>ç›®å½•</h2></div>
                <div class="toc-body">
                    <ul><li><a onclick="scrollToAdjust('å‰è¨€')">å‰è¨€</a><ul><li><a onclick="scrollToAdjust('å®ä¾‹è§£æ')">å®ä¾‹è§£æ</a></li></ul></li><li><a onclick="scrollToAdjust('kubernetes-æ¶æ„')">Kubernetes æ¶æ„</a><ul><li><a onclick="scrollToAdjust('ç»„æˆéƒ¨åˆ†')">ç»„æˆéƒ¨åˆ†</a></li></ul></li><li><a onclick="scrollToAdjust('æ­å»º-k8s-é›†ç¾¤')">æ­å»º K8S é›†ç¾¤</a><ul><li><a onclick="scrollToAdjust('åŸºæœ¬å‡†å¤‡')">åŸºæœ¬å‡†å¤‡</a><ul><li><a onclick="scrollToAdjust('å…³é—­-swap-äº¤æ¢åˆ†åŒº')">å…³é—­ SWAP äº¤æ¢åˆ†åŒº</a></li><li><a onclick="scrollToAdjust('å¼€å¯-ipv4-è½¬å‘')">å¼€å¯ IPv4 è½¬å‘</a></li><li><a onclick="scrollToAdjust('é…ç½®ä¸»æœºåå¯¹åº”')">é…ç½®ä¸»æœºåå¯¹åº”</a></li><li><a onclick="scrollToAdjust('åŒæ­¥æ—¶é—´')">åŒæ­¥æ—¶é—´</a></li></ul></li><li><a onclick="scrollToAdjust('å®‰è£…å¿…è¦è½¯ä»¶å’Œå·¥å…·')">å®‰è£…å¿…è¦è½¯ä»¶å’Œå·¥å…·</a><ul><li><a onclick="scrollToAdjust('å®‰è£…-containerd')">å®‰è£… containerd</a></li><li><a onclick="scrollToAdjust('é…ç½®-containerd')">é…ç½® containerd</a></li><li><a onclick="scrollToAdjust('å®‰è£…-kubeadm-ç­‰')">å®‰è£… kubeadm ç­‰</a></li></ul></li><li><a onclick="scrollToAdjust('åˆå§‹åŒ–é›†ç¾¤')">åˆå§‹åŒ–é›†ç¾¤</a><ul><li><a onclick="scrollToAdjust('é¢„ä¸‹è½½é•œåƒ')">é¢„ä¸‹è½½é•œåƒ</a></li><li><a onclick="scrollToAdjust('åˆå§‹åŒ–æ§åˆ¶èŠ‚ç‚¹')">åˆå§‹åŒ–æ§åˆ¶èŠ‚ç‚¹</a></li><li><a onclick="scrollToAdjust('å·¥ä½œèŠ‚ç‚¹åŠ å…¥é›†ç¾¤')">å·¥ä½œèŠ‚ç‚¹åŠ å…¥é›†ç¾¤</a></li></ul></li><li><a onclick="scrollToAdjust('æ·»åŠ ç»„ä»¶')">æ·»åŠ ç»„ä»¶</a><ul><li><a onclick="scrollToAdjust('é…ç½®-calico-ç½‘ç»œ')">é…ç½® Calico ç½‘ç»œ</a></li><li><a onclick="scrollToAdjust('é…ç½®-nfs-csi-é©±åŠ¨å’Œå­˜å‚¨ç±»')">é…ç½® NFS CSI é©±åŠ¨å’Œå­˜å‚¨ç±»</a></li><li><a onclick="scrollToAdjust('gpu-æ”¯æŒ')">GPU æ”¯æŒ</a></li></ul></li></ul></li><li><a onclick="scrollToAdjust('å¯èƒ½é‡åˆ°çš„é—®é¢˜å’Œè§£ç­”')">å¯èƒ½é‡åˆ°çš„é—®é¢˜å’Œè§£ç­”</a></li><li><a onclick="scrollToAdjust('ç»“è¯­')">ç»“è¯­</a></li><li><a onclick="scrollToAdjust('å‚è€ƒèµ„æ–™')">å‚è€ƒèµ„æ–™</a></li></ul>
                </div>
        
            </div>
        </div>
        
<div class="social-share-wrapper">
    <div class="social-share"></div>
</div>

</main>

<section class="author-detail">
    <section class="post-footer-item author-card">
        <div class="avatar">
            <img src="/assets/img/profile.webp" alt="">
        </div>
        <div class="author-name" rel="author">zhonger</div>
        <div class="bio">
            <p>Developer & Maintainer</p>
        </div>
        
        <ul class="sns-links">
            
            <li>
                <a href="https://scholar.google.com/citations?user=AUupIooAAAAJ" target="_blank" aria-label="google-scholar">
                    <svg class="icon" aria-hidden="true">
                        <use xlink:href="#icon-google-scholar"></use>
                    </svg>
                </a>
            </li>
            
            <li>
                <a href="https://www.researchgate.net/profile/Shengzhou-Li" target="_blank" aria-label="researchgate">
                    <svg class="icon" aria-hidden="true">
                        <use xlink:href="#icon-researchgate"></use>
                    </svg>
                </a>
            </li>
            
            <li>
                <a href="https://orcid.org/0000-0001-6973-3825" target="_blank" aria-label="ORCID">
                    <svg class="icon" aria-hidden="true">
                        <use xlink:href="#icon-ORCID"></use>
                    </svg>
                </a>
            </li>
            
            <li>
                <a href="https://github.com/zhonger" target="_blank" aria-label="github">
                    <svg class="icon" aria-hidden="true">
                        <use xlink:href="#icon-github"></use>
                    </svg>
                </a>
            </li>
            
            <li>
                <a href="https://www.linkedin.com/in/shengzhouli/" target="_blank" aria-label="linkedin">
                    <svg class="icon" aria-hidden="true">
                        <use xlink:href="#icon-linkedin"></use>
                    </svg>
                </a>
            </li>
            
            <li>
                <a href="https://segmentfault.com/u/wuwozhonger" target="_blank" aria-label="segmentfault">
                    <svg class="icon" aria-hidden="true">
                        <use xlink:href="#icon-segmentfault"></use>
                    </svg>
                </a>
            </li>
            
        </ul>
        
    </section>
    <section class="post-footer-item read-next">
        
        <div class="read-next-item">
            <a href="/ac/qc/solve-quantum-chemistry-by-hand-1-1.html" class="read-next-link" aria-label="ã€Šæ‰‹è§£é‡å­åŒ–å­¦ã€‹ç»ƒä¹ é¢˜ 1-1"></a>
            <section>
                <span>ã€Šæ‰‹è§£é‡å­åŒ–å­¦ã€‹ç»ƒä¹ é¢˜ 1-1</span>
                <p>  note â€œç»ƒä¹ é¢˜1-1â€åˆ¤æ–­ä¸‹é¢çš„ç®—å­æ˜¯å¦å„ç±³ï¼ˆHermitianï¼‰æˆ–ä¸ºå„ç±³ç®—å­ï¼ˆHermite Opera...</p>
            </section>
            
            <div class="filter"></div>
            <img src="https://i.lisz.top/cover/Hqx2QN.webp" alt="">
            
        </div>
        

        
        <div class="read-next-item">
            <a href="/tech/algorithm/bus-ticket.html" class="read-next-link"
                aria-label="ç”Ÿæ´»ä¸­çš„å°é—®é¢˜â€”â€”å…¬äº¤è®¡è´¹é—®é¢˜"></a>
            <section>
                <span>ç”Ÿæ´»ä¸­çš„å°é—®é¢˜â€”â€”å…¬äº¤è®¡è´¹é—®é¢˜</span>
                <p>å‰è¨€</p>
            </section>
            
            <div class="filter"></div>
            <img src="https://i.lisz.top/blog/XzVhEk.webp" alt="">
            
        </div>
        
    </section>
    


































    



    

</section>
            


<footer class="g-footer">
  <div class="g-container">
    <div class="g-left">
      <section class="links">
        æœ¬ç«™ç”± <a href="//jekyllrb.com" target="_blank" class="extlinks">Jekyll</a> å’Œ (åŸºäº <a href="https://github.com/kaeyleo/jekyll-theme-H2O" target="_blank" class="extlinks">H2O</a> çš„) <a href="https://github.com/zhonger/jekyll-theme-H2O-ac" target="_blank" class="extlinks">H2O-ac</a> å¼ºåŠ›é©±åŠ¨
         (<a href="https://github.com/zhonger/jekyll-theme-H2O-ac/releases/tag/v1.5.1"
          target="_blank" class="extlinks">v1.5.1</a>)
        
      </section>
      <section class="links">ä»²å„¿çš„è‡ªç•™åœ° Â©
        <input type="hidden" id="footer-since" value="2015">
        <span id="footer-year"></span>
        
        
        <a href="/rss.xml" target="_blank" aria-label="Terms of Service" class="others">
          <svg class="icon" aria-hidden="true">
            <use xlink:href="#icon-rss"></use>
          </svg> RSS
        </a>
        <a href="/tos" target="_blank" aria-label="Terms of Service" class="others">
          <svg class="icon" aria-hidden="true">
            <use xlink:href="#icon-tos"></use>
          </svg> ä½¿ç”¨æ¡æ¬¾
        </a>
      </section>
      
      <section class="links">
        <span id="busuanzi_container_site_pv">
          <svg class="icon" aria-hidden="true">
            <use xlink:href="#icon-pv"></use>
          </svg> æ€»æµè§ˆé‡
          
          <span id="busuanzi_site_pv">
            
            <b>Â·</b>
          </span>
        </span>
        <span id="busuanzi_container_site_uv">
          <svg class="icon" aria-hidden="true">
            <use xlink:href="#icon-user"></use>
          </svg> æ€»è®¿é—®é‡
          
          <span id="busuanzi_site_uv"></span>
          
        </span>
      </section>
      
      <section>
        
        æœ¬ç«™å·²è¿è¡Œ
        <span class="alivetime_days"></span> å¤©
        <span class="alivetime_hours"></span> å°æ—¶
        <span class="alivetime_minutes"></span> åˆ†
        <span class="alivetime_seconds"></span> ç§’
        
      </section>
    </div>
    <div class="g-right">
      
      
      <section class="badges">
        
        <a href="https://netlify.com" target="_blank" class="netlify" aria-label="netlify">
          <img src="/assets/icons/netlify-icon-light.svg" alt="netlify">
        </a>
        
        
        <a href="https://vercel.com" target="_blank" class="vercel" aria-label="vercel">
          <img src="/assets/icons/vercel-logotype-dark.png" alt="vercel">
        </a>
        
        
        <a href="https://www.cloudflare.com" target="_blank" class="cloudflare" aria-label="cloudflare">
          <img src="/assets/icons/cloudflare-logo.webp" alt="cloudflare">
        </a>
        
      </section>
      
      
      <section class="badges">
        
        <a href="https://www.foreverblog.cn/" target="_blank" class="foreverblog" aria-label="foreverblog">
          <img src="/assets/icons/forever_en_default.png" alt="foreverblog">
        </a>
        
        
        <a href="https://www.foreverblog.cn/go.html" target="_blank" class="wormhole" aria-label="wormhole">
          <img src="/assets/icons/wormhole_3.gif" alt="" title="ç©¿æ¢­è™«æ´-éšæœºè®¿é—®åå¹´ä¹‹çº¦å‹é“¾åšå®¢">
        </a>
        
        
        <a href="https://www.travellings.cn/go.html" target="_blank" class="travelling-badge" aria-label="Travelling"
          rel="noopener" title="å¼€å¾€-å‹é“¾æ¥åŠ›">
          <img src="/assets/icons/travellings.gif" alt="å¼€å¾€-å‹é“¾æ¥åŠ›">
        </a>
        
        
        <a href="https://notbyai.fyi/" target="_blank" class="notbyAI" aria-label="notbyAI">
          <img src="/assets/icons/notbyAI-white.png" alt="Written by Human, Not by AI">
        </a>
        
      </section>
      
    </div>
    
  </div>
</footer>
<div class="cookie-tip">
   ä¸ºäº†æå‡æœ¬ç«™çš„ä½¿ç”¨ä½“éªŒå’Œå¿…è¦åŠŸèƒ½çš„æ­£å¸¸ä½¿ç”¨ï¼Œæœ¬ç«™ä¼šä½¿ç”¨æœ¬åœ° Cookieã€‚è¯¦ç»†è¯·æŸ¥çœ‹ã€Œ <a href="/tos.html">æœ¬ç«™ä½¿ç”¨æ¡æ¬¾</a> ã€äº†è§£æ›´å¤šã€‚

  <button id="accept-tos">åŒæ„</button>
</div>

<section id="tools">
  
  
  <div class="tool toc">
    <svg class="icon b1 active" aria-hidden="true">
      <use xlink:href="#icon-toc"></use>
    </svg>
    <svg class="icon b2" aria-hidden="true">
      <use xlink:href="#icon-exit"></use>
    </svg>
  </div>
  
</section>
<section id="bttb" aria-label="Scroll back to top" class="bttb">
  <div class="tool">
    <svg class="icon top" aria-hidden="true">
      <use xlink:href="#icon-top"></use>
    </svg>
  </div>
</section>
        </div>
        
<div class="modal">
    <div class="modal-content">
        <header>
            <span class="close">&times;</span>
        </header>
        <div class="container"></div>
    </div>
</div>

        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/lazysizes/lazysizes.min.js" async></script>
        
            <script src="https://cdn.jsdelivr.net/npm/dayjs/dayjs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/dayjs/plugin/customParseFormat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/dayjs/plugin/relativeTime.js"></script>
<script>
    $(document).ready(function () {
        var time_formats = ['YYYY-MM-DD HH:mm:ss ZZ', 'YYYY DD MMM HH:mm:ss ZZ', 'YYYYå¹´MMæœˆDDæ—¥ HH:mm:ss ZZ'];
        function dateFormat(date, format) {
            var date_org = dayjs(date, time_formats[format]);
            var date = date_org.format(time_formats[format]);
            return { "date_org": date_org, "date": date }
        }

        dayjs.extend(window.dayjs_plugin_customParseFormat);
        dayjs.extend(window.dayjs_plugin_relativeTime);
        var post_date = $("meta[property='post-date']").attr('content');
        var post_date_format = $("meta[property='post-date-format']").attr('content');
        var local_post_date = dateFormat(post_date, post_date_format);

        $(".post time span.create-at").html(local_post_date["date"]);

        fetch("https://api.github.com/repos/zhonger/zhonger.github.io/commits?path=_posts/k8s/2024-10-08-k8s-introduction.md").then((response) => {
            return response.json();
        }).then((commits) => {
            if (commits.length != 0) {
                var update_at = dayjs(commits[0]['commit']['committer']['date']);
            } else {
                var update_at = post_date
            }

            var local_update_at = dateFormat(update_at, post_date_format);
            $('.post time span.update-at').html(local_update_at["date"]);

            var relative_time = dayjs().diff(local_update_at["date_org"], 'day');
            $(".post-copyright .tips span").append(relative_time);
            if (relative_time > 365) {
                $(".post-copyright .tips").addClass("active");
            }
        });
    });
</script>
            <script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script>
<script>
    socialShare('.social-share', {
        sites: [
            
            'wechat', 
            
            'weibo', 
            
            'douban', 
            
            'twitter'
            
        ],
    wechatQrcodeTitle: "åˆ†äº«åˆ°å¾®ä¿¡æœ‹å‹åœˆ",
        wechatQrcodeHelper: '<p>æ‰«ç åç‚¹å‡»å³ä¸Šè§’</p><p>å°†æœ¬æ–‡åˆ†äº«è‡³æœ‹å‹åœˆ</p>'
      });
    $("a.social-share-icon").each(function () {
        $(this).attr("aria-label", $(this).attr("class").split(' ')[1])
    });
</script>
        
        <script src="https://cdn.jsdelivr.net/npm/clipboard/dist/clipboard.min.js"></script>
        <script>
            /**
            * Better Scroll Experience
            */
            function scrollToAdjust(id){
              var element = document.getElementById(id);
              var headerOffset = 90;
              var elementPosition = element.getBoundingClientRect().top;
              var offsetPosition = elementPosition + window.scrollY - headerOffset;
              window.scrollTo({
                  top: offsetPosition,
                  behavior: "smooth"
              });
            }
        </script>
        <script src="/assets/js/app.min.js"></script>
        <script src="https://at.alicdn.com/t/c/font_3046306_ujr2yq34hw.js"></script>
        
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9E8SEJ5JNY"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-9E8SEJ5JNY');
</script>


<script async defer data-website-id="90ea4822-8012-444e-837a-757ea473e087" src="https://umami.lisz.top/pwiki.js"></script>








<script async src="https://busuanzi.lisz.top/js"></script>


        
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax-full/es5/tex-mml-svg.min.js"></script>
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
		jax: ["input/TeX", "output/HTML-CSS"],
		tex2jax: {
			inlineMath: [['$', '$'], ["\\(", "\\)"]],
			processEscapes: true,
			skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
		},
		"HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"] }
      });
    </script>



<script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script>
<script>
    $(document).ready(function () {
        var baseurl = $("meta[property='og:baseurl']").attr('content');
        $("p img").each(function () {
            $(this).attr('data-src', $(this).attr('src')).removeAttr('src').addClass("lazyload").attr('src', baseurl + '/assets/img/loading.gif');
            var strA = "<a data-fancybox='gallery' ref='gallery' href='" + $(this).attr('data-src') + "' data-caption='" + $(this).attr('alt') + "'></a>";
            $(this).wrapAll(strA);
            var caption = $(this)[0].alt;
            $(this).parent().after('<span class="caption">' + caption + '</span>');
        });
        Fancybox.bind('[data-fancybox]', {
            on: {
                load: (fancybox, slide) => {
                    var gray = $("meta[property='og:gray']").attr('content');
                    if (gray == "true") {
                        $(".fancybox__content img").addClass("gray");
                        $(".carousel__track .fancybox__thumb").addClass("gray");
                    }
                }
            }
        });
    });
</script>

<script src="https://cdn.jsdelivr.net/npm/hotkeys-js/dist/hotkeys.min.js"></script>
<script>
    $(document).ready(function () {
        var previous_url = $("meta[property='og:previous_url']").attr('content');
        var next_url = $("meta[property='og:next_url']").attr('content');

        hotkeys('left', function (event, handler) {
            // Prevent the default refresh event under WINDOWS system
            event.preventDefault();
            if (previous_url) {
                console.log('you pressed left!');
                window.location.href = previous_url;
            } else {
                $("#no-previous").addClass("active");
                setTimeout(function () { $("#no-previous").removeClass("active"); }, 1500);
            }
        });

        hotkeys('right', function (event, handler) {
            // Prevent the default refresh event under WINDOWS system
            event.preventDefault();
            if (next_url) {
                console.log('you pressed right!');
                window.location.href = next_url;
            } else {
                $("#no-next").addClass("active");
                setTimeout(function () { $("#no-next").removeClass("active"); }, 1500);
            }
        });
    });
</script>

<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<script>
    $(document).ready(function () {
        mermaid.initialize({
            startOnLoad: true,
            theme: "default",
        });
        mermaid.init(undefined, $('.mermaid2'));
    });
</script>

<script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-core.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/autoloader/prism-autoloader.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/line-numbers/prism-line-numbers.min.js"></script>
        




<script>
    $(document).ready(function () {
        if ($(".comment").length == 3) {
            var comment_status = $("#cmn-toggle-4")[0].checked;
            if (comment_status) {
                $(".comment:last > div").addClass("active");
            } else {
                $(".comment:nth-last-child(2) > div").addClass("active");
            }
            $("#cmn-toggle-4").click(function () {
                $(".comment:nth-last-child(2) > div").toggleClass("active");
                $(".comment:last > div").toggleClass("active");
            })
        } else {
            if ($(".comment").length == 2) {
                $(".comment:last > div").addClass("active")
            }
        }
    })
</script>
        <script>
    if ("serviceWorker" in navigator) {
        if (navigator.serviceWorker.controller) {
            console.log("An active service worker found, no need to register");
        } else {
            // Register the service worker
            navigator.serviceWorker
            .register("/sw.js", {
                scope: "/"
            })
            .then(function (reg) {
                console.log("Service worker has been registered for scope: " + reg.scope);
            });
        }
    }

// æ£€æµ‹æµè§ˆå™¨æ˜¯å¦æ”¯æŒSW
// if(navigator.serviceWorker != null){
//     navigator.serviceWorker.register("/sw.js")
//         .then(function(registartion){
//             console.log('æ”¯æŒsw:',registartion.scope)
//         })
// } else {
//     console.log('ä¸æ”¯æŒsw')
// }
</script>
        
<!-- start webpushr code --> <script>(function(w,d, s, id) {if(typeof(w.webpushr)!=='undefined') return;w.webpushr=w.webpushr||function(){(w.webpushr.q=w.webpushr.q||[]).push(arguments)};var js, fjs = d.getElementsByTagName(s)[0];js = d.createElement(s); js.id = id;js.async=1;js.src = "https://cdn.webpushr.com/app.min.js";fjs.parentNode.appendChild(js);}(window,document, 'script', 'webpushr-jssdk'));webpushr('setup',{'key':'BF0y1f49JPDkjSmUYtUb-gRzcVY72squyl0hE2xo7YTA4q7Ch2DAZ0WOZCNktfyakgPlDov92CafKw9ZPAwIDrc' });</script><!-- end webpushr code -->

        
<script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script>
<script type="text/javascript">
    docsearch({
        appId: "SFGDUYE6XB",
        apiKey: "0f353764aa52c81dd2d893bc669b4f7b",
        indexName: "lisz",
        container: 'li#search',
        debug: true,
    });
    docsearch({
        appId: "SFGDUYE6XB",
        apiKey: "0f353764aa52c81dd2d893bc669b4f7b",
        indexName: "lisz",
        container: '#search-toggle',
        debug: true,
    });
</script>

  </body>

</html>