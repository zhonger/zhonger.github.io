<!DOCTYPE html>

<html lang="zh-Hans">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPG：为你的 Git 提交记录加一把锁 - 仲儿的自留地</title>
    <meta name="author"  content="zhonger">
    <meta name="description" content="GPG：为你的 Git 提交记录加一把锁">
    <meta name="keywords"  content="GPG, 签名, Git, Signin, 代码安全, Code security">
    <!-- Open Graph -->
    <meta property="og:title" content="GPG：为你的 Git 提交记录加一把锁 - 仲儿的自留地">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://lisz.me/tech/webmaster/gpg.html">
    <meta property="og:baseurl" content="">
    <meta property="og:description" content="个人的一个技术博客站点，主要用于记录个人在学习过程中遇到的技术问题及解决方法、技术实验，以及一些比较有趣的事情。">
    <meta property="og:site_name" content="仲儿的自留地">
    <meta property="og:gray" content="false">
    
    <meta property="og:previous_url" content="/tech/webmaster/pwa.html">
    
    
    <meta property="og:next_url" content="/tech/webmaster/ldap-integration.html">
    
    <meta property="post-date-format" content="0">
    
    <meta property="post-date" content="2022-05-31 16:44:00 +0900" />
    
    
    <meta name="alivestart" content="08/08/2015">
    
    
    <meta name="google-site-verification" content="v729JR7Zs4nX-YvgaPeo3p1ise9vTA-6cMhamSu6N5c" />
    
    <meta name="theme-color" content="#81BBFF" />
    <link rel="manifest" href="/manifest.json" />
    <link rel="apple-touch-icon" href="/assets/img/touch/apple-touch-icon.png"/>
    <link rel="Shortcut Icon" href="/assets/icons/favicon.ico">
    <link rel="icon" href="/assets/icons/favicon.ico" type="image/x-icon" />
    <link rel="bookmark" href="/assets/icons/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lxgw-wenkai-screen-webfont@1.1.0/style.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@5.2.0/github-markdown-light.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css">
    
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prism-themes@1.9.0/themes/prism-one-light.min.css" />
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.28.0/plugins/line-numbers/prism-line-numbers.min.css">
    
    <link rel="stylesheet" href="/assets/css/app.min.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@waline/client/dist/waline.css" />
    <script src="//cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script>
</head>



<body class="line-numbers" ontouchstart="">




  <!--[if lt IE 10]>
  <div class="alert-danger" role="alert">你的浏览器实在太太太旧了，放学别走，升级完浏览器再说！<a target="_blank" class="alert-link" href="http://browsehappy.com">立即升级</a></div>
  <![endif]-->
  
  <div id="all" class="post" data-theme="default">
  
    <div class="alert-tip" id="no-previous">
      已经是最新一篇文章了！
    </div>
    <div class="alert-tip" id="no-next">
      已经是最后一篇文章了！
    </div>
    <input id="nm-switch" type="hidden" value="false"> <header class="g-header" data-theme="default">
    <div class="g-logo">
      <a href="/" aria-label="logo"></a>
    </div>
    <!-- <i id="menu-toggle" class="iconfont icon-menu"></i> -->
    <div id="mode-toggle">
        <svg class="icon icon-day" aria-hidden="true">
            <use xlink:href="#icon-day"></use>
        </svg>
        <svg class="icon icon-night" aria-hidden="true">
            <use xlink:href="#icon-night"></use>
        </svg>
    </div>
    <svg id="menu-toggle" class="icon-menu" aria-hidden="true">
        <use xlink:href="#icon-menu"></use>
    </svg>
    <nav class="g-nav">
        <ul>
            
                
                <li>
                    <a href="/" aria-label="home">
                        home
                    </a>
                </li>
                
            
                
                <li>
                    <a href="/blog/index.html" aria-label="blog">
                        blog
                    </a>
                </li>
                
            
                
                <li>
                    <a href="/archives.html" aria-label="archives">
                        archives
                    </a>
                </li>
                
            
                
                <li>
                    <a href="/tags.html" aria-label="tags">
                        tags
                    </a>
                </li>
                
            
                
                <li class="dropdown">
                    <a class="dropdown-toggle"> about </a>
                    <ul class="dropdown-menu">
                    
                        <li>
                            <a href="/feed.xml" aria-label="RSS">
                                RSS
                            </a>
                        </li>
                    
                        <li>
                            <a href="/logs.html" aria-label="logs">
                                logs
                            </a>
                        </li>
                    
                        <li>
                            <a href="/tos.html" aria-label="tos">
                                tos
                            </a>
                        </li>
                    
                        <li>
                            <a href="/cv.html" aria-label="CV">
                                CV
                            </a>
                        </li>
                    
                        <li>
                            <a href="/links.html" aria-label="links">
                                links
                            </a>
                        </li>
                    
                    </ul> 
                </li>
                
            
                
                <li class="dropdown">
                    <a class="dropdown-toggle"> collections </a>
                    <ul class="dropdown-menu">
                    
                        <li>
                            <a href="/tags.html#CONQUEST" aria-label="CONQUEST">
                                CONQUEST
                            </a>
                        </li>
                    
                        <li>
                            <a href="/tags.html#LDAP" aria-label="LDAP">
                                LDAP
                            </a>
                        </li>
                    
                        <li>
                            <a href="/tags.html#blog" aria-label="博客">
                                博客
                            </a>
                        </li>
                    
                    </ul> 
                </li>
                
            
            <li class="mode">
                <svg class="icon day" aria-hidden="true">
                    <use xlink:href="#icon-day"></use>
                </svg>
                <svg class="icon night" aria-hidden="true">
                    <use xlink:href="#icon-night"></use>
                </svg>
            </li>
        </ul>
    </nav>
</header>


    <header
      class="g-banner post-header post-pattern-food bgcolor-default "
      data-theme="default"
    >
      <div class="post-wrapper">
        <div class="post-tags">
          
            
              <a href="/tags.html#GPG" class="post-tag">GPG</a>
            
              <a href="/tags.html#%E7%AD%BE%E5%90%8D" class="post-tag">签名</a>
            
              <a href="/tags.html#Git" class="post-tag">Git</a>
            
              <a href="/tags.html#Signin" class="post-tag">Signin</a>
            
              <a href="/tags.html#%E4%BB%A3%E7%A0%81%E5%AE%89%E5%85%A8" class="post-tag">代码安全</a>
            
              <a href="/tags.html#Code%20security" class="post-tag">Code security</a>
            
          
        </div>
        <h1>GPG：为你的 Git 提交记录加一把锁</h1>
        <div class="post-meta">
          <span class="post-meta-item">
            <svg class="icon" aria-hidden="true">
              <use xlink:href="#icon-user"></use>
            </svg>
            zhonger
          </span>
          <time class="post-meta-item" datetime="22-05-31">
            <svg class="icon" aria-hidden="true">
              <use xlink:href="#icon-calendar"></use>
            </svg>
            <span class="create-at"></span>
          </time>
          <time class="post-meta-item" datetime="22-05-31">
            <svg class="icon" aria-hidden="true">
              <use xlink:href="#icon-update"></use>
            </svg>
            <span class="update-at"></span>
          </time>
            <span class="post-meta-item">
              <svg class="icon words" aria-hidden="true">
                <use xlink:href="#icon-words"></use>
              </svg>
              
              本文总共  5.1k  字
            </span>
            <span class="post-meta-item">
              <svg class="icon time" aria-hidden="true">
                <use xlink:href="#icon-time"></use>
              </svg>
              阅读全文大约需要 15 分钟
            </span>
            
              <span class="post-meta-item">
                <svg class="icon pv" aria-hidden="true">
                  <use xlink:href="#icon-pv"></use>
                </svg>
                本文总阅读量 <span id="busuanzi_value_page_pv"></span> 次
              </span>
            
            
            <span class="post-meta-item">
              <svg class="icon" aria-hidden="true">
                <use xlink:href="#icon-image"></use>
              </svg>
              
                封面图片提供者 <a href="https://unsplash.com/@alinnnaaaa" target="_blank">Alina Grubnyak</a>
              
            </span>
          
        </div>
      </div>
      
      <div class="filter"></div>
        <div class="post-cover" style="background: url('https://i.lisz.top/cover/skxyHS.webp') center no-repeat; background-size: cover;"></div>
      
    </header>
    <div class="post-content visible">
      
      <h2 class="post-subtitle">使用 GPG 为代码签名，让代码更加可信</h2>
      

      
      
      <div class="container">  
        <div class="contents">
          <article class="markdown-body post">
              
            <h2 id="前言">前言</h2>

<p>  GPG，全称 GNU Privacy Guard，也可以写成 GnuPG。它是一款免费开源的加密软件，也是不开源不免费的 PGP（Pretty Good Privacy）的替代品，有关详情可以查看参考资料。由于 GPG 可以用于签名或者加密，所以在文件加密、邮件加密、代码签名等方面应用较多。</p>

<h3 id="邮件加密">邮件加密</h3>

<p>  用过 Gmail 的同学可能看到过像下面这样不同的安全性信息。第一幅图是在没有以 SSL 方式与邮件服务器连接发送的时候，Gmail 会将邮件的安全性等级认定为最低的<strong>未加密</strong>级别。第二幅图是正常以 SSL 方式与邮件服务器连接发送时，Gmail 验证了 SSL 证书与邮送域一致并认定为<strong>标准加密</strong>的安全性等级。第三幅图是当我们使用 GPG 给邮件进行加密时，Gmail 会同时收到一个签名公钥的附件。</p>

<p><img src="https://i.lisz.top/blog/oKV4nd.webp" alt="未加密邮件 Uncertified mail">
<img src="https://i.lisz.top/blog/T4UqNm.webp" alt="标准加密邮件 Normal certified mail">
<img src="https://i.lisz.top/blog/Ocaj6f.webp" alt="GPG 加密邮件 GPG certified mail"></p>

<p>  这里看起来可能有点奇怪，为什么 GPG 加密的邮件和一般的标准加密邮件除了附件没有别的差别？实际上，我们如果想要给对方发一份 GPG 加密的邮件是需要用对方的 GPG 公钥来加密邮件内容的。当对方收到发送的 GPG 加密邮件时会用自己的私钥进行解密，从而获知加密邮件的内容。也就是说，上面的第三幅图并非是真正的 GPG 加密的邮件。第三幅图是作者用私钥签名的邮件，收件人可以用 keyserver 上查询到的公钥来验证邮件内容是否真的来自于发件人。</p>

<h3 id="代码签名">代码签名</h3>

<p>  相比邮件加密而言，GPG 用于代码签名则正好相反。在代码签名中，我们也像上面第三幅图那样使用私钥为每一次 commit 签名。而代码的使用者可以根据作者公布的公钥对代码内容进行验证，从而确保代码是来自作者本人。苹果开发者证书、Google Play 开发者证书实际上也是起到了这样一个核验代码作者身份的作用。</p>

<h3 id="git-的漏洞">Git 的“漏洞”</h3>

<p>  在 Git 提交 commit 之前，Git 会要求我们设定好 username 和 email（类似下面）。但是如果我们不设置成自己的 github username 和 email 会怎么样呢？其实不会怎么样，只是 Github 不会把这些 commit 算在你头上，而是算在了你伪造的用户头上。如果我们想要伪装成某位业界大咖的 github 账户为项目提交代码，似乎在理论上也没有什么不可以的。在参考资料四中，作者做了一些示例的尝试，发现“只要知道邮箱，就可以用他人的名义提交 commit”。但说到底，这种方式是不道德的，且没有任何实质意义的。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git config <span class="nt">--global</span> user.name <span class="s2">"zhonger"</span>
git config <span class="nt">--global</span> user.email <span class="s2">"zhonger@live.cn"</span>
</code></pre></div></div>

<p>  因此，为了使代码更加可信、确保是由作者本人提交的，Github 等代码托管平台纷纷支持了 GPG 签名。因为 GPG 公钥和私钥是 RSA 非对称加密生成的，所以理论上是不存在被伪造或反编码风险的。和从 GPG 密钥服务器中的公钥查询验证不同，Github 等代码托管平台只信任由作者本人在设置中配置的 GPG 公钥，与只信任配置的 SSH 公钥访问代码类似。</p>

<h2 id="实践">实践</h2>

<h3 id="安装-gpg">安装 GPG</h3>

<p>  在不同的平台上都已经提供了 GPG，大部分只需要一条命令即可完成安装。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># MacOS</span>
brew <span class="nb">install </span>gpg

<span class="c"># Debian, Ubuntu</span>
<span class="nb">sudo </span>apt <span class="nb">install</span> <span class="nt">-y</span> gnupg

<span class="c"># CentOS</span>
<span class="nb">sudo </span>yum <span class="nb">install</span> <span class="nt">-y</span> gnupg

<span class="c"># Windows</span>
<span class="c"># 推荐使用 WinGPG，下载地址为 https://scand.com/products/wingpg/</span>

<span class="c"># Archlinux</span>
<span class="nb">sudo </span>pacman <span class="nt">-S</span> gnupg
</code></pre></div></div>

<h3 id="验证安装">验证安装</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>╰─<span class="nv">$ </span>gpg <span class="nt">--version</span>                                                        
gpg <span class="o">(</span>GnuPG<span class="o">)</span> 2.3.6
libgcrypt 1.10.1
Copyright <span class="o">(</span>C<span class="o">)</span> 2021 Free Software Foundation, Inc.
License GNU GPL-3.0-or-later &lt;https://gnu.org/licenses/gpl.html&gt;
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

Home: /Users/zhonger/.gnupg
支持的算法：
公钥： RSA, ELG, DSA, ECDH, ECDSA, EDDSA
密文： IDEA, 3DES, CAST5, BLOWFISH, AES, AES192, AES256, TWOFISH,
    CAMELLIA128, CAMELLIA192, CAMELLIA256
AEAD: EAX, OCB
散列： SHA1, RIPEMD160, SHA256, SHA384, SHA512, SHA224
压缩：  不压缩, ZIP, ZLIB, BZIP2
</code></pre></div></div>

<h3 id="生成密钥">生成密钥</h3>

<p>  验证安装成功后，即可使用以下命令生成字母的密钥。如下所示，我们可以很简单地得到一对 GPG 密钥。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>╰─<span class="nv">$ </span>gpg <span class="nt">--full-generate-key</span>                                                       
gpg <span class="o">(</span>GnuPG<span class="o">)</span> 2.3.6<span class="p">;</span> Copyright <span class="o">(</span>C<span class="o">)</span> 2021 Free Software Foundation, Inc.
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

请选择您要使用的密钥类型：
   <span class="o">(</span>1<span class="o">)</span> RSA 和 RSA
   <span class="o">(</span>2<span class="o">)</span> DSA 和 Elgamal
   <span class="o">(</span>3<span class="o">)</span> DSA（仅用于签名）
   <span class="o">(</span>4<span class="o">)</span> RSA（仅用于签名）
   <span class="o">(</span>9<span class="o">)</span> ECC（签名和加密） <span class="k">*</span>默认<span class="k">*</span>
  <span class="o">(</span>10<span class="o">)</span> ECC（仅用于签名）
 （14）卡中现有密钥
您的选择是？
请选择您想要使用的椭圆曲线：
   <span class="o">(</span>1<span class="o">)</span> Curve 25519 <span class="k">*</span>默认<span class="k">*</span>
   <span class="o">(</span>4<span class="o">)</span> NIST P-384
   <span class="o">(</span>6<span class="o">)</span> Brainpool P-256
您的选择是？
请设定这个密钥的有效期限。
         0 <span class="o">=</span> 密钥永不过期
      &lt;n&gt;  <span class="o">=</span> 密钥在 n 天后过期
      &lt;n&gt;w <span class="o">=</span> 密钥在 n 周后过期
      &lt;n&gt;m <span class="o">=</span> 密钥在 n 月后过期
      &lt;n&gt;y <span class="o">=</span> 密钥在 n 年后过期
密钥的有效期限是？<span class="o">(</span>0<span class="o">)</span>
密钥永远不会过期
这些内容正确吗？ <span class="o">(</span>y/N<span class="o">)</span> y

GnuPG 需要构建用户标识以辨认您的密钥。

真实姓名： zhonger
电子邮件地址： zhonger@lisz.me
注释： zhonger
您选定了此用户标识：
    “zhonger <span class="o">(</span>zhonger<span class="o">)</span> &lt;zhonger@lisz.me&gt;”

更改姓名（N）、注释（C）、电子邮件地址（E）或确定（O）/退出（Q）？ O
我们需要生成大量的随机字节。在质数生成期间做些其他操作（敲打键盘
、移动鼠标、读写硬盘之类的）将会是一个不错的主意；这会让随机数
发生器有更好的机会获得足够的熵。
gpg: 警告：服务器 ‘gpg-agent’ 比我们的版本更老 （2.2.34 &lt; 2.3.6）
gpg: 注意： 过时的服务器可能缺少重要的安全修复。
gpg: 注意： 使用 “gpgconf <span class="nt">--kill</span> all” 来重启他们。
我们需要生成大量的随机字节。在质数生成期间做些其他操作（敲打键盘
、移动鼠标、读写硬盘之类的）将会是一个不错的主意；这会让随机数
发生器有更好的机会获得足够的熵。
gpg: 吊销证书已被存储为‘/Users/zhonger/.gnupg/openpgp-revocs.d/612E7E8200528FEC0B8AC3C715F73C3703B9796C.rev’
公钥和私钥已经生成并被签名。

pub   ed25519 2022-06-01 <span class="o">[</span>SC]
      612E7E8200528FEC0B8AC3C715F73C3703B9796C
uid                      zhonger <span class="o">(</span>zhonger<span class="o">)</span> &lt;zhonger@lisz.me&gt;
sub   cv25519 2022-06-01 <span class="o">[</span>E]
</code></pre></div></div>

<p>  这里生成密钥过程中要求选择的密钥类型、椭圆曲线、密钥有效期都采用了默认的选择（按 Enter 键即可），可根据个人需要自行选择。接下来的用户标识根据个人的 真实姓名（英文）、Github 邮件和用户名（注释），最后输入大写字母 O 结束设置。这一步骤结束后系统会提醒输入对私钥的密码，通常需要两次验证输入。至此成功生成了一对 GPG 密钥。</p>

<h3 id="github-配置密钥">Github 配置密钥</h3>

<p>  生成密钥之后我们就要将公钥添加到 Github上，并尝试使用私钥给代码签名并提交，验证是否被 Github 成功验证。</p>

<h4 id="打印公钥">打印公钥</h4>

<p>  如下命令所示，可以查询刚才生成密钥的公钥内容，并复制。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 列举本地所有密钥</span>
gpg <span class="nt">--list-keys</span>

<span class="c"># 查询指定 id 密钥的公钥内容</span>
gpg <span class="nt">--armor</span> <span class="nt">--export</span> &lt;GPG_KEY_ID》
</code></pre></div></div>

<p><img src="https://i.lisz.top/blog/RNvfUg.webp" alt="列举密钥 List gpg keys">
<img src="https://i.lisz.top/blog/jFalNR.webp" alt="查询公钥内容 Check public key content"></p>

<h4 id="添加-gpg-公钥">添加 GPG 公钥</h4>

<p>  访问 <a href="https://github.com/settings/gpg/new" rel="nofollow" target="_blank" class="extlinks">https://github.com/settings/gpg/new</a> 添加刚复制的 GPG 公钥内容，此处的 Title 可以任意命名，只要与已有的 Title 不重复即可。</p>

<p><img src="https://i.lisz.top/blog/KSdbdY.webp" alt="添加公钥 Add public key"></p>

<h4 id="查询已添加公钥">查询已添加公钥</h4>

<p>  访问 <a href="https://github.com/settings/keys" rel="nofollow" target="_blank" class="extlinks">https://github.com/settings/keys</a> 即可看到刚才新添加的 GPG 公钥。这里可以看到，邮箱地址后面多了个 Unverified。这是因为这个邮箱是一个没有绑定 Github 账户的假邮箱，如果邮箱是验证过的，这里就不会有这个标识了。</p>

<p><img src="https://i.lisz.top/blog/wEchBn.webp" alt="查询公钥 List all keys"></p>

<h3 id="为代码签名并提交">为代码签名并提交</h3>

<p>  为了不用每次提交 commit 的时候都要手动声明使用某个 GPG 私钥进行签名，这里在 git 的全局配置中添加两个配置项：user.signingkey（签名密钥 ID）和 commit.gpgsign（全部提交使用 GPG 签名）。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git config <span class="nt">--global</span> user.signingkey 612E7E8200528FEC0B8AC3C715F73C3703B9796C
git config <span class="nt">--global</span> commit.gpgsign <span class="nb">true</span>
</code></pre></div></div>

<p>  当我们设置好全局 Git 配置后，再次像平常那样执行 commit 提交时，就会弹出输入私钥密码的窗口，正常输入即可。</p>

<h3 id="验证提交签名">验证提交签名</h3>

<p>  虽然以上步骤已经完成了 GPG 为 commit 加一把锁，但是可能还不敢确认这把锁是否存在。这里有两种方法可以验证：一种是通过查询本地 git 来查看，另一种是通过 Github 在线查看。下面是使用个人的私钥（非本文示例密钥）分别采用两种方法在日常 git 项目中验证的效果图。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 本地验证提交签名</span>
git log <span class="nt">--show-signature</span>
</code></pre></div></div>

<p><img src="https://i.lisz.top/blog/VelGL4.webp" alt="本地验证提交签名 Verify the signature on local git">
<img src="https://i.lisz.top/blog/W6q65U.webp" alt="Github 验证提交签名 Verify the signature on github"></p>

<h2 id="其他相关问题">其他相关问题</h2>

<div class="premonition error"> <div class="header"> <svg class="icon error" aria-hidden="true"> <use xlink:href="#icon-error"></use> </svg> <div class="title"> 问题一 </div> </div> <div class="content"> <p>如果想要导出私钥和公钥备份或迁移怎么办？</p>



 </div> </div>
<div class="premonition info"> <div class="header"> <svg class="icon info" aria-hidden="true"> <use xlink:href="#icon-info"></use> </svg> <div class="title"> 解答 </div> </div> <div class="content"> <p>  一般来说，GPG 密钥的保管非常重要。如果 GPG 密钥的私钥丢失或者被他人窃取，那么将会很危险，因为别人可以使用该私钥在任何文件或邮件上签上你名字。所以重装电脑之前一定要注意好备份，即使平时也可能需要将 GPG 密钥存在一个非本地且安全可靠的位置。以下命令可以实现公钥和私钥的导出。</p>



 </div> </div>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gpg <span class="nt">--armor</span> <span class="nt">--output</span> gpg.pub <span class="nt">--export</span> &lt;GPG_KEY_ID&gt;
gpg <span class="nt">--armor</span> <span class="nt">--output</span> gpg.key <span class="nt">--export-secret-keys</span> &lt;GPG_SECRET_KEY&gt;
</code></pre></div></div>

<div class="premonition error"> <div class="header"> <svg class="icon error" aria-hidden="true"> <use xlink:href="#icon-error"></use> </svg> <div class="title"> 问题二 </div> </div> <div class="content"> <p>如何吊销已生成或丢失的 GPG 密钥？</p>



 </div> </div>
<div class="premonition info"> <div class="header"> <svg class="icon info" aria-hidden="true"> <use xlink:href="#icon-info"></use> </svg> <div class="title"> 解答 </div> </div> <div class="content"> <p>  当 GPG 私钥发生丢失（公钥丢失不影响安全，找回即可）时，我们需要在 Github 删除对应的公钥，这样可以保证 Github 不会再承认丢失私钥签名的代码。当然，为了除 Github 外其他正常的邮件、文件不再信任该丢失的私钥签名，我们需要向 GPG 声明该 GPG 公钥吊销，从而达到吊销私钥的目的（并非是删除密钥本身，而是标记作废）。具体操作如以下命令所示。</p>



 </div> </div>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 撤销密钥</span>
gpg <span class="nt">--output</span> revoke.asc <span class="nt">--gen-revoke</span> &lt;GPG_KEY_ID&gt;
<span class="c"># 将撤销密钥导入本地钥匙环</span>
gpg <span class="nt">--import</span> revoke.asc
<span class="c"># 搜索 GPG 密钥服务器中的密钥</span>
gpg <span class="nt">--keyserver</span> hkps://keys.openpgp.org <span class="nt">--search-keys</span> &lt;GPG_KEY_ID&gt; 
<span class="c"># 撤销 GPG 密钥服务器上的密钥</span>
gpg <span class="nt">--keyserver</span> hkps://keys.openpgp.org <span class="nt">--send-keys</span> &lt;GPG_KEY_ID&gt; 
</code></pre></div></div>

<p>（2022年9月30日补充）</p>

<div class="premonition error"> <div class="header"> <svg class="icon error" aria-hidden="true"> <use xlink:href="#icon-error"></use> </svg> <div class="title"> 问题三 </div> </div> <div class="content"> <p>如果不弹出输入密码框怎么办？</p>



 </div> </div>
<div class="premonition info"> <div class="header"> <svg class="icon info" aria-hidden="true"> <use xlink:href="#icon-info"></use> </svg> <div class="title"> 解答 </div> </div> <div class="content"> <p>  这主要是因为终端窗口加载的问题，如下所示添加对 GPG 使用的终端的声明，认定输入密码框的终端与现有终端一致，那么就会正常弹出输入密码框了。</p>



 </div> </div>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">GPG_TTY</span><span class="o">=</span><span class="si">$(</span><span class="nb">tty</span><span class="si">)</span>
</code></pre></div></div>

<h2 id="参考资料">参考资料</h2>

<ul>
  <li><a href="https://www.ruanyifeng.com/blog/2013/07/gpg.html" rel="nofollow" target="_blank" class="extlinks">GPG 入门教程</a></li>
  <li><a href="https://hedzr.com/security/gpg/gpg-short-guide/" rel="nofollow" target="_blank" class="extlinks">GPG Short Guide</a></li>
  <li><a href="https://bynss.com/apple/587437.html" rel="nofollow" target="_blank" class="extlinks">怎样在 macOS 上加密您的电子邮件</a></li>
  <li><a href="https://medium.com/starbugs/how-to-fake-the-author-of-git-commit-f44453b70afc" rel="nofollow" target="_blank" class="extlinks">用 Git 這麼久了，你知道 commit 是可以偽造的嗎</a></li>
  <li><a href="https://tourcoder.com/gpg-on-macos/" rel="nofollow" target="_blank" class="extlinks">macOS 下使用 GPG</a></li>
</ul>

            <div class="post-copyright">
              <p>
                <span>版权声明：</span>
                如无特别声明，本文版权归
                <a href="https://lisz.me" class="cplink">仲儿的自留地</a>
                所有，转载请注明本文链接。 
              </p>
              
                <p> 
                  （采用 
                  <a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" class="extlinks">CC BY-NC-SA 4.0</a> 
                  许可协议进行授权）
                </p>
              
              <p><span>本文标题：</span>《 GPG：为你的 Git 提交记录加一把锁 》</p>
              <p><span>本文链接：</span><a href="https://lisz.me/tech/webmaster/gpg.html" class="cplink">https://lisz.me/tech/webmaster/gpg.html</a></p>
              <p class="tips">本文最后一次更新为 <span></span> 天前，文章中的某些内容可能已过时！</p>
            </div>
          </article>
        </div>   
        <div class="table-of-contents">
          <h2>目录</h2>
          <ul><li><a onclick="scrollToAdjust('前言')">前言</a><ul><li><a onclick="scrollToAdjust('邮件加密')">邮件加密</a></li><li><a onclick="scrollToAdjust('代码签名')">代码签名</a></li><li><a onclick="scrollToAdjust('git-的“漏洞”')">Git 的“漏洞”</a></li></ul></li><li><a onclick="scrollToAdjust('实践')">实践</a><ul><li><a onclick="scrollToAdjust('安装-gpg')">安装 GPG</a></li><li><a onclick="scrollToAdjust('验证安装')">验证安装</a></li><li><a onclick="scrollToAdjust('生成密钥')">生成密钥</a></li><li><a onclick="scrollToAdjust('github-配置密钥')">Github 配置密钥</a><ul><li><a onclick="scrollToAdjust('打印公钥')">打印公钥</a></li><li><a onclick="scrollToAdjust('添加-gpg-公钥')">添加 GPG 公钥</a></li><li><a onclick="scrollToAdjust('查询已添加公钥')">查询已添加公钥</a></li></ul></li><li><a onclick="scrollToAdjust('为代码签名并提交')">为代码签名并提交</a></li><li><a onclick="scrollToAdjust('验证提交签名')">验证提交签名</a></li></ul></li><li><a onclick="scrollToAdjust('其他相关问题')">其他相关问题</a></li><li><a onclick="scrollToAdjust('参考资料')">参考资料</a></li></ul>
        </div>
      </div>
      

      
      <div class="social-share-wrapper">
        <div class="social-share"></div>
      </div>
      
    </div>

    <section class="author-detail">
      <section class="post-footer-item author-card">
        <div class="avatar">
          <img src="/assets/img/profile.webp" alt="">
        </div>
        <div class="author-name" rel="author">zhonger</div>
        <div class="bio">
          <p>Developer & Maintainer</p>
        </div>
        
        <ul class="sns-links">
          
          <li>
            <a href="https://scholar.google.com/citations?user=AUupIooAAAAJ" target="_blank" aria-label="google-scholar">
              <svg class="icon" aria-hidden="true">
                <use xlink:href="#icon-google-scholar"></use>
              </svg>
            </a>
          </li>
          
          <li>
            <a href="https://www.researchgate.net/profile/Shengzhou-Li" target="_blank" aria-label="researchgate">
              <svg class="icon" aria-hidden="true">
                <use xlink:href="#icon-researchgate"></use>
              </svg>
            </a>
          </li>
          
          <li>
            <a href="https://orcid.org/0000-0001-6973-3825" target="_blank" aria-label="ORCID">
              <svg class="icon" aria-hidden="true">
                <use xlink:href="#icon-ORCID"></use>
              </svg>
            </a>
          </li>
          
          <li>
            <a href="https://github.com/zhonger" target="_blank" aria-label="github">
              <svg class="icon" aria-hidden="true">
                <use xlink:href="#icon-github"></use>
              </svg>
            </a>
          </li>
          
          <li>
            <a href="https://www.linkedin.com/in/shengzhouli/" target="_blank" aria-label="linkedin">
              <svg class="icon" aria-hidden="true">
                <use xlink:href="#icon-linkedin"></use>
              </svg>
            </a>
          </li>
          
          <li>
            <a href="https://segmentfault.com/u/wuwozhonger" target="_blank" aria-label="segmentfault">
              <svg class="icon" aria-hidden="true">
                <use xlink:href="#icon-segmentfault"></use>
              </svg>
            </a>
          </li>
          
        </ul>
        
      </section>
      <section class="post-footer-item read-next">
        
        <div class="read-next-item">
          <a href="/tech/webmaster/pwa.html" class="read-next-link" aria-label="PWA：可能是成本最低的站点加速方式"></a>
          <section>
            <span>PWA：可能是成本最低的站点加速方式</span>
            <p>前言</p>
          </section>
          
          <div class="filter"></div>
          <img src="https://i.lisz.top/cover/EBXSnv.webp" alt="">
          
      </div>
        

        
        <div class="read-next-item">
          <a href="/tech/webmaster/ldap-integration.html" class="read-next-link" aria-label="基于 LDAP 的统一认证服务 Keycloak"></a>
            <section>
              <span>基于 LDAP 的统一认证服务 Keycloak</span>
              <p>前言</p>
            </section>
            
            <div class="filter"></div>
            <img src="https://i.lisz.top/cover/ugNxzD.webp" alt="">
            
        </div>
        
      </section>
      
   
      

      
    </section>

    


<footer class="g-footer">
  <div class="g-container">
    <div class="g-left">
      <section class="links">
        本站由 <a href="//jekyllrb.com" target="_blank" class="extlinks">Jekyll</a> 和 (基于 <a href="https://github.com/kaeyleo/jekyll-theme-H2O" target="_blank" class="extlinks">H2O</a> 的) <a href="https://github.com/zhonger/jekyll-theme-H2O-ac" target="_blank" class="extlinks">H2O-ac</a> 强力驱动
         (<a href="https://github.com/zhonger/jekyll-theme-H2O-ac/releases/tag/v.1.2.1" target="_blank" class="extlinks">v1.2.1</a>)  
        
      </section>
      <section class="links">仲儿的自留地 ©
        
        
          2015
          -
        
        2023
        
          <a href="https://beian.miit.gov.cn/" target="_blank" class="extlinks"></a>
        
      </section>
      
      <section>
        <span id="busuanzi_container_site_pv">
          👁️ 总浏览量 <span id="busuanzi_value_site_pv"></span> <b>·</b>
        </span>
        <span id="busuanzi_container_site_uv">
          👤 总访问量 <span id="busuanzi_value_site_uv"></span>
        </span>
      </section>
      
      <section>
        
          本站已运行 
          <span class="alivetime_days"></span> 天
          <span class="alivetime_hours"></span> 小时
          <span class="alivetime_minutes"></span> 分
          <span class="alivetime_seconds"></span> 秒
        
      </section>
    </div>
    <div class="g-right">
      
      
      <section class="badges">
        
          <a href="https://www.foreverblog.cn/" target="_blank" class="foreverblog"> 
            <img src="https://img.foreverblog.cn/logo_en_default.png" alt=""> 
          </a>
        
        
          <a href="https://www.foreverblog.cn/go.html" target="_blank" class="wormhole"> 
            <img src="https://img.foreverblog.cn/wormhole_3.gif" alt="" title="穿梭虫洞-随机访问十年之约友链博客">
          </a>
        
        
          <a href="https://notbyai.fyi/" target="_blank" class="notbyAI"> 
            <img src="/assets/icons/notbyAI-white.png" alt="Written by Human, Not by AI">
          </a>
        
      </section>
      
    </div>
    
  </div>
</footer>
<div class="cookie-tip">
   为了提升本站的使用体验和必要功能的正常使用，本站会使用本地 Cookie。详细请查看「 <a href="/tos.html">本站使用条款</a> 」了解更多。

  <button id="accept-tos">同意</button>
</div>
<button id="list" aria-label="Scroll back to top" class="mobile-list" type="button">
  <svg class="icon list day" aria-hidden="true">
    <use xlink:href="#icon-list-day"></use>
  </svg>
  <svg class="icon list night" aria-hidden="true">
    <use xlink:href="#icon-list-night"></use>
  </svg>
  <svg class="icon exit day" aria-hidden="true">
    <use xlink:href="#icon-exit-day"></use>
  </svg>
  <svg class="icon exit night" aria-hidden="true">
    <use xlink:href="#icon-exit-night"></use>
  </svg>
</button>
<button id="bttb" aria-label="Scroll back to top" class="bttb" type="button">
  <svg class="icon up day" aria-hidden="true">
    <use xlink:href="#icon-up-day"></use>
  </svg>
  <svg class="icon up night" aria-hidden="true">
    <use xlink:href="#icon-up-night"></use>
  </svg>
</button>


    
    <div class="modal">
        <div class="modal-content">
          <header>
            <span class="close">&times;</span>
          </header>
          <div class="container"></div>
        </div>
    </div>
    
  </div>

  <script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script>
  <script>
    socialShare('.social-share', {
      sites: [
        
          'wechat'
          ,
          
        
          'weibo'
          ,
          
        
          'douban'
          ,
          
        
          'twitter'
          
        
      ],
      wechatQrcodeTitle: "分享到微信朋友圈",
      wechatQrcodeHelper: '<p>扫码后点击右上角</p><p>将本文分享至朋友圈</p>'
    });
    $("a.social-share-icon").each(function() {
      $(this).attr("aria-label", $(this).attr("class").split(' ')[1])
    });
  </script>

  

  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
  <script src="/assets/js/app.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/clipboard/dist/clipboard.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/hotkeys-js/dist/hotkeys.min.js"></script>
  
  <script src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js" async></script>
  <script src="https://cdn.jsdelivr.net/npm/dayjs@1.11.2/dayjs.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dayjs@1.11.2/plugin/customParseFormat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dayjs@1.11.2/plugin/relativeTime.js"></script>
  <script>
    /**
    * Better Scroll Experience
    */
    function scrollToAdjust(id){
      var element = document.getElementById(id);
      var headerOffset = 90;
      var elementPosition = element.getBoundingClientRect().top;
      var offsetPosition = elementPosition + window.scrollY - headerOffset;
      window.scrollTo({
          top: offsetPosition,
          behavior: "smooth"
      });
    }
      // 给图片添加链接
      $(document).ready(function() {
          var baseurl = $("meta[property='og:baseurl']").attr('content');
          $("p img").each(function() {
              $(this).attr('data-src', $(this).attr('src')).removeAttr('src').addClass("lazyload").attr('src', baseurl + '/assets/img/loading.gif');
              var strA = "<a data-fancybox='gallery' ref='gallery' href='" + $(this).attr('data-src') + "' data-caption='" + $(this).attr('alt') + "'></a>";
              $(this).wrapAll(strA);
              var caption = $(this)[0].alt;
              $(this).parent().after('<span class="caption">' + caption + '</span>');
          });

          Fancybox.bind('[data-fancybox]', {
            on: {
              load: (fancybox, slide) => {
                var gray = $("meta[property='og:gray']").attr('content');
                if(gray == "true"){
                    $(".fancybox__content img").addClass("gray");
                    $(".carousel__track .fancybox__thumb").addClass("gray");
                }
              }
            }
          });   
          
          

          if($("#comments-switch").length > 0){
            var comment_status = $("#cmn-toggle-4")[0].checked;
            if(comment_status){
              $("#waline").addClass("active");
            }else {
              $("#disqus_thread").addClass("active");
            }
            $("#cmn-toggle-4").click(function(){
              $("#disqus_thread").toggleClass("active");
              $("#waline").toggleClass("active");
            })
          }else {
            if($("#disqus_thread").length > 0) {
              $("#disqus_thread").addClass("active");
            }else if($("#waline").length > 0) {
              $("#waline").addClass("active");
            }
          }

          var time_formats = ['YYYY-MM-DD HH:mm:ss ZZ', 'YYYY DD MMM HH:mm:ss ZZ', 'YYYY年MM月DD日 HH:mm:ss ZZ'];
          function dateFormat(date, format){
            var date_org = dayjs(date, time_formats[format]);
            var date     = date_org.format(time_formats[format]);
            return {"date_org": date_org, "date": date}
          }

          dayjs.extend(window.dayjs_plugin_customParseFormat);
          dayjs.extend(window.dayjs_plugin_relativeTime);
          var post_date = $("meta[property='post-date']").attr('content');
          var post_date_format = $("meta[property='post-date-format']").attr('content');
          var local_post_date = dateFormat(post_date, post_date_format);

          $(".post time span.create-at").html(local_post_date["date"]);

          fetch("https://api.github.com/repos/zhonger/zhonger.github.io/commits?path=_posts/develope/2022-05-31-gpg.md")
          .then((response) => {
            return response.json();
          })
          .then((commits) => {
            if(commits.length != 0){
              var update_at = dayjs(commits[0]['commit']['committer']['date']);
            }else {
              var update_at = post_date
            }

            var local_update_at = dateFormat(update_at, post_date_format);
            $('.post time span.update-at').html(local_update_at["date"]);

            var relative_time = dayjs().diff(local_update_at["date_org"], 'day');
            $(".post-copyright .tips span").append(relative_time);
            if(relative_time > 365){
              $(".post-copyright .tips").addClass("active");
            }
          });   
          
          /*
          * Keyboard shortcut bind: left and right
          */

          var previous_url = $("meta[property='og:previous_url']").attr('content');
          var next_url = $("meta[property='og:next_url']").attr('content');

          hotkeys('left', function(event, handler){
              // Prevent the default refresh event under WINDOWS system
              event.preventDefault();
              if(previous_url){
                  console.log('you pressed left!');
                  window.location.href = previous_url;
              }else {
                  $("#no-previous").addClass("active");
                  setTimeout(function(){$("#no-previous").removeClass("active");}, 1500);
              }
          });

          hotkeys('right', function(event, handler){
              // Prevent the default refresh event under WINDOWS system
              event.preventDefault();
              if(next_url){
                  console.log('you pressed right!');
                  window.location.href = next_url;
              }else {
                  $("#no-next").addClass("active");
                  setTimeout(function(){$("#no-next").removeClass("active");}, 1500);
              }
          });
      });
  </script>
  <script src="https://at.alicdn.com/t/font_3046306_skfh9jzzbbf.js"></script>
  
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9E8SEJ5JNY"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-9E8SEJ5JNY');
</script>

  
<script async defer data-website-id="90ea4822-8012-444e-837a-757ea473e087" src="https://umami.lisz.top/pwiki.js"></script>

  
<script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  <script>
    if ("serviceWorker" in navigator) {
        if (navigator.serviceWorker.controller) {
            console.log("An active service worker found, no need to register");
        } else {
            // Register the service worker
            navigator.serviceWorker
            .register("/sw.js", {
                scope: "/"
            })
            .then(function (reg) {
                console.log("Service worker has been registered for scope: " + reg.scope);
            });
        }
    }

// 检测浏览器是否支持SW
// if(navigator.serviceWorker != null){
//     navigator.serviceWorker.register("/sw.js")
//         .then(function(registartion){
//             console.log('支持sw:',registartion.scope)
//         })
// } else {
//     console.log('不支持sw')
// }
</script>
	<!--
Author: Ray-Eldath
refer to:
 - http://docs.mathjax.org/en/latest/options/index.html
-->

	<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
		jax: ["input/TeX", "output/HTML-CSS"],
		tex2jax: {
			inlineMath: [ ["$", "$"] ],
			displayMath: [ ["$$", "$$"] ],
			skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
		},
		"HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"] }
      });
    </script>

   
    <script src="https://cdn.jsdelivr.net/npm/mermaid@9.1.6/dist/mermaid.min.js"></script>
    <script>
        $(document).ready(function (){
            mermaid.initialize({
                startOnLoad:true,
                theme: "default",
            });
            mermaid.init(undefined, $('.mermaid2'));
        });
    </script>
 
  
<!-- start webpushr code --> <script>(function(w,d, s, id) {if(typeof(w.webpushr)!=='undefined') return;w.webpushr=w.webpushr||function(){(w.webpushr.q=w.webpushr.q||[]).push(arguments)};var js, fjs = d.getElementsByTagName(s)[0];js = d.createElement(s); js.id = id;js.async=1;js.src = "https://cdn.webpushr.com/app.min.js";fjs.parentNode.appendChild(js);}(window,document, 'script', 'webpushr-jssdk'));webpushr('setup',{'key':'BF0y1f49JPDkjSmUYtUb-gRzcVY72squyl0hE2xo7YTA4q7Ch2DAZ0WOZCNktfyakgPlDov92CafKw9ZPAwIDrc' });</script><!-- end webpushr code -->
 
</body>

</html>
